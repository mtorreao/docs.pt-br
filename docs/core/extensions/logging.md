---
title: Registro em log no .NET
author: IEvangelist
description: Saiba como usar a estrutura de registro em log fornecida pelo pacote do NuGet Microsoft.Extensions.Logging.
ms.author: dapine
ms.date: 09/30/2020
ms.openlocfilehash: 73c16c80e7e000533b880e908b38109d2b1e88fd
ms.sourcegitcommit: 45c7148f2483db2501c1aa696ab6ed2ed8cb71b2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/08/2020
ms.locfileid: "96851725"
---
# <a name="logging-in-net"></a><span data-ttu-id="ab83e-103">Registro em log no .NET</span><span class="sxs-lookup"><span data-stu-id="ab83e-103">Logging in .NET</span></span>

<span data-ttu-id="ab83e-104">O .NET oferece suporte a uma API de log que funciona com uma variedade de provedores de log internos e de terceiros.</span><span class="sxs-lookup"><span data-stu-id="ab83e-104">.NET supports a logging API that works with a variety of built-in and third-party logging providers.</span></span> <span data-ttu-id="ab83e-105">Este artigo mostra como usar a API de registro em log com provedores internos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-105">This article shows how to use the logging API with built-in providers.</span></span> <span data-ttu-id="ab83e-106">A maioria dos exemplos de código mostrados neste artigo se aplica a qualquer aplicativo .NET que usa o [host genérico](generic-host.md).</span><span class="sxs-lookup"><span data-stu-id="ab83e-106">Most of the code examples shown in this article apply to any .NET app that uses the [Generic Host](generic-host.md).</span></span> <span data-ttu-id="ab83e-107">Para aplicativos que não usam o host genérico, consulte [aplicativo de console que não](#non-host-console-app)é de host.</span><span class="sxs-lookup"><span data-stu-id="ab83e-107">For apps that don't use the Generic Host, see [Non-host console app](#non-host-console-app).</span></span>

## <a name="create-logs"></a><span data-ttu-id="ab83e-108">Criar logs</span><span class="sxs-lookup"><span data-stu-id="ab83e-108">Create logs</span></span>

<span data-ttu-id="ab83e-109">Para criar logs, use um <xref:Microsoft.Extensions.Logging.ILogger%601> objeto da [injeção de dependência (di)](dependency-injection.md).</span><span class="sxs-lookup"><span data-stu-id="ab83e-109">To create logs, use an <xref:Microsoft.Extensions.Logging.ILogger%601> object from [dependency injection (DI)](dependency-injection.md).</span></span>

<span data-ttu-id="ab83e-110">O exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="ab83e-110">The following example:</span></span>

- <span data-ttu-id="ab83e-111">Cria um agente, `ILogger<Worker>` , que usa uma *categoria* de log do nome totalmente qualificado do tipo `Worker` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-111">Creates a logger, `ILogger<Worker>`, which uses a log *category* of the fully qualified name of the type `Worker`.</span></span> <span data-ttu-id="ab83e-112">A categoria do log é uma cadeia de caracteres associada a cada log.</span><span class="sxs-lookup"><span data-stu-id="ab83e-112">The log category is a string that is associated with each log.</span></span>
- <span data-ttu-id="ab83e-113">Chamadas <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogInformation%2A> para log no `Information` nível.</span><span class="sxs-lookup"><span data-stu-id="ab83e-113">Calls <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogInformation%2A> to log at the `Information` level.</span></span> <span data-ttu-id="ab83e-114">O *nível* de log indica a gravidade do evento registrado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-114">The Log *level* indicates the severity of the logged event.</span></span>

:::code language="csharp" source="snippets/configuration/worker-service/Worker.cs" range="9-24" highlight="12":::

<span data-ttu-id="ab83e-115">[Níveis](#log-level) e [categorias](#log-category) serão explicados com mais detalhes posteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-115">[Levels](#log-level) and [categories](#log-category) are explained in more detail later in this article.</span></span>

## <a name="configure-logging"></a><span data-ttu-id="ab83e-116">Configurar o registro em log</span><span class="sxs-lookup"><span data-stu-id="ab83e-116">Configure logging</span></span>

<span data-ttu-id="ab83e-117">A configuração de log é normalmente fornecida pela `Logging` seção de *appSettings*. `{Environment}` arquivos *. JSON* .</span><span class="sxs-lookup"><span data-stu-id="ab83e-117">Logging configuration is commonly provided by the `Logging` section of *appsettings*.`{Environment}`*.json* files.</span></span> <span data-ttu-id="ab83e-118">O seguinte *appsettings.Development.jsno* arquivo é gerado pelos modelos de serviço do .net Worker:</span><span class="sxs-lookup"><span data-stu-id="ab83e-118">The following *appsettings.Development.json* file is generated by the .NET Worker service templates:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.Development.json":::

<span data-ttu-id="ab83e-119">No JSON anterior:</span><span class="sxs-lookup"><span data-stu-id="ab83e-119">In the preceding JSON:</span></span>

- <span data-ttu-id="ab83e-120">As `"Default"` `"Microsoft"` categorias,, e `"Microsoft.Hosting.Lifetime"` são especificadas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-120">The `"Default"`, `"Microsoft"`, and `"Microsoft.Hosting.Lifetime"` categories are specified.</span></span>
- <span data-ttu-id="ab83e-121">A `"Microsoft"` categoria se aplica a todas as categorias que começam com `"Microsoft"` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-121">The `"Microsoft"` category applies to all categories that start with `"Microsoft"`.</span></span>
- <span data-ttu-id="ab83e-122">A `"Microsoft"` categoria registra no nível de log `Warning` e superior.</span><span class="sxs-lookup"><span data-stu-id="ab83e-122">The `"Microsoft"` category logs at log level `Warning` and higher.</span></span>
- <span data-ttu-id="ab83e-123">A `"Microsoft.Hosting.Lifetime"` categoria é mais específica do que a `"Microsoft"` categoria, portanto, a `"Microsoft.Hosting.Lifetime"` categoria registra em nível de log "informações" e superior.</span><span class="sxs-lookup"><span data-stu-id="ab83e-123">The `"Microsoft.Hosting.Lifetime"` category is more specific than the `"Microsoft"` category, so the `"Microsoft.Hosting.Lifetime"` category logs at log level "Information" and higher.</span></span>
- <span data-ttu-id="ab83e-124">Um provedor de log específico não é especificado, portanto `LogLevel` se aplica a todos os provedores de log habilitados, exceto para o [log de eventos do Windows](logging-providers.md#windows-eventlog).</span><span class="sxs-lookup"><span data-stu-id="ab83e-124">A specific log provider is not specified, so `LogLevel` applies to all the enabled logging providers except for the [Windows EventLog](logging-providers.md#windows-eventlog).</span></span>

<span data-ttu-id="ab83e-125">A `Logging` propriedade pode ter <xref:Microsoft.Extensions.Logging.LogLevel> e registrar as propriedades do provedor.</span><span class="sxs-lookup"><span data-stu-id="ab83e-125">The `Logging` property can have <xref:Microsoft.Extensions.Logging.LogLevel> and log provider properties.</span></span> <span data-ttu-id="ab83e-126">O `LogLevel` especifica o [nível](#log-level) mínimo para registrar em log para as categorias selecionadas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-126">The `LogLevel` specifies the minimum [level](#log-level) to log for selected categories.</span></span> <span data-ttu-id="ab83e-127">No JSON anterior, `Information` e `Warning` os níveis de log são especificados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-127">In the preceding JSON, `Information` and `Warning` log levels are specified.</span></span> <span data-ttu-id="ab83e-128">`LogLevel` indica a severidade do log e varia de 0 a 6:</span><span class="sxs-lookup"><span data-stu-id="ab83e-128">`LogLevel` indicates the severity of the log and ranges from 0 to 6:</span></span>

<span data-ttu-id="ab83e-129">`Trace` = 0, `Debug` = 1, `Information` = 2, `Warning` = 3, `Error` = 4, `Critical` = 5 e `None` = 6.</span><span class="sxs-lookup"><span data-stu-id="ab83e-129">`Trace` = 0, `Debug` = 1, `Information` = 2, `Warning` = 3, `Error` = 4, `Critical` = 5, and `None` = 6.</span></span>

<span data-ttu-id="ab83e-130">Quando um `LogLevel` é especificado, o registro em log é habilitado para mensagens no nível especificado e superior.</span><span class="sxs-lookup"><span data-stu-id="ab83e-130">When a `LogLevel` is specified, logging is enabled for messages at the specified level and higher.</span></span> <span data-ttu-id="ab83e-131">No JSON anterior, a `Default` categoria é registrada para o `Information` e superior.</span><span class="sxs-lookup"><span data-stu-id="ab83e-131">In the preceding JSON, the `Default` category is logged for `Information` and higher.</span></span> <span data-ttu-id="ab83e-132">Por exemplo,,, `Information` `Warning` `Error` e `Critical` as mensagens são registradas em log.</span><span class="sxs-lookup"><span data-stu-id="ab83e-132">For example, `Information`, `Warning`, `Error`, and `Critical` messages are logged.</span></span> <span data-ttu-id="ab83e-133">Se não `LogLevel` for especificado, o log padrão será o `Information` nível.</span><span class="sxs-lookup"><span data-stu-id="ab83e-133">If no `LogLevel` is specified, logging defaults to the `Information` level.</span></span> <span data-ttu-id="ab83e-134">Para obter mais informações, consulte [níveis de log](#log-level).</span><span class="sxs-lookup"><span data-stu-id="ab83e-134">For more information, see [Log levels](#log-level).</span></span>

<span data-ttu-id="ab83e-135">Uma propriedade de provedor pode especificar uma `LogLevel` propriedade.</span><span class="sxs-lookup"><span data-stu-id="ab83e-135">A provider property can specify a `LogLevel` property.</span></span> <span data-ttu-id="ab83e-136">`LogLevel` em um provedor especifica os níveis de log para esse provedor e substitui as configurações de log que não são do provedor.</span><span class="sxs-lookup"><span data-stu-id="ab83e-136">`LogLevel` under a provider specifies levels to log for that provider, and overrides the non-provider log settings.</span></span> <span data-ttu-id="ab83e-137">Considere o seguinte *appsettings.jsno* arquivo:</span><span class="sxs-lookup"><span data-stu-id="ab83e-137">Consider the following *appsettings.json* file:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.Staging.json":::

<span data-ttu-id="ab83e-138">Configurações em `Logging.{ProviderName}.LogLevel` configurações de substituição no `Logging.LogLevel` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-138">Settings in `Logging.{ProviderName}.LogLevel` override settings in `Logging.LogLevel`.</span></span> <span data-ttu-id="ab83e-139">No JSON anterior, o `Debug` nível de log padrão do provedor é definido como `Information` :</span><span class="sxs-lookup"><span data-stu-id="ab83e-139">In the preceding JSON, the `Debug` provider's default log level is set to `Information`:</span></span>

`Logging:Debug:LogLevel:Default:Information`

<span data-ttu-id="ab83e-140">A configuração anterior especifica o `Information` nível de log para cada `Logging:Debug:` categoria, exceto `Microsoft.Hosting` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-140">The preceding setting specifies the `Information` log level for every `Logging:Debug:` category except `Microsoft.Hosting`.</span></span> <span data-ttu-id="ab83e-141">Quando uma categoria específica é listada, a categoria específica substitui a categoria padrão.</span><span class="sxs-lookup"><span data-stu-id="ab83e-141">When a specific category is listed, the specific category overrides the default category.</span></span> <span data-ttu-id="ab83e-142">No JSON anterior, as `Logging:Debug:LogLevel` categorias `"Microsoft.Hosting"` e `"Default"` substituem as configurações em `Logging:LogLevel`</span><span class="sxs-lookup"><span data-stu-id="ab83e-142">In the preceding JSON, the `Logging:Debug:LogLevel` categories `"Microsoft.Hosting"` and `"Default"` override the settings in `Logging:LogLevel`</span></span>

<span data-ttu-id="ab83e-143">O nível de log mínimo pode ser especificado para qualquer um dos:</span><span class="sxs-lookup"><span data-stu-id="ab83e-143">The minimum log level can be specified for any of:</span></span>

- <span data-ttu-id="ab83e-144">Provedores específicos: por exemplo, `Logging:EventSource:LogLevel:Default:Information`</span><span class="sxs-lookup"><span data-stu-id="ab83e-144">Specific providers:  For example, `Logging:EventSource:LogLevel:Default:Information`</span></span>
- <span data-ttu-id="ab83e-145">Categorias específicas: por exemplo, `Logging:LogLevel:Microsoft:Warning`</span><span class="sxs-lookup"><span data-stu-id="ab83e-145">Specific categories: For example, `Logging:LogLevel:Microsoft:Warning`</span></span>
- <span data-ttu-id="ab83e-146">Todos os provedores e todas as categorias: `Logging:LogLevel:Default:Warning`</span><span class="sxs-lookup"><span data-stu-id="ab83e-146">All providers and all categories: `Logging:LogLevel:Default:Warning`</span></span>

<span data-ttu-id="ab83e-147">Todos os logs abaixo do nível mínimo são \***não** _:</span><span class="sxs-lookup"><span data-stu-id="ab83e-147">Any logs below the minimum level are \***not** _:</span></span>

- <span data-ttu-id="ab83e-148">Passado para o provedor.</span><span class="sxs-lookup"><span data-stu-id="ab83e-148">Passed to the provider.</span></span>
- <span data-ttu-id="ab83e-149">Registrado ou exibido.</span><span class="sxs-lookup"><span data-stu-id="ab83e-149">Logged or displayed.</span></span>

<span data-ttu-id="ab83e-150">Para suprimir todos os logs, especifique [LogLevel. None](xref:Microsoft.Extensions.Logging.LogLevel).</span><span class="sxs-lookup"><span data-stu-id="ab83e-150">To suppress all logs, specify [LogLevel.None](xref:Microsoft.Extensions.Logging.LogLevel).</span></span> <span data-ttu-id="ab83e-151">`LogLevel.None` tem um valor de 6, que é maior que `LogLevel.Critical` (5).</span><span class="sxs-lookup"><span data-stu-id="ab83e-151">`LogLevel.None` has a value of 6, which is higher than `LogLevel.Critical` (5).</span></span>

<span data-ttu-id="ab83e-152">Se um provedor oferecer suporte a [escopos de log](#log-scopes), `IncludeScopes` indica se eles estão habilitados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-152">If a provider supports [log scopes](#log-scopes), `IncludeScopes` indicates whether they're enabled.</span></span> <span data-ttu-id="ab83e-153">Para obter mais informações, consulte [escopos de log](#log-scopes)</span><span class="sxs-lookup"><span data-stu-id="ab83e-153">For more information, see [log scopes](#log-scopes)</span></span>

<span data-ttu-id="ab83e-154">O seguinte _appsettings.jsem \* arquivo contém configurações para todos os provedores internos:</span><span class="sxs-lookup"><span data-stu-id="ab83e-154">The following _appsettings.json\* file contains settings for all of the built-in providers:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.Production.json":::

<span data-ttu-id="ab83e-155">Na amostra anterior:</span><span class="sxs-lookup"><span data-stu-id="ab83e-155">In the preceding sample:</span></span>

- <span data-ttu-id="ab83e-156">As categorias e os níveis não são valores sugeridos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-156">The categories and levels are not suggested values.</span></span> <span data-ttu-id="ab83e-157">O exemplo é fornecido para mostrar todos os provedores padrão.</span><span class="sxs-lookup"><span data-stu-id="ab83e-157">The sample is provided to show all the default providers.</span></span>
- <span data-ttu-id="ab83e-158">Configurações em `Logging.{ProviderName}.LogLevel` configurações de substituição no `Logging.LogLevel` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-158">Settings in `Logging.{ProviderName}.LogLevel` override settings in `Logging.LogLevel`.</span></span> <span data-ttu-id="ab83e-159">Por exemplo, o nível em `Debug.LogLevel.Default` substitui o nível em `LogLevel.Default` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-159">For example, the level in `Debug.LogLevel.Default` overrides the level in `LogLevel.Default`.</span></span>
- <span data-ttu-id="ab83e-160">O *alias* de cada provedor é usado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-160">Each provider's *alias* is used.</span></span> <span data-ttu-id="ab83e-161">Cada provedor define um *alias* que pode ser usado na configuração no lugar do nome de tipo totalmente qualificado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-161">Each provider defines an *alias* that can be used in configuration in place of the fully qualified type name.</span></span> <span data-ttu-id="ab83e-162">Os aliases internos dos provedores são:</span><span class="sxs-lookup"><span data-stu-id="ab83e-162">The built-in providers' aliases are:</span></span>
  - <span data-ttu-id="ab83e-163">Console</span><span class="sxs-lookup"><span data-stu-id="ab83e-163">Console</span></span>
  - <span data-ttu-id="ab83e-164">Depurar</span><span class="sxs-lookup"><span data-stu-id="ab83e-164">Debug</span></span>
  - <span data-ttu-id="ab83e-165">EventSource</span><span class="sxs-lookup"><span data-stu-id="ab83e-165">EventSource</span></span>
  - <span data-ttu-id="ab83e-166">EventLog</span><span class="sxs-lookup"><span data-stu-id="ab83e-166">EventLog</span></span>
  - <span data-ttu-id="ab83e-167">AzureAppServicesFile</span><span class="sxs-lookup"><span data-stu-id="ab83e-167">AzureAppServicesFile</span></span>
  - <span data-ttu-id="ab83e-168">AzureAppServicesBlob</span><span class="sxs-lookup"><span data-stu-id="ab83e-168">AzureAppServicesBlob</span></span>
  - <span data-ttu-id="ab83e-169">ApplicationInsights</span><span class="sxs-lookup"><span data-stu-id="ab83e-169">ApplicationInsights</span></span>

### <a name="set-log-level-by-command-line-environment-variables-and-other-configuration"></a><span data-ttu-id="ab83e-170">Definir o nível de log por linha de comando, variáveis de ambiente e outras configurações</span><span class="sxs-lookup"><span data-stu-id="ab83e-170">Set log level by command line, environment variables, and other configuration</span></span>

<span data-ttu-id="ab83e-171">O nível de log pode ser definido por qualquer um dos [provedores de configuração](configuration-providers.md).</span><span class="sxs-lookup"><span data-stu-id="ab83e-171">Log level can be set by any of the [configuration providers](configuration-providers.md).</span></span>

<span data-ttu-id="ab83e-172">Os seguintes comandos:</span><span class="sxs-lookup"><span data-stu-id="ab83e-172">The following commands:</span></span>

- <span data-ttu-id="ab83e-173">Defina a chave de ambiente `Logging:LogLevel:Microsoft` para um valor de `Information` no Windows.</span><span class="sxs-lookup"><span data-stu-id="ab83e-173">Set the environment key `Logging:LogLevel:Microsoft` to a value of `Information` on Windows.</span></span>
- <span data-ttu-id="ab83e-174">Teste as configurações ao usar um aplicativo criado com os modelos de serviço de trabalho do .NET.</span><span class="sxs-lookup"><span data-stu-id="ab83e-174">Test the settings when using an app created with the .NET Worker service templates.</span></span> <span data-ttu-id="ab83e-175">O `dotnet run` comando deve ser executado no diretório do projeto depois de usar o `set` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-175">The `dotnet run` command must be run in the project directory after using `set`.</span></span>

```cmd
set Logging__LogLevel__Microsoft=Information
dotnet run
```

<span data-ttu-id="ab83e-176">A configuração de ambiente anterior:</span><span class="sxs-lookup"><span data-stu-id="ab83e-176">The preceding environment setting:</span></span>

- <span data-ttu-id="ab83e-177">É definido apenas em processos iniciados na janela de comando em que foram definidos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-177">Is only set in processes launched from the command window they were set in.</span></span>
- <span data-ttu-id="ab83e-178">Não é lido por aplicativos iniciados com o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ab83e-178">Isn't read by apps launched with Visual Studio.</span></span>

<span data-ttu-id="ab83e-179">O comando [setx](/windows-server/administration/windows-commands/setx) a seguir também define a chave de ambiente e o valor no Windows.</span><span class="sxs-lookup"><span data-stu-id="ab83e-179">The following [setx](/windows-server/administration/windows-commands/setx) command also sets the environment key and value on Windows.</span></span> <span data-ttu-id="ab83e-180">Ao contrário `set` de, `setx` as configurações são persistidas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-180">Unlike `set`, `setx` settings are persisted.</span></span> <span data-ttu-id="ab83e-181">A `/M` opção define a variável no ambiente do sistema.</span><span class="sxs-lookup"><span data-stu-id="ab83e-181">The `/M` switch sets the variable in the system environment.</span></span> <span data-ttu-id="ab83e-182">Se `/M` não for usado, uma variável de ambiente do usuário será definida.</span><span class="sxs-lookup"><span data-stu-id="ab83e-182">If `/M` isn't used, a user environment variable is set.</span></span>

```cmd
setx Logging__LogLevel__Microsoft=Information /M
```

<span data-ttu-id="ab83e-183">Em [Azure app serviço](https://azure.microsoft.com/services/app-service/), selecione **nova configuração de aplicativo** na página **configurações > configuração** .</span><span class="sxs-lookup"><span data-stu-id="ab83e-183">On [Azure App Service](https://azure.microsoft.com/services/app-service/), select **New application setting** on the **Settings > Configuration** page.</span></span> <span data-ttu-id="ab83e-184">Azure App configurações do aplicativo de serviço são:</span><span class="sxs-lookup"><span data-stu-id="ab83e-184">Azure App Service application settings are:</span></span>

- <span data-ttu-id="ab83e-185">Criptografado em repouso e transmitido por um canal criptografado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-185">Encrypted at rest and transmitted over an encrypted channel.</span></span>
- <span data-ttu-id="ab83e-186">Exposto como variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="ab83e-186">Exposed as environment variables.</span></span>

<span data-ttu-id="ab83e-187">Para obter mais informações sobre como definir valores de configuração do .NET usando variáveis de ambiente, consulte [variáveis de ambiente](configuration-providers.md#environment-variable-configuration-provider).</span><span class="sxs-lookup"><span data-stu-id="ab83e-187">For more information on setting .NET configuration values using environment variables, see [environment variables](configuration-providers.md#environment-variable-configuration-provider).</span></span>

## <a name="how-filtering-rules-are-applied"></a><span data-ttu-id="ab83e-188">Como as regras de filtragem são aplicadas</span><span class="sxs-lookup"><span data-stu-id="ab83e-188">How filtering rules are applied</span></span>

<span data-ttu-id="ab83e-189">Quando um objeto <xref:Microsoft.Extensions.Logging.ILogger%601> é criado, o objeto <xref:Microsoft.Extensions.Logging.ILoggerFactory> seleciona uma única regra por provedor para aplicar a esse agente.</span><span class="sxs-lookup"><span data-stu-id="ab83e-189">When an <xref:Microsoft.Extensions.Logging.ILogger%601> object is created, the <xref:Microsoft.Extensions.Logging.ILoggerFactory> object selects a single rule per provider to apply to that logger.</span></span> <span data-ttu-id="ab83e-190">Todas as mensagens gravadas pela instância `ILogger` são filtradas com base nas regras selecionadas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-190">All messages written by an `ILogger` instance are filtered based on the selected rules.</span></span> <span data-ttu-id="ab83e-191">A regra mais específica para cada par de provedor e categoria é selecionada nas regras disponíveis.</span><span class="sxs-lookup"><span data-stu-id="ab83e-191">The most specific rule for each provider and category pair is selected from the available rules.</span></span>

<span data-ttu-id="ab83e-192">O algoritmo a seguir é usado para cada provedor quando um `ILogger` é criado para uma determinada categoria:</span><span class="sxs-lookup"><span data-stu-id="ab83e-192">The following algorithm is used for each provider when an `ILogger` is created for a given category:</span></span>

- <span data-ttu-id="ab83e-193">Selecione todas as regras que correspondem ao provedor ou seu alias.</span><span class="sxs-lookup"><span data-stu-id="ab83e-193">Select all rules that match the provider or its alias.</span></span> <span data-ttu-id="ab83e-194">Se nenhuma correspondência for encontrada, selecione todas as regras com um provedor vazio.</span><span class="sxs-lookup"><span data-stu-id="ab83e-194">If no match is found, select all rules with an empty provider.</span></span>
- <span data-ttu-id="ab83e-195">Do resultado da etapa anterior, selecione as regras com o prefixo de categoria de maior correspondência.</span><span class="sxs-lookup"><span data-stu-id="ab83e-195">From the result of the preceding step, select rules with longest matching category prefix.</span></span> <span data-ttu-id="ab83e-196">Se nenhuma correspondência for encontrada, selecione todas as regras que não especificam uma categoria.</span><span class="sxs-lookup"><span data-stu-id="ab83e-196">If no match is found, select all rules that don't specify a category.</span></span>
- <span data-ttu-id="ab83e-197">Se várias regras forem selecionadas, use a **última**.</span><span class="sxs-lookup"><span data-stu-id="ab83e-197">If multiple rules are selected, take the **last** one.</span></span>
- <span data-ttu-id="ab83e-198">Se nenhuma regra for selecionada, use <xref:Microsoft.Extensions.Logging.LoggingBuilderExtensions.SetMinimumLevel(Microsoft.Extensions.Logging.ILoggingBuilder,Microsoft.Extensions.Logging.LogLevel)?displayProperty=nameWithType> para especificar o nível de log mínimo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-198">If no rules are selected, use <xref:Microsoft.Extensions.Logging.LoggingBuilderExtensions.SetMinimumLevel(Microsoft.Extensions.Logging.ILoggingBuilder,Microsoft.Extensions.Logging.LogLevel)?displayProperty=nameWithType> to specify the minimum logging level.</span></span>

## <a name="log-category"></a><span data-ttu-id="ab83e-199">Categoria do log</span><span class="sxs-lookup"><span data-stu-id="ab83e-199">Log category</span></span>

<span data-ttu-id="ab83e-200">Quando um `ILogger` objeto é criado, uma *categoria* é especificada.</span><span class="sxs-lookup"><span data-stu-id="ab83e-200">When an `ILogger` object is created, a *category* is specified.</span></span> <span data-ttu-id="ab83e-201">Essa categoria é incluída em cada mensagem de log criada por essa instância de `ILogger`.</span><span class="sxs-lookup"><span data-stu-id="ab83e-201">That category is included with each log message created by that instance of `ILogger`.</span></span> <span data-ttu-id="ab83e-202">A cadeia de caracteres da categoria é arbitrária, mas a Convenção é usar o nome da classe.</span><span class="sxs-lookup"><span data-stu-id="ab83e-202">The category string is arbitrary, but the convention is to use the class name.</span></span> <span data-ttu-id="ab83e-203">Por exemplo, em um aplicativo com um serviço definido como o objeto a seguir, a categoria pode ser `"Example.DefaultService"` :</span><span class="sxs-lookup"><span data-stu-id="ab83e-203">For example, in an application with a service define like the following object, the category might be `"Example.DefaultService"`:</span></span>

```csharp
namespace Example
{
    public class DefaultService : IService
    {
        private readonly ILogger<DefaultService> _logger;

        public DefaultService(ILogger<DefaultService> logger) =>
            _logger = logger;

        // ...
    }
}
```

<span data-ttu-id="ab83e-204">Para especificar explicitamente a categoria, chame <xref:Microsoft.Extensions.Logging.LoggerFactory.CreateLogger%2A?displayProperty=nameWithType>:</span><span class="sxs-lookup"><span data-stu-id="ab83e-204">To explicitly specify the category, call <xref:Microsoft.Extensions.Logging.LoggerFactory.CreateLogger%2A?displayProperty=nameWithType>:</span></span>

```csharp
namespace Example
{
    public class DefaultService : IService
    {
        private readonly ILogger _logger;

        public DefaultService(ILoggerFactory loggerFactory) =>
            _logger = loggerFactory.CreateLogger("CustomCategory");

        // ...
    }
}
```

<span data-ttu-id="ab83e-205">Chamar `CreateLogger` com um nome fixo pode ser útil quando usado em vários métodos para que os eventos possam ser organizados por categoria.</span><span class="sxs-lookup"><span data-stu-id="ab83e-205">Calling `CreateLogger` with a fixed name can be useful when used in multiple methods so the events can be organized by category.</span></span>

<span data-ttu-id="ab83e-206">`ILogger<T>` é equivalente a chamar `CreateLogger` com o nome de tipo totalmente qualificado de `T`.</span><span class="sxs-lookup"><span data-stu-id="ab83e-206">`ILogger<T>` is equivalent to calling `CreateLogger` with the fully qualified type name of `T`.</span></span>

## <a name="log-level"></a><span data-ttu-id="ab83e-207">Nível de log</span><span class="sxs-lookup"><span data-stu-id="ab83e-207">Log level</span></span>

<span data-ttu-id="ab83e-208">A tabela a seguir lista os <xref:Microsoft.Extensions.Logging.LogLevel> valores, o `Log{LogLevel}` método de extensão de conveniência e o uso sugerido:</span><span class="sxs-lookup"><span data-stu-id="ab83e-208">The following table lists the <xref:Microsoft.Extensions.Logging.LogLevel> values, the convenience `Log{LogLevel}` extension method, and the suggested usage:</span></span>

| <span data-ttu-id="ab83e-209">LogLevel</span><span class="sxs-lookup"><span data-stu-id="ab83e-209">LogLevel</span></span> | <span data-ttu-id="ab83e-210">Valor</span><span class="sxs-lookup"><span data-stu-id="ab83e-210">Value</span></span> | <span data-ttu-id="ab83e-211">Método</span><span class="sxs-lookup"><span data-stu-id="ab83e-211">Method</span></span> | <span data-ttu-id="ab83e-212">Descrição</span><span class="sxs-lookup"><span data-stu-id="ab83e-212">Description</span></span> |
|--|--|--|--|
| [<span data-ttu-id="ab83e-213">Trace</span><span class="sxs-lookup"><span data-stu-id="ab83e-213">Trace</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-214">0</span><span class="sxs-lookup"><span data-stu-id="ab83e-214">0</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogTrace%2A> | <span data-ttu-id="ab83e-215">Conter as mensagens mais detalhadas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-215">Contain the most detailed messages.</span></span> <span data-ttu-id="ab83e-216">Essas mensagens podem conter dados confidenciais do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-216">These messages may contain sensitive app data.</span></span> <span data-ttu-id="ab83e-217">Essas mensagens são desabilitadas por padrão e devem \***não** ser habilitadas na produção.</span><span class="sxs-lookup"><span data-stu-id="ab83e-217">These messages are disabled by default and should \***not** _ be enabled in production.</span></span> |
| [<span data-ttu-id="ab83e-218">Depurar</span><span class="sxs-lookup"><span data-stu-id="ab83e-218">Debug</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-219">1</span><span class="sxs-lookup"><span data-stu-id="ab83e-219">1</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogDebug%2A> | <span data-ttu-id="ab83e-220">Para depuração e desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="ab83e-220">For debugging and development.</span></span> <span data-ttu-id="ab83e-221">Use com cuidado na produção devido ao alto volume.</span><span class="sxs-lookup"><span data-stu-id="ab83e-221">Use with caution in production due to the high volume.</span></span> |
| [<span data-ttu-id="ab83e-222">Informações</span><span class="sxs-lookup"><span data-stu-id="ab83e-222">Information</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-223">2</span><span class="sxs-lookup"><span data-stu-id="ab83e-223">2</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogInformation%2A> | <span data-ttu-id="ab83e-224">Rastreia o fluxo geral do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-224">Tracks the general flow of the app.</span></span> <span data-ttu-id="ab83e-225">Pode ter um valor de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-225">May have long-term value.</span></span> |
| [<span data-ttu-id="ab83e-226">Aviso</span><span class="sxs-lookup"><span data-stu-id="ab83e-226">Warning</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-227">3</span><span class="sxs-lookup"><span data-stu-id="ab83e-227">3</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogWarning%2A> | <span data-ttu-id="ab83e-228">Para eventos anormais ou inesperados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-228">For abnormal or unexpected events.</span></span> <span data-ttu-id="ab83e-229">Normalmente inclui erros ou condições que não fazem com que o aplicativo falhe.</span><span class="sxs-lookup"><span data-stu-id="ab83e-229">Typically includes errors or conditions that don't cause the app to fail.</span></span> |
| [<span data-ttu-id="ab83e-230">Erro</span><span class="sxs-lookup"><span data-stu-id="ab83e-230">Error</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-231">4</span><span class="sxs-lookup"><span data-stu-id="ab83e-231">4</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogError%2A> | <span data-ttu-id="ab83e-232">Para erros e exceções que não podem ser manipulados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-232">For errors and exceptions that cannot be handled.</span></span> <span data-ttu-id="ab83e-233">Essas mensagens indicam uma falha na operação ou solicitação atual, não uma falha em todo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-233">These messages indicate a failure in the current operation or request, not an app-wide failure.</span></span> |
| [<span data-ttu-id="ab83e-234">Crítico</span><span class="sxs-lookup"><span data-stu-id="ab83e-234">Critical</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-235">5</span><span class="sxs-lookup"><span data-stu-id="ab83e-235">5</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogCritical%2A> | <span data-ttu-id="ab83e-236">Para falhas que exigem atenção imediata.</span><span class="sxs-lookup"><span data-stu-id="ab83e-236">For failures that require immediate attention.</span></span> <span data-ttu-id="ab83e-237">Exemplos: cenários de perda de dados, espaço em disco insuficiente.</span><span class="sxs-lookup"><span data-stu-id="ab83e-237">Examples: data loss scenarios, out of disk space.</span></span> |
| [<span data-ttu-id="ab83e-238">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ab83e-238">None</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="ab83e-239">6</span><span class="sxs-lookup"><span data-stu-id="ab83e-239">6</span></span> |  | <span data-ttu-id="ab83e-240">Especifica que nenhuma mensagem deve ser gravada.</span><span class="sxs-lookup"><span data-stu-id="ab83e-240">Specifies that no messages should be written.</span></span> |

<span data-ttu-id="ab83e-241">Na tabela anterior, o `LogLevel` é listado da severidade mais baixa para a mais alta.</span><span class="sxs-lookup"><span data-stu-id="ab83e-241">In the previous table, the `LogLevel` is listed from lowest to highest severity.</span></span>

<span data-ttu-id="ab83e-242">O primeiro parâmetro do método de [log](xref:Microsoft.Extensions.Logging.LoggerExtensions) , <xref:Microsoft.Extensions.Logging.LogLevel> , indica a severidade do log.</span><span class="sxs-lookup"><span data-stu-id="ab83e-242">The [Log](xref:Microsoft.Extensions.Logging.LoggerExtensions) method's first parameter, <xref:Microsoft.Extensions.Logging.LogLevel>, indicates the severity of the log.</span></span> <span data-ttu-id="ab83e-243">Em vez de chamar `Log(LogLevel, ...)` , a maioria dos desenvolvedores chama os métodos de extensão do [log {LogLevel}](xref:Microsoft.Extensions.Logging.LoggerExtensions) .</span><span class="sxs-lookup"><span data-stu-id="ab83e-243">Rather than calling `Log(LogLevel, ...)`, most developers call the [Log{LogLevel}](xref:Microsoft.Extensions.Logging.LoggerExtensions) extension methods.</span></span> <span data-ttu-id="ab83e-244">Os `Log{LogLevel}` métodos de extensão [chamam o método de log e especificam o LogLevel](https://github.com/dotnet/extensions/blob/release/3.1/src/Logging/Logging.Abstractions/src/LoggerExtensions.cs).</span><span class="sxs-lookup"><span data-stu-id="ab83e-244">The `Log{LogLevel}` extension methods [call the Log method and specify the LogLevel](https://github.com/dotnet/extensions/blob/release/3.1/src/Logging/Logging.Abstractions/src/LoggerExtensions.cs).</span></span> <span data-ttu-id="ab83e-245">Por exemplo, as duas chamadas de log a seguir são funcionalmente equivalentes e produzem o mesmo log:</span><span class="sxs-lookup"><span data-stu-id="ab83e-245">For example, the following two logging calls are functionally equivalent and produce the same log:</span></span>

```csharp
public void LogDetails()
{
    var logMessage = "Details for log.";

    _logger.Log(LogLevel.Information, AppLogEvents.Details, logMessage);
    _logger.LogInformation(AppLogEvents.Details, logMessage);
}
```

<span data-ttu-id="ab83e-246">`AppLogEvents.Details` é a ID do evento e é representada implicitamente por um <xref:System.Int32> valor constante.</span><span class="sxs-lookup"><span data-stu-id="ab83e-246">`AppLogEvents.Details` is the event ID, and is implicitly represented by a constant <xref:System.Int32> value.</span></span> <span data-ttu-id="ab83e-247">`AppLogEvents` é uma classe que expõe várias constantes de identificador nomeado e é exibida na seção [ID do evento de log](#log-event-id) .</span><span class="sxs-lookup"><span data-stu-id="ab83e-247">`AppLogEvents` is a class that exposes various named identifier constants and is displayed in the [Log event ID](#log-event-id) section.</span></span>

<span data-ttu-id="ab83e-248">O código a seguir cria os logs `Information` e `Warning`:</span><span class="sxs-lookup"><span data-stu-id="ab83e-248">The following code creates `Information` and `Warning` logs:</span></span>

```csharp
public async Task<T> GetAsync<T>(string id)
{
    _logger.LogInformation(AppLogEvents.Read, "Reading value for {Id}", id);

    var result = await _repository.GetAsync(id);
    if (result is null)
    {
        _logger.LogWarning(AppLogEvents.ReadNotFound, "GetAsync({Id}) not found", id);
    }

    return result;
}
```

<span data-ttu-id="ab83e-249">No código anterior, o primeiro `Log{LogLevel}` parâmetro, `AppLogEvents.Read` , é a [ID do evento de log](#log-event-id).</span><span class="sxs-lookup"><span data-stu-id="ab83e-249">In the preceding code, the first `Log{LogLevel}` parameter,`AppLogEvents.Read`, is the [Log event ID](#log-event-id).</span></span> <span data-ttu-id="ab83e-250">O segundo parâmetro é um modelo de mensagem com espaços reservados para valores de argumento fornecidos pelos parâmetros de método restantes.</span><span class="sxs-lookup"><span data-stu-id="ab83e-250">The second parameter is a message template with placeholders for argument values provided by the remaining method parameters.</span></span> <span data-ttu-id="ab83e-251">Os parâmetros do método são explicados na seção de [modelo de mensagem](#log-message-template) mais adiante neste artigo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-251">The method parameters are explained in the [message template](#log-message-template) section later in this article.</span></span>

<span data-ttu-id="ab83e-252">Configure o nível de log apropriado e chame os `Log{LogLevel}` métodos corretos para controlar a quantidade de saída de log gravada em um meio de armazenamento específico.</span><span class="sxs-lookup"><span data-stu-id="ab83e-252">Configure the appropriate log level and call the correct `Log{LogLevel}` methods to control how much log output is written to a particular storage medium.</span></span> <span data-ttu-id="ab83e-253">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="ab83e-253">For example:</span></span>

- <span data-ttu-id="ab83e-254">Em produção:</span><span class="sxs-lookup"><span data-stu-id="ab83e-254">In production:</span></span>
  - <span data-ttu-id="ab83e-255">O registro em log nos `Trace` `Information` níveis ou produz um alto volume de mensagens de log detalhadas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-255">Logging at the `Trace` or `Information` levels produces a high-volume of detailed log messages.</span></span> <span data-ttu-id="ab83e-256">Para controlar os custos e não exceder os limites de armazenamento de dados, `Trace` as mensagens de log e de `Information` nível para um armazenamento de dados de alto volume e baixo custo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-256">To control costs and not exceed data storage limits, log `Trace` and `Information` level messages to a high-volume, low-cost data store.</span></span> <span data-ttu-id="ab83e-257">Considere limitar `Trace` e `Information` para categorias específicas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-257">Consider limiting `Trace` and `Information` to specific categories.</span></span>
  - <span data-ttu-id="ab83e-258">O registro em log `Warning` por meio de `Critical` níveis deve produzir algumas mensagens de log.</span><span class="sxs-lookup"><span data-stu-id="ab83e-258">Logging at `Warning` through `Critical` levels should produce few log messages.</span></span>
    - <span data-ttu-id="ab83e-259">Os custos e os limites de armazenamento geralmente não são uma preocupação.</span><span class="sxs-lookup"><span data-stu-id="ab83e-259">Costs and storage limits usually aren't a concern.</span></span>
    - <span data-ttu-id="ab83e-260">Alguns logs permitem mais flexibilidade em opções de armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-260">Few logs allow more flexibility in data store choices.</span></span>
- <span data-ttu-id="ab83e-261">Em desenvolvimento:</span><span class="sxs-lookup"><span data-stu-id="ab83e-261">In development:</span></span>
  - <span data-ttu-id="ab83e-262">Defina como `Warning`.</span><span class="sxs-lookup"><span data-stu-id="ab83e-262">Set to `Warning`.</span></span>
  - <span data-ttu-id="ab83e-263">Adicionar `Trace` ou `Information` mensagens ao solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-263">Add `Trace` or `Information` messages when troubleshooting.</span></span> <span data-ttu-id="ab83e-264">Para limitar a saída, defina `Trace` ou `Information` apenas para as categorias em investigação.</span><span class="sxs-lookup"><span data-stu-id="ab83e-264">To limit output, set `Trace` or `Information` only for the categories under investigation.</span></span>

<span data-ttu-id="ab83e-265">Os seguintes conjuntos JSON `Logging:Console:LogLevel:Microsoft:Information` :</span><span class="sxs-lookup"><span data-stu-id="ab83e-265">The following JSON sets `Logging:Console:LogLevel:Microsoft:Information`:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.MSFT.json":::

## <a name="log-event-id"></a><span data-ttu-id="ab83e-266">ID de evento de log</span><span class="sxs-lookup"><span data-stu-id="ab83e-266">Log event ID</span></span>

<span data-ttu-id="ab83e-267">Cada log pode especificar um _event um identificador \*, o <xref:Microsoft.Extensions.Logging.EventId> é uma estrutura com `Id` `Name` as propriedades ReadOnly opcionais.</span><span class="sxs-lookup"><span data-stu-id="ab83e-267">Each log can specify an _event identifer\*, the <xref:Microsoft.Extensions.Logging.EventId> is a structure with an `Id` and optional `Name` readonly properties.</span></span> <span data-ttu-id="ab83e-268">O código-fonte de exemplo usa a `AppLogEvents` classe para definir IDs de evento:</span><span class="sxs-lookup"><span data-stu-id="ab83e-268">The sample source code uses the `AppLogEvents` class to define event IDs:</span></span>

```csharp
internal static class AppLogEvents
{
    internal const int Create = 1000;
    internal const int Read = 1001;
    internal const int Update = 1002;
    internal const int Delete = 1003;

    internal const int Details = 3000;
    internal const int Error = 3001;

    internal const int ReadNotFound = 4000;
    internal const int UpdateNotFound = 4001;

    // ...
}
```

<span data-ttu-id="ab83e-269">Uma ID de evento associa um conjunto de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-269">An event ID associates a set of events.</span></span> <span data-ttu-id="ab83e-270">Por exemplo, todos os logs relacionados à leitura de valores de um repositório podem ser `1001` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-270">For example, all logs related to reading values from a repository might be `1001`.</span></span>

<span data-ttu-id="ab83e-271">O provedor de registro em log pode registrar a ID do evento em um campo de ID, na mensagem de registro ou não.</span><span class="sxs-lookup"><span data-stu-id="ab83e-271">The logging provider may log the event ID in an ID field, in the logging message, or not at all.</span></span> <span data-ttu-id="ab83e-272">O provedor de Depuração não mostra IDs de eventos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-272">The Debug provider doesn't show event IDs.</span></span> <span data-ttu-id="ab83e-273">O provedor de console mostra IDs de evento entre colchetes após a categoria:</span><span class="sxs-lookup"><span data-stu-id="ab83e-273">The console provider shows event IDs in brackets after the category:</span></span>

```console
info: Example.DefaultService.GetAsync[1001]
      Reading value for a1b2c3
warn: Example.DefaultService.GetAsync[4000]
      GetAsync(a1b2c3) not found
```

<span data-ttu-id="ab83e-274">Alguns provedores de log armazenam a ID do evento em um campo, que permite filtrar a ID.</span><span class="sxs-lookup"><span data-stu-id="ab83e-274">Some logging providers store the event ID in a field, which allows for filtering on the ID.</span></span>

## <a name="log-message-template"></a><span data-ttu-id="ab83e-275">Modelo de mensagem de log</span><span class="sxs-lookup"><span data-stu-id="ab83e-275">Log message template</span></span>

<span data-ttu-id="ab83e-276">Cada API de log usa um modelo de mensagem.</span><span class="sxs-lookup"><span data-stu-id="ab83e-276">Each log API uses a message template.</span></span> <span data-ttu-id="ab83e-277">O modelo de mensagem pode conter espaços reservados para os quais são fornecidos argumentos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-277">The message template can contain placeholders for which arguments are provided.</span></span> <span data-ttu-id="ab83e-278">Use nomes para os espaços reservados, não números.</span><span class="sxs-lookup"><span data-stu-id="ab83e-278">Use names for the placeholders, not numbers.</span></span> <span data-ttu-id="ab83e-279">A ordem dos espaços reservados e não de seus nomes, determina quais parâmetros serão usados para fornecer seus valores.</span><span class="sxs-lookup"><span data-stu-id="ab83e-279">The order of placeholders, not their names, determines which parameters are used to provide their values.</span></span> <span data-ttu-id="ab83e-280">No código a seguir, os nomes de parâmetro estão fora de sequência no modelo de mensagem:</span><span class="sxs-lookup"><span data-stu-id="ab83e-280">In the following code, the parameter names are out of sequence in the message template:</span></span>

```csharp
string p1 = "param1";
string p2 = "param2";
_logger.LogInformation("Parameter values: {p2}, {p1}", p1, p2);
```

<span data-ttu-id="ab83e-281">O código anterior cria uma mensagem de log com os valores de parâmetro em sequência:</span><span class="sxs-lookup"><span data-stu-id="ab83e-281">The preceding code creates a log message with the parameter values in sequence:</span></span>

```text
Parameter values: param1, param2
```

<span data-ttu-id="ab83e-282">Essa abordagem permite que os provedores de log implementem [logs semânticos ou estruturados](https://github.com/NLog/NLog/wiki/How-to-use-structured-logging).</span><span class="sxs-lookup"><span data-stu-id="ab83e-282">This approach allows logging providers to implement [semantic or structured logging](https://github.com/NLog/NLog/wiki/How-to-use-structured-logging).</span></span> <span data-ttu-id="ab83e-283">Os próprios argumentos são passados para o sistema de registro em log, não apenas o modelo de mensagem formatado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-283">The arguments themselves are passed to the logging system, not just the formatted message template.</span></span> <span data-ttu-id="ab83e-284">Isso permite que os provedores de log armazenem os valores de parâmetro como campos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-284">This enables logging providers to store the parameter values as fields.</span></span> <span data-ttu-id="ab83e-285">Considere o seguinte método de agente:</span><span class="sxs-lookup"><span data-stu-id="ab83e-285">Consider the following logger method:</span></span>

```csharp
_logger.LogInformation("Getting item {Id} at {RunTime}", id, DateTime.Now);
```

<span data-ttu-id="ab83e-286">Por exemplo, ao fazer logon no armazenamento de tabelas do Azure:</span><span class="sxs-lookup"><span data-stu-id="ab83e-286">For example, when logging to Azure Table Storage:</span></span>

- <span data-ttu-id="ab83e-287">Cada entidade de tabela do Azure pode ter `ID` `RunTime` Propriedades e.</span><span class="sxs-lookup"><span data-stu-id="ab83e-287">Each Azure Table entity can have `ID` and `RunTime` properties.</span></span>
- <span data-ttu-id="ab83e-288">Tabelas com propriedades simplificam consultas em dados registrados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-288">Tables with properties simplify queries on logged data.</span></span> <span data-ttu-id="ab83e-289">Por exemplo, uma consulta pode localizar todos os logs em um `RunTime` intervalo específico sem precisar analisar o tempo de saída da mensagem de texto.</span><span class="sxs-lookup"><span data-stu-id="ab83e-289">For example, a query can find all logs within a particular `RunTime` range without having to parse the time out of the text message.</span></span>

## <a name="log-exceptions"></a><span data-ttu-id="ab83e-290">Registrar exceções em log</span><span class="sxs-lookup"><span data-stu-id="ab83e-290">Log exceptions</span></span>

<span data-ttu-id="ab83e-291">Os métodos de agente têm sobrecargas que usam um parâmetro de exceção:</span><span class="sxs-lookup"><span data-stu-id="ab83e-291">The logger methods have overloads that take an exception parameter:</span></span>

```csharp
public void Test(string id)
{
    try
    {
        if (id == "none")
        {
            throw new Exception("Default Id detected.");
        }
    }
    catch (Exception ex)
    {
        _logger.LogWarning(
            AppLogEvents.Error, ex,
            "Failed to process iteration: {Id}", id)
    }
}
```

<span data-ttu-id="ab83e-292">O log de exceções é específico do provedor.</span><span class="sxs-lookup"><span data-stu-id="ab83e-292">Exception logging is provider-specific.</span></span>

### <a name="default-log-level"></a><span data-ttu-id="ab83e-293">Nível de log padrão</span><span class="sxs-lookup"><span data-stu-id="ab83e-293">Default log level</span></span>

<span data-ttu-id="ab83e-294">Se o nível de log padrão não for definido, o valor de nível de log padrão será `Information` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-294">If the default log level is not set, the default log level value is `Information`.</span></span>

<span data-ttu-id="ab83e-295">Por exemplo, considere o seguinte aplicativo de serviço de trabalho:</span><span class="sxs-lookup"><span data-stu-id="ab83e-295">For example, consider the following worker service app:</span></span>

- <span data-ttu-id="ab83e-296">Criado com os modelos de trabalho do .NET.</span><span class="sxs-lookup"><span data-stu-id="ab83e-296">Created with the .NET Worker templates.</span></span>
- <span data-ttu-id="ab83e-297">*appsettings.js* e *appsettings.Development.js* excluídos ou renomeados.</span><span class="sxs-lookup"><span data-stu-id="ab83e-297">*appsettings.json* and *appsettings.Development.json* deleted or renamed.</span></span>

<span data-ttu-id="ab83e-298">Com a configuração anterior, navegar até a privacidade ou home page produz muitas `Trace` `Debug` mensagens, e `Information`  com `Microsoft` no nome da categoria.</span><span class="sxs-lookup"><span data-stu-id="ab83e-298">With the preceding setup, navigating to the privacy or home page produces many `Trace`, `Debug`, and `Information`  messages with `Microsoft` in the category name.</span></span>

<span data-ttu-id="ab83e-299">O código a seguir define o nível de log padrão quando o nível de log padrão não está definido na configuração:</span><span class="sxs-lookup"><span data-stu-id="ab83e-299">The following code sets the default log level when the default log level is not set in configuration:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging(logging => logging.SetMinimumLevel(LogLevel.Warning));
}
```

### <a name="filter-function"></a><span data-ttu-id="ab83e-300">Função Filter</span><span class="sxs-lookup"><span data-stu-id="ab83e-300">Filter function</span></span>

<span data-ttu-id="ab83e-301">Uma função de filtro é invocada para todos os provedores e categorias que não têm regras atribuídas a eles por configuração ou código:</span><span class="sxs-lookup"><span data-stu-id="ab83e-301">A filter function is invoked for all providers and categories that don't have rules assigned to them by configuration or code:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging(logging =>
                logging.AddFilter((provider, category, logLevel) =>
                {
                    return provider.Contains("ConsoleLoggerProvider")
                        && (category.Contains("Example") || category.Contains("Microsoft"))
                        && logLevel >= LogLevel.Information;
                }));
}
```

<span data-ttu-id="ab83e-302">O código anterior exibe os logs do console quando a categoria contém `Example` ou `Microsoft` e o nível de log é `Information` ou superior.</span><span class="sxs-lookup"><span data-stu-id="ab83e-302">The preceding code displays console logs when the category contains `Example` or `Microsoft` and the log level is `Information` or higher.</span></span>

## <a name="log-scopes"></a><span data-ttu-id="ab83e-303">Escopos de log</span><span class="sxs-lookup"><span data-stu-id="ab83e-303">Log scopes</span></span>

 <span data-ttu-id="ab83e-304">Um *escopo* pode agrupar um conjunto de operações lógicas.</span><span class="sxs-lookup"><span data-stu-id="ab83e-304">A *scope* can group a set of logical operations.</span></span> <span data-ttu-id="ab83e-305">Esse agrupamento pode ser usado para anexar os mesmos dados para cada log criado como parte de um conjunto.</span><span class="sxs-lookup"><span data-stu-id="ab83e-305">This grouping can be used to attach the same data to each log that's created as part of a set.</span></span> <span data-ttu-id="ab83e-306">Por exemplo, todo log criado como parte do processamento de uma transação pode incluir a ID da transação.</span><span class="sxs-lookup"><span data-stu-id="ab83e-306">For example, every log created as part of processing a transaction can include the transaction ID.</span></span>

<span data-ttu-id="ab83e-307">Um escopo:</span><span class="sxs-lookup"><span data-stu-id="ab83e-307">A scope:</span></span>

- <span data-ttu-id="ab83e-308">É um <xref:System.IDisposable> tipo que é retornado pelo <xref:Microsoft.Extensions.Logging.ILogger.BeginScope%2A> método.</span><span class="sxs-lookup"><span data-stu-id="ab83e-308">Is an <xref:System.IDisposable> type that's returned by the <xref:Microsoft.Extensions.Logging.ILogger.BeginScope%2A> method.</span></span>
- <span data-ttu-id="ab83e-309">Dura até ser Descartado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-309">Lasts until it's disposed.</span></span>

<span data-ttu-id="ab83e-310">Os seguintes provedores dão suporte a escopos:</span><span class="sxs-lookup"><span data-stu-id="ab83e-310">The following providers support scopes:</span></span>

- `Console`
- [<span data-ttu-id="ab83e-311">AzureAppServicesFile e AzureAppServicesBlob</span><span class="sxs-lookup"><span data-stu-id="ab83e-311">AzureAppServicesFile and AzureAppServicesBlob</span></span>](xref:Microsoft.Extensions.Logging.AzureAppServices.BatchingLoggerOptions.IncludeScopes)

<span data-ttu-id="ab83e-312">Use um escopo por meio do encapsulamento de chamadas de agente em um bloco `using`:</span><span class="sxs-lookup"><span data-stu-id="ab83e-312">Use a scope by wrapping logger calls in a `using` block:</span></span>

```csharp
public async Task<T> GetAsync<T>(string id)
{
    T result;

    using (_logger.BeginScope("using block message"))
    {
        _logger.LogInformation(
            AppLogEvents.Read, "Reading value for {Id}", id);

        var result = await _repository.GetAsync(id);
        if (result is null)
        {
            _logger.LogWarning(
                AppLogEvents.ReadNotFound, "GetAsync({Id}) not found", id);
        }
    }

    return result;
}
```

<span data-ttu-id="ab83e-313">O JSON a seguir habilita os escopos para o provedor de console:</span><span class="sxs-lookup"><span data-stu-id="ab83e-313">The following JSON enables scopes for the console provider:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.IncludeScopes.json" highlight="9":::

<span data-ttu-id="ab83e-314">O código a seguir habilita os escopos para o provedor de console:</span><span class="sxs-lookup"><span data-stu-id="ab83e-314">The following code enables scopes for the console provider:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging((_, logging) =>
                logging.ClearProviders()
                    .AddConsole(options => options.IncludeScopes = true));
}
```

## <a name="non-host-console-app"></a><span data-ttu-id="ab83e-315">Aplicativo de console não host</span><span class="sxs-lookup"><span data-stu-id="ab83e-315">Non-host console app</span></span>

<span data-ttu-id="ab83e-316">O código de log para aplicativos sem um [host genérico](generic-host.md) difere na maneira como os [provedores são adicionados](logging-providers.md#built-in-logging-providers) e os [agentes são criados](#create-logs).</span><span class="sxs-lookup"><span data-stu-id="ab83e-316">Logging code for apps without a [Generic Host](generic-host.md) differs in the way [providers are added](logging-providers.md#built-in-logging-providers) and [loggers are created](#create-logs).</span></span> <span data-ttu-id="ab83e-317">Em um aplicativo de console não host, chame o método de extensão `Add{provider name}` do provedor ao criar um `LoggerFactory`:</span><span class="sxs-lookup"><span data-stu-id="ab83e-317">In a non-host console app, call the provider's `Add{provider name}` extension method while creating a `LoggerFactory`:</span></span>

```csharp
class Program
{
    static void Main(string[] args)
    {
        using var loggerFactory = LoggerFactory.Create(builder =>
        {
            builder
                .AddFilter("Microsoft", LogLevel.Warning)
                .AddFilter("System", LogLevel.Warning)
                .AddFilter("LoggingConsoleApp.Program", LogLevel.Debug)
                .AddConsole();
        });

        ILogger logger = loggerFactory.CreateLogger<Program>();
        logger.LogInformation("Example log message");
    }
}
```

<span data-ttu-id="ab83e-318">O `loggerFactory` objeto é usado para criar uma <xref:Microsoft.Extensions.Logging.ILogger> instância.</span><span class="sxs-lookup"><span data-stu-id="ab83e-318">The `loggerFactory` object is used to create an <xref:Microsoft.Extensions.Logging.ILogger> instance.</span></span>

## <a name="create-logs-in-main"></a><span data-ttu-id="ab83e-319">Criar logs no principal</span><span class="sxs-lookup"><span data-stu-id="ab83e-319">Create logs in Main</span></span>

<span data-ttu-id="ab83e-320">O código a seguir faz logon `Main` obtendo uma `ILogger` instância de di após a criação do host:</span><span class="sxs-lookup"><span data-stu-id="ab83e-320">The following code logs in `Main` by getting an `ILogger` instance from DI after building the host:</span></span>

```csharp
using System;
using System.Threading.Tasks;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;

class Program
{
    static Task Main(string[] args)
    {
        IHost host = Host.CreateDefaultBuilder(args).Build();

        var logger = host.Services.GetRequiredService<ILogger<Program>>();
        logger.LogInformation("Host created.");

        return host.RunAsync();
    }
}
```

### <a name="no-asynchronous-logger-methods"></a><span data-ttu-id="ab83e-321">Sem métodos de agente assíncronos</span><span class="sxs-lookup"><span data-stu-id="ab83e-321">No asynchronous logger methods</span></span>

<span data-ttu-id="ab83e-322">O registro em log deve ser tão rápido que não justifique o custo de desempenho de código assíncrono.</span><span class="sxs-lookup"><span data-stu-id="ab83e-322">Logging should be so fast that it isn't worth the performance cost of asynchronous code.</span></span> <span data-ttu-id="ab83e-323">Se um armazenamento de dados de log estiver lento, não grave-o diretamente.</span><span class="sxs-lookup"><span data-stu-id="ab83e-323">If a logging data store is slow, don't write to it directly.</span></span> <span data-ttu-id="ab83e-324">Considere gravar as mensagens de log em um repositório rápido inicialmente e, em seguida, movê-las para o armazenamento lento mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ab83e-324">Consider writing the log messages to a fast store initially, then moving them to the slow store later.</span></span> <span data-ttu-id="ab83e-325">Por exemplo, ao fazer logon no SQL Server, não faça isso diretamente em um `Log` método, pois os `Log` métodos são síncronos.</span><span class="sxs-lookup"><span data-stu-id="ab83e-325">For example, when logging to SQL Server, don't do so directly in a `Log` method, since the `Log` methods are synchronous.</span></span> <span data-ttu-id="ab83e-326">Em vez disso, adicione mensagens de log de forma síncrona a uma fila na memória e faça com que uma função de trabalho de plano de fundo efetue pull das mensagens para fora da fila para fazer o trabalho assíncrono de envio de dados por push para o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ab83e-326">Instead, synchronously add log messages to an in-memory queue and have a background worker pull the messages out of the queue to do the asynchronous work of pushing data to SQL Server.</span></span>

## <a name="change-log-levels-in-a-running-app"></a><span data-ttu-id="ab83e-327">Alterar os níveis de log em um aplicativo em execução</span><span class="sxs-lookup"><span data-stu-id="ab83e-327">Change log levels in a running app</span></span>

<span data-ttu-id="ab83e-328">A API de registro em log não inclui um cenário para alterar os níveis de log enquanto um aplicativo está em execução.</span><span class="sxs-lookup"><span data-stu-id="ab83e-328">The Logging API doesn't include a scenario to change log levels while an app is running.</span></span> <span data-ttu-id="ab83e-329">No entanto, alguns provedores de configuração são capazes de recarregar a configuração, o que exige um efeito imediato na configuração de log.</span><span class="sxs-lookup"><span data-stu-id="ab83e-329">However, some configuration providers are capable of reloading configuration, which takes immediate effect on logging configuration.</span></span> <span data-ttu-id="ab83e-330">Por exemplo, o [provedor de configuração de arquivo](configuration-providers.md#file-configuration-provider) recarrega a configuração de log por padrão.</span><span class="sxs-lookup"><span data-stu-id="ab83e-330">For example, the [File Configuration Provider](configuration-providers.md#file-configuration-provider) reloads logging configuration by default.</span></span> <span data-ttu-id="ab83e-331">Se a configuração for alterada no código enquanto um aplicativo estiver em execução, o aplicativo poderá chamar [IConfigurationRoot. recarregar](xref:Microsoft.Extensions.Configuration.IConfigurationRoot.Reload%2A) para atualizar a configuração de log do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ab83e-331">If configuration is changed in code while an app is running, the app can call [IConfigurationRoot.Reload](xref:Microsoft.Extensions.Configuration.IConfigurationRoot.Reload%2A) to update the app's logging configuration.</span></span>

## <a name="nuget-packages"></a><span data-ttu-id="ab83e-332">Pacotes NuGet</span><span class="sxs-lookup"><span data-stu-id="ab83e-332">NuGet packages</span></span>

<span data-ttu-id="ab83e-333">As <xref:Microsoft.Extensions.Logging.ILogger%601> <xref:Microsoft.Extensions.Logging.ILoggerFactory> interfaces e implementações são incluídas no SDK do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="ab83e-333">The <xref:Microsoft.Extensions.Logging.ILogger%601> and <xref:Microsoft.Extensions.Logging.ILoggerFactory> interfaces and implementations are included in the .NET Core SDK.</span></span> <span data-ttu-id="ab83e-334">Eles também estão disponíveis nos seguintes pacotes NuGet:</span><span class="sxs-lookup"><span data-stu-id="ab83e-334">They are also available in the following NuGet packages:</span></span>

- <span data-ttu-id="ab83e-335">As interfaces estão em [Microsoft. Extensions. Logging. abstrações](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Abstractions).</span><span class="sxs-lookup"><span data-stu-id="ab83e-335">The interfaces are in [Microsoft.Extensions.Logging.Abstractions](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Abstractions).</span></span>
- <span data-ttu-id="ab83e-336">As implementações padrão estão em [Microsoft. Extensions. Logging](https://www.nuget.org/packages/microsoft.extensions.logging).</span><span class="sxs-lookup"><span data-stu-id="ab83e-336">The default implementations are in [Microsoft.Extensions.Logging](https://www.nuget.org/packages/microsoft.extensions.logging).</span></span>

## <a name="apply-log-filter-rules-in-code"></a><span data-ttu-id="ab83e-337">Aplicar regras de filtro de log no código</span><span class="sxs-lookup"><span data-stu-id="ab83e-337">Apply log filter rules in code</span></span>

<span data-ttu-id="ab83e-338">A abordagem preferida para definir regras de filtro de log é usando a [configuração](configuration.md)do.</span><span class="sxs-lookup"><span data-stu-id="ab83e-338">The preferred approach for setting log filter rules is by using [Configuration](configuration.md).</span></span>

<span data-ttu-id="ab83e-339">O exemplo a seguir mostra como registrar regras de filtro no código:</span><span class="sxs-lookup"><span data-stu-id="ab83e-339">The following example shows how to register filter rules in code:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging(logging =>
               logging.AddFilter("System", LogLevel.Debug)
                  .AddFilter<DebugLoggerProvider>("Microsoft", LogLevel.Information)
                  .AddFilter<ConsoleLoggerProvider>("Microsoft", LogLevel.Trace));
}
```

<span data-ttu-id="ab83e-340">`logging.AddFilter("System", LogLevel.Debug)` Especifica a `System` categoria e o nível de log `Debug` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-340">`logging.AddFilter("System", LogLevel.Debug)` specifies the `System` category and log level `Debug`.</span></span> <span data-ttu-id="ab83e-341">O filtro é aplicado a todos os provedores porque um provedor específico não foi configurado.</span><span class="sxs-lookup"><span data-stu-id="ab83e-341">The filter is applied to all providers because a specific provider was not configured.</span></span>

<span data-ttu-id="ab83e-342">`AddFilter<DebugLoggerProvider>("Microsoft", LogLevel.Information)` especificado</span><span class="sxs-lookup"><span data-stu-id="ab83e-342">`AddFilter<DebugLoggerProvider>("Microsoft", LogLevel.Information)` specifies:</span></span>

- <span data-ttu-id="ab83e-343">O `Debug` provedor de log.</span><span class="sxs-lookup"><span data-stu-id="ab83e-343">The `Debug` logging provider.</span></span>
- <span data-ttu-id="ab83e-344">Nível `Information` de log e superior.</span><span class="sxs-lookup"><span data-stu-id="ab83e-344">Log level `Information` and higher.</span></span>
- <span data-ttu-id="ab83e-345">Todas as categorias que começam com `"Microsoft"` .</span><span class="sxs-lookup"><span data-stu-id="ab83e-345">All categories starting with `"Microsoft"`.</span></span>

## <a name="see-also"></a><span data-ttu-id="ab83e-346">Confira também</span><span class="sxs-lookup"><span data-stu-id="ab83e-346">See also</span></span>

- [<span data-ttu-id="ab83e-347">Provedores de log no .NET</span><span class="sxs-lookup"><span data-stu-id="ab83e-347">Logging providers in .NET</span></span>](logging-providers.md)
- [<span data-ttu-id="ab83e-348">Implementar um provedor de log personalizado no .NET</span><span class="sxs-lookup"><span data-stu-id="ab83e-348">Implement a custom logging provider in .NET</span></span>](custom-logging-provider.md)
- [<span data-ttu-id="ab83e-349">Formatação de log de console</span><span class="sxs-lookup"><span data-stu-id="ab83e-349">Console log formatting</span></span>](console-log-formatter.md)
- [<span data-ttu-id="ab83e-350">Registro em log de alto desempenho no .NET</span><span class="sxs-lookup"><span data-stu-id="ab83e-350">High-performance logging in .NET</span></span>](high-performance-logging.md)
- <span data-ttu-id="ab83e-351">Os bugs de log devem ser criados no repositório [github.com/dotnet/Extensions](https://github.com/dotnet/extensions/issues)</span><span class="sxs-lookup"><span data-stu-id="ab83e-351">Logging bugs should be created in the [github.com/dotnet/extensions](https://github.com/dotnet/extensions/issues) repo</span></span>
