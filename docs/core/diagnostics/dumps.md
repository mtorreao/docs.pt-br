---
title: Despejos-.NET
description: Uma introdução a despejos no .NET.
ms.date: 10/12/2020
ms.openlocfilehash: 7a4c7bf54b3e9ea43e685eafbd00b4a373326520
ms.sourcegitcommit: c0b803bffaf101e12f071faf94ca21b46d04ff30
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/24/2020
ms.locfileid: "97764936"
---
# <a name="dumps"></a><span data-ttu-id="108e8-103">Despejos</span><span class="sxs-lookup"><span data-stu-id="108e8-103">Dumps</span></span>

<span data-ttu-id="108e8-104">Um despejo é um arquivo que contém um instantâneo do processo no momento em que ele foi criado e pode ser útil para examinar o estado do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="108e8-104">A dump is a file that contains a snapshot of the process at the time it was created and can be useful for examining the state of your application.</span></span> <span data-ttu-id="108e8-105">Os despejos podem ser usados para depurar seu aplicativo .NET quando é difícil anexar um depurador a ele, como ambientes de produção ou de CI.</span><span class="sxs-lookup"><span data-stu-id="108e8-105">Dumps can be used to debug your .NET application when it is difficult to attach a debugger to it such as production or CI environments.</span></span> <span data-ttu-id="108e8-106">O uso de despejos permite capturar o estado do processo problemático e examiná-lo sem a necessidade de parar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="108e8-106">Using dumps allows you to capture the state of the problematic process and examine it without having to stop the application.</span></span>

## <a name="collect-dumps"></a><span data-ttu-id="108e8-107">Coletar despejos</span><span class="sxs-lookup"><span data-stu-id="108e8-107">Collect dumps</span></span>

<span data-ttu-id="108e8-108">Os despejos podem ser coletados de diversas maneiras, dependendo de em qual plataforma você está executando seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="108e8-108">Dumps can be collected in a variety of ways depending on which platform you are running your app on.</span></span>

> [!NOTE]
> <span data-ttu-id="108e8-109">A coleta de um despejo dentro de um contêiner requer o recurso PTRACE, que pode ser adicionado via `--cap-add=SYS_PTRACE` ou `--privileged` .</span><span class="sxs-lookup"><span data-stu-id="108e8-109">Collecting a dump inside a container requires PTRACE capability, which can be added via `--cap-add=SYS_PTRACE` or `--privileged`.</span></span>

> [!NOTE]
> <span data-ttu-id="108e8-110">Os despejos podem conter informações confidenciais, pois podem conter a memória total do processo em execução.</span><span class="sxs-lookup"><span data-stu-id="108e8-110">Dumps may contain sensitive information because they can contain the full memory of the running process.</span></span> <span data-ttu-id="108e8-111">Lide com as restrições de segurança e as orientações em mente.</span><span class="sxs-lookup"><span data-stu-id="108e8-111">Handle them with any security restrictions and guidances in mind.</span></span>

### <a name="collecting-dumps-on-crash"></a><span data-ttu-id="108e8-112">Coletando despejos na falha</span><span class="sxs-lookup"><span data-stu-id="108e8-112">Collecting dumps on crash</span></span>

<span data-ttu-id="108e8-113">Você pode usar variáveis de ambiente para configurar seu aplicativo para coletar um despejo após uma falha.</span><span class="sxs-lookup"><span data-stu-id="108e8-113">You can use environment variables to configure your application to collect a dump upon a crash.</span></span> <span data-ttu-id="108e8-114">Isso é útil quando você deseja entender por que ocorreu uma falha.</span><span class="sxs-lookup"><span data-stu-id="108e8-114">This is helpful when you want to get an understanding of why a crash happened.</span></span> <span data-ttu-id="108e8-115">Por exemplo, capturar um despejo quando uma exceção é gerada ajuda a identificar um problema examinando o estado do aplicativo quando ele falhou.</span><span class="sxs-lookup"><span data-stu-id="108e8-115">For example, capturing a dump when an exception is thrown helps you identify an issue by examining the state of the app when it crashed.</span></span>

<span data-ttu-id="108e8-116">A tabela a seguir mostra as variáveis de ambiente que você pode configurar para coletar despejos em uma falha.</span><span class="sxs-lookup"><span data-stu-id="108e8-116">The following table shows the environment variables you can configure for collecting dumps on a crash.</span></span>

|<span data-ttu-id="108e8-117">Variável de ambiente</span><span class="sxs-lookup"><span data-stu-id="108e8-117">Environment variable</span></span>|<span data-ttu-id="108e8-118">Descrição</span><span class="sxs-lookup"><span data-stu-id="108e8-118">Description</span></span>|<span data-ttu-id="108e8-119">Valor padrão</span><span class="sxs-lookup"><span data-stu-id="108e8-119">Default value</span></span>|
|-------|---------|---|
|`COMPlus_DbgEnableMiniDump`|<span data-ttu-id="108e8-120">Se definido como 1, habilite a geração de despejo principal.</span><span class="sxs-lookup"><span data-stu-id="108e8-120">If set to 1, enable core dump generation.</span></span>|<span data-ttu-id="108e8-121">0</span><span class="sxs-lookup"><span data-stu-id="108e8-121">0</span></span>|
|`COMPlus_DbgMiniDumpType`|<span data-ttu-id="108e8-122">Tipo de despejo a ser coletado.</span><span class="sxs-lookup"><span data-stu-id="108e8-122">Type of dump to be collected.</span></span> <span data-ttu-id="108e8-123">Para obter mais informações, consulte a tabela abaixo</span><span class="sxs-lookup"><span data-stu-id="108e8-123">For more information, see the table below</span></span>|<span data-ttu-id="108e8-124">2 ( `MiniDumpWithPrivateReadWriteMemory` )</span><span class="sxs-lookup"><span data-stu-id="108e8-124">2 (`MiniDumpWithPrivateReadWriteMemory`)</span></span>|
|`COMPlus_DbgMiniDumpName`|<span data-ttu-id="108e8-125">Caminho para um arquivo no qual gravar o despejo.</span><span class="sxs-lookup"><span data-stu-id="108e8-125">Path to a file to write the dump to.</span></span>|`/tmp/coredump.<pid>`|
|`COMPlus_CreateDumpDiagnostics`|<span data-ttu-id="108e8-126">Se definido como 1, habilite o log de diagnóstico do processo de despejo.</span><span class="sxs-lookup"><span data-stu-id="108e8-126">If set to 1, enable diagnostic logging of dump process.</span></span>|<span data-ttu-id="108e8-127">0</span><span class="sxs-lookup"><span data-stu-id="108e8-127">0</span></span>|

<span data-ttu-id="108e8-128">A tabela a seguir mostra todas as opções que podem ser usadas para `COMPlus_DbgMiniDumpType` que possam ser especificadas como um valor.</span><span class="sxs-lookup"><span data-stu-id="108e8-128">The table below shows all the options you may use for `COMPlus_DbgMiniDumpType` which can be specified as a value.</span></span> <span data-ttu-id="108e8-129">Por exemplo, definir `COMPlus_DbgMiniDumpType` como 1 significa que `MiniDumpNormal` o despejo de tipo será coletado em uma falha.</span><span class="sxs-lookup"><span data-stu-id="108e8-129">For example, setting `COMPlus_DbgMiniDumpType` to 1 means `MiniDumpNormal` type dump will be collected on a crash.</span></span>

|<span data-ttu-id="108e8-130">Valor</span><span class="sxs-lookup"><span data-stu-id="108e8-130">Value</span></span>|<span data-ttu-id="108e8-131">Nome</span><span class="sxs-lookup"><span data-stu-id="108e8-131">Name</span></span>|<span data-ttu-id="108e8-132">Descrição</span><span class="sxs-lookup"><span data-stu-id="108e8-132">Description</span></span>|
|-----|----|-----------|
|<span data-ttu-id="108e8-133">1</span><span class="sxs-lookup"><span data-stu-id="108e8-133">1</span></span>|`MiniDumpNormal`|<span data-ttu-id="108e8-134">Inclua apenas as informações necessárias para capturar rastreamentos de pilha para todos os threads existentes em um processo.</span><span class="sxs-lookup"><span data-stu-id="108e8-134">Include just the information necessary to capture stack traces for all existing threads in a process.</span></span> <span data-ttu-id="108e8-135">Memória e informações de heap de GC limitadas.</span><span class="sxs-lookup"><span data-stu-id="108e8-135">Limited GC heap memory and information.</span></span>|
|<span data-ttu-id="108e8-136">2</span><span class="sxs-lookup"><span data-stu-id="108e8-136">2</span></span>|`MiniDumpWithPrivateReadWriteMemory`|<span data-ttu-id="108e8-137">Inclui os heaps do GC e as informações necessárias para capturar rastreamentos de pilha para todos os threads existentes em um processo.</span><span class="sxs-lookup"><span data-stu-id="108e8-137">Includes the GC heaps and information necessary to capture stack traces for all existing threads in a process.</span></span>|
|<span data-ttu-id="108e8-138">3</span><span class="sxs-lookup"><span data-stu-id="108e8-138">3</span></span>|`MiniDumpFilterTriage`|<span data-ttu-id="108e8-139">Inclua apenas as informações necessárias para capturar rastreamentos de pilha para todos os threads existentes em um processo.</span><span class="sxs-lookup"><span data-stu-id="108e8-139">Include just the information necessary to capture stack traces for all existing threads in a process.</span></span> <span data-ttu-id="108e8-140">Memória e informações de heap de GC limitadas.</span><span class="sxs-lookup"><span data-stu-id="108e8-140">Limited GC heap memory and information.</span></span>|
|<span data-ttu-id="108e8-141">4</span><span class="sxs-lookup"><span data-stu-id="108e8-141">4</span></span>|`MiniDumpWithFullMemory`|<span data-ttu-id="108e8-142">Inclua toda a memória acessível no processo.</span><span class="sxs-lookup"><span data-stu-id="108e8-142">Include all accessible memory in the process.</span></span> <span data-ttu-id="108e8-143">Os dados brutos da memória são incluídos no final, para que as estruturas iniciais possam ser mapeadas diretamente sem as informações de memória bruta.</span><span class="sxs-lookup"><span data-stu-id="108e8-143">The raw memory data is included at the end, so that the initial structures can be mapped directly without the raw memory information.</span></span> <span data-ttu-id="108e8-144">Essa opção pode resultar em um arquivo muito grande.</span><span class="sxs-lookup"><span data-stu-id="108e8-144">This option can result in a very large file.</span></span>|

### <a name="collecting-dumps-at-specific-point-in-time"></a><span data-ttu-id="108e8-145">Coletando despejos em um momento específico</span><span class="sxs-lookup"><span data-stu-id="108e8-145">Collecting dumps at specific point in time</span></span>

<span data-ttu-id="108e8-146">Talvez você queira coletar um despejo quando o aplicativo ainda não tiver falhado.</span><span class="sxs-lookup"><span data-stu-id="108e8-146">You may want to collect a dump when the app hasn't crashed yet.</span></span> <span data-ttu-id="108e8-147">Por exemplo, se você quiser examinar o estado de um aplicativo que parece estar em um deadlock, a configuração das variáveis de ambiente para coletar despejos na falha não será útil porque o aplicativo ainda está em execução.</span><span class="sxs-lookup"><span data-stu-id="108e8-147">For example, if you want to examine the state of an application that seems to be in a deadlock, configuring the environment variables to collect dumps on crash will not be helpful because the app is still running.</span></span>

<span data-ttu-id="108e8-148">Para coletar o despejo em sua própria solicitação, você pode usar o `dotnet-dump` , que é uma ferramenta CLI para coletar e analisar despejos.</span><span class="sxs-lookup"><span data-stu-id="108e8-148">To collect dump at your own request, you can use `dotnet-dump`, which is a CLI tool for collecting and analyzing dumps.</span></span> <span data-ttu-id="108e8-149">Para obter mais informações sobre como usá-lo para coletar despejos com o `dotnet-dump` , consulte [dump Collection and Analysis Utility](dotnet-dump.md).</span><span class="sxs-lookup"><span data-stu-id="108e8-149">For more information on how to use it to collect dumps with `dotnet-dump`, see [Dump collection and analysis utility](dotnet-dump.md).</span></span>

## <a name="analyze-dumps"></a><span data-ttu-id="108e8-150">Analisar despejos</span><span class="sxs-lookup"><span data-stu-id="108e8-150">Analyze dumps</span></span>

<span data-ttu-id="108e8-151">Você pode anlayze despejos usando a [`dotnet-dump`](dotnet-dump.md) ferramenta CLI ou com o [Visual Studio](https://docs.microsoft.com/visualstudio/debugger/using-dump-files).</span><span class="sxs-lookup"><span data-stu-id="108e8-151">You can anlayze dumps using the [`dotnet-dump`](dotnet-dump.md) CLI tool or with [Visual Studio](https://docs.microsoft.com/visualstudio/debugger/using-dump-files).</span></span>

> [!NOTE]
> <span data-ttu-id="108e8-152">O Visual Studio versão 16,8 e posterior permite que você [abra despejos do Linux](https://devblogs.microsoft.com/visualstudio/linux-managed-memory-dump-debugging/) gerados no .NET Core 3.1.7 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="108e8-152">Visual Studio version 16.8 and later allows you to [open Linux dumps](https://devblogs.microsoft.com/visualstudio/linux-managed-memory-dump-debugging/) generated on .NET Core 3.1.7 or later.</span></span>  

> [!NOTE]
> <span data-ttu-id="108e8-153">Se a depuração nativa for necessária, a [extensão do depurador SOS](sos-debugging-extension.md) poderá ser usada com [LLDB no Linux e no MacOS](debug-linux-dumps.md#analyze-dumps-on-linux).</span><span class="sxs-lookup"><span data-stu-id="108e8-153">If native debugging is necessary, the [SOS debugger extension](sos-debugging-extension.md) can be used with [LLDB on Linux and macOS](debug-linux-dumps.md#analyze-dumps-on-linux).</span></span> <span data-ttu-id="108e8-154">O SOS também tem suporte com o [windbg/CDB](/windows-hardware/drivers/debugger/debugger-download-tools) no Windows, embora o Visual Studio seja recomendado.</span><span class="sxs-lookup"><span data-stu-id="108e8-154">SOS is also supported with [Windbg/cdb](/windows-hardware/drivers/debugger/debugger-download-tools) on Windows, although Visual Studio is recommended.</span></span>

## <a name="see-also"></a><span data-ttu-id="108e8-155">Veja também</span><span class="sxs-lookup"><span data-stu-id="108e8-155">See also</span></span>

<span data-ttu-id="108e8-156">Saiba mais sobre como você pode aproveitar os despejos para ajudar a diagnosticar problemas em seu aplicativo .NET.</span><span class="sxs-lookup"><span data-stu-id="108e8-156">Learn more about how you can leverage dumps to help diagnosing problems in your .NET application.</span></span>

* <span data-ttu-id="108e8-157">O tutorial [depurar despejos do Linux](debug-linux-dumps.md) orienta você sobre como depurar um despejo que foi coletado no Linux.</span><span class="sxs-lookup"><span data-stu-id="108e8-157">[Debug Linux dumps](debug-linux-dumps.md) tutorial walks you through how to debug a dump that was collected in Linux.</span></span>

* <span data-ttu-id="108e8-158">Tutorial de [depuração de deadlock](debug-deadlock.md) orienta você sobre como depurar um deadlock em seu aplicativo .NET usando despejos.</span><span class="sxs-lookup"><span data-stu-id="108e8-158">[Debug deadlock](debug-deadlock.md) tutorial walks you through how to debug a deadlock in your .NET application using dumps.</span></span>
