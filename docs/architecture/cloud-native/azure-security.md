---
title: Segurança do Azure para aplicativos nativos de nuvem
description: Arquitetando aplicativos .NET nativos da nuvem para o Azure | Segurança do Azure para aplicativos nativos de nuvem
ms.date: 12/01/2020
ms.openlocfilehash: 5e541606c762ea192ab8767e78e9b7346b3ec9c1
ms.sourcegitcommit: 2f485e721f7f34b87856a51181b5b56624b31fd5
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/02/2020
ms.locfileid: "96509813"
---
# <a name="azure-security-for-cloud-native-apps"></a><span data-ttu-id="01cc6-103">Segurança do Azure para aplicativos nativos de nuvem</span><span class="sxs-lookup"><span data-stu-id="01cc6-103">Azure security for cloud-native apps</span></span>

<span data-ttu-id="01cc6-104">Os aplicativos nativos de nuvem podem ser mais fáceis e difíceis de proteger do que os aplicativos tradicionais.</span><span class="sxs-lookup"><span data-stu-id="01cc6-104">Cloud-native applications can be both easier and more difficult to secure than traditional applications.</span></span> <span data-ttu-id="01cc6-105">Na desvantagem, você precisa proteger aplicativos mais menores e dedicar mais energia para criar a infraestrutura de segurança.</span><span class="sxs-lookup"><span data-stu-id="01cc6-105">On the downside, you need to secure more smaller applications and dedicate more energy to build out the security infrastructure.</span></span> <span data-ttu-id="01cc6-106">A natureza heterogênea de linguagens de programação e estilos na maioria das implantações de serviço também significa que você precisa prestar mais atenção aos boletins de segurança de vários provedores diferentes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-106">The heterogeneous nature of programming languages and styles in most service deployments also means you need to pay more attention to security bulletins from many different providers.</span></span>

<span data-ttu-id="01cc6-107">No lado do inverso, serviços menores, cada um com seu próprio armazenamento de dados, limitam o escopo de um ataque.</span><span class="sxs-lookup"><span data-stu-id="01cc6-107">On the flip side, smaller services, each with their own data store, limit the scope of an attack.</span></span> <span data-ttu-id="01cc6-108">Se um invasor comprometer um sistema, provavelmente será mais difícil para o invasor fazer o salto para outro sistema do que ele está em um aplicativo monolítico.</span><span class="sxs-lookup"><span data-stu-id="01cc6-108">If an attacker compromises one system, it's probably more difficult for the attacker to make the jump to another system than it is in a monolithic application.</span></span> <span data-ttu-id="01cc6-109">Limites de processo são limites fortes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-109">Process boundaries are strong boundaries.</span></span> <span data-ttu-id="01cc6-110">Além disso, se um backup de banco de dados for exposto, o dano será mais limitado, pois esse banco de dado conterá apenas um subconjunto e provavelmente conterá dados pessoais.</span><span class="sxs-lookup"><span data-stu-id="01cc6-110">Also, if a database backup gets exposed, then the damage is more limited, as that database contains only a subset of data and is unlikely to contain personal data.</span></span>

## <a name="threat-modeling"></a><span data-ttu-id="01cc6-111">Modelagem de ameaças</span><span class="sxs-lookup"><span data-stu-id="01cc6-111">Threat modeling</span></span>

<span data-ttu-id="01cc6-112">Não importa se as vantagens superam as desvantagens dos aplicativos nativos de nuvem, a mesma mentalidade de segurança holística deve ser seguida.</span><span class="sxs-lookup"><span data-stu-id="01cc6-112">No matter if the advantages outweigh the disadvantages of cloud-native applications, the same holistic security mindset must be followed.</span></span> <span data-ttu-id="01cc6-113">A segurança e o pensamento seguro devem fazer parte de cada etapa da história de desenvolvimento e de operações.</span><span class="sxs-lookup"><span data-stu-id="01cc6-113">Security and secure thinking must be part of every step of the development and operations story.</span></span> <span data-ttu-id="01cc6-114">Ao planejar um aplicativo, faça perguntas como:</span><span class="sxs-lookup"><span data-stu-id="01cc6-114">When planning an application ask questions like:</span></span>

- <span data-ttu-id="01cc6-115">Qual seria o impacto dessa perda de dados?</span><span class="sxs-lookup"><span data-stu-id="01cc6-115">What would be the impact of this data being lost?</span></span>
- <span data-ttu-id="01cc6-116">Como é possível limitar os danos dos dados inválidos que estão sendo injetados nesse serviço?</span><span class="sxs-lookup"><span data-stu-id="01cc6-116">How can we limit the damage from bad data being injected into this service?</span></span>
- <span data-ttu-id="01cc6-117">Quem deve ter acesso a esses dados?</span><span class="sxs-lookup"><span data-stu-id="01cc6-117">Who should have access to this data?</span></span>
- <span data-ttu-id="01cc6-118">Há políticas de auditoria em vigor em relação ao processo de desenvolvimento e versão?</span><span class="sxs-lookup"><span data-stu-id="01cc6-118">Are there auditing policies in place around the development and release process?</span></span>

<span data-ttu-id="01cc6-119">Todas essas perguntas fazem parte de um processo chamado [modelagem de ameaças](/azure/security/azure-security-threat-modeling-tool).</span><span class="sxs-lookup"><span data-stu-id="01cc6-119">All these questions are part of a process called [threat modeling](/azure/security/azure-security-threat-modeling-tool).</span></span> <span data-ttu-id="01cc6-120">Esse processo tenta responder à pergunta de quais ameaças existem no sistema, quão prováveis são as ameaças e os possíveis danos deles.</span><span class="sxs-lookup"><span data-stu-id="01cc6-120">This process tries to answer the question of what threats there are to the system, how likely the threats are, and the potential damage from them.</span></span>

<span data-ttu-id="01cc6-121">Depois que a lista de ameaças tiver sido estabelecida, você precisará decidir se vale a pena mitigar.</span><span class="sxs-lookup"><span data-stu-id="01cc6-121">Once the list of threats has been established, you need to decide whether they're worth mitigating.</span></span> <span data-ttu-id="01cc6-122">Às vezes, uma ameaça é tão improvável e dispendiosa de planejar que não vale a pena gastar energia.</span><span class="sxs-lookup"><span data-stu-id="01cc6-122">Sometimes a threat is so unlikely and expensive to plan for that it isn't worth spending energy on it.</span></span> <span data-ttu-id="01cc6-123">Por exemplo, algum ator de nível de Estado poderia injetar alterações no design de um processo que é usado por milhões de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-123">For instance, some state level actor could inject changes into the design of a process that is used by millions of devices.</span></span> <span data-ttu-id="01cc6-124">Agora, em vez de executar um determinado trecho de código no [anel 3](https://en.wikipedia.org/wiki/Protection_ring), esse código é executado no anel 0.</span><span class="sxs-lookup"><span data-stu-id="01cc6-124">Now, instead of running a certain piece of code in [Ring 3](https://en.wikipedia.org/wiki/Protection_ring), that code is run in Ring 0.</span></span> <span data-ttu-id="01cc6-125">Esse processo permite uma exploração que pode ignorar o hipervisor e executar o código de ataque nos computadores bare-metal, permitindo ataques em todas as máquinas virtuais em execução nesse hardware.</span><span class="sxs-lookup"><span data-stu-id="01cc6-125">This process allows an exploit that can bypass the hypervisor and run the attack code on the bare metal machines, allowing attacks on all the virtual machines that are running on that hardware.</span></span>

<span data-ttu-id="01cc6-126">Os processadores alterados são difíceis de detectar sem uma vigiados e um conhecimento avançado do design de silício do processador.</span><span class="sxs-lookup"><span data-stu-id="01cc6-126">The altered processors are difficult to detect without a microscope and advanced knowledge of the on silicon design of that processor.</span></span> <span data-ttu-id="01cc6-127">Esse cenário é improvável de ocorrer e caro de atenuar, portanto, provavelmente nenhum modelo de ameaça recomendaria criar proteção de exploração para ele.</span><span class="sxs-lookup"><span data-stu-id="01cc6-127">This scenario is unlikely to happen and expensive to mitigate, so probably no threat model would recommend building exploit protection for it.</span></span>

<span data-ttu-id="01cc6-128">As ameaças mais prováveis, como controles de acesso desfeitos que permitam `Id` a incrementação de ataques (substituindo `Id=2` com `Id=3` na URL) ou injeção de SQL, são mais atraentes para a criação de proteções.</span><span class="sxs-lookup"><span data-stu-id="01cc6-128">More likely threats, such as broken access controls permitting `Id` incrementing attacks (replacing `Id=2` with `Id=3` in the URL) or SQL injection, are more attractive to build protections against.</span></span> <span data-ttu-id="01cc6-129">As mitigações para essas ameaças são bastante razoáveis para criar e evitar brechas de segurança constrangedoras que mancham a reputação da empresa.</span><span class="sxs-lookup"><span data-stu-id="01cc6-129">The mitigations for these threats are quite reasonable to build and prevent embarrassing security holes that smear the company's reputation.</span></span>

## <a name="principle-of-least-privilege"></a><span data-ttu-id="01cc6-130">Princípio de privilégios mínimos</span><span class="sxs-lookup"><span data-stu-id="01cc6-130">Principle of least privilege</span></span>

<span data-ttu-id="01cc6-131">Uma das ideias encontradas na segurança do computador é o princípio de privilégios mínimos (POLP).</span><span class="sxs-lookup"><span data-stu-id="01cc6-131">One of the founding ideas in computer security is the Principle of Least Privilege (POLP).</span></span> <span data-ttu-id="01cc6-132">Na verdade, é uma ideia fundamental na maioria das formas de segurança ser digital ou física.</span><span class="sxs-lookup"><span data-stu-id="01cc6-132">It's actually a foundational idea in most any form of security be it digital or physical.</span></span> <span data-ttu-id="01cc6-133">Em suma, o princípio é que qualquer usuário ou processo deve ter o menor número de direitos possíveis para executar sua tarefa.</span><span class="sxs-lookup"><span data-stu-id="01cc6-133">In short, the principle is that any user or process should have the smallest number of rights possible to execute its task.</span></span>

<span data-ttu-id="01cc6-134">Como exemplo, imagine os informativos em um banco: o acesso à segurança é uma atividade incomum.</span><span class="sxs-lookup"><span data-stu-id="01cc6-134">As an example, think of the tellers at a bank: accessing the safe is an uncommon activity.</span></span> <span data-ttu-id="01cc6-135">Portanto, a forma média não pode abrir a própria segurança.</span><span class="sxs-lookup"><span data-stu-id="01cc6-135">So, the average teller can't open the safe themselves.</span></span> <span data-ttu-id="01cc6-136">Para obter acesso, eles precisam escalonar sua solicitação por meio de um gerente bancário, que realiza verificações de segurança adicionais.</span><span class="sxs-lookup"><span data-stu-id="01cc6-136">To gain access, they need to escalate their request through a bank manager, who performs additional security checks.</span></span>

<span data-ttu-id="01cc6-137">Em um sistema de computador, um exemplo fantástico é o direito de um usuário se conectar a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-137">In a computer system, a fantastic example is the rights of a user connecting to a database.</span></span> <span data-ttu-id="01cc6-138">Em muitos casos, há uma única conta de usuário usada para compilar a estrutura do banco de dados e executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="01cc6-138">In many cases, there's a single user account used to both build the database structure and run the application.</span></span> <span data-ttu-id="01cc6-139">Exceto em casos extremos, a conta que executa o aplicativo não precisa da capacidade de atualizar informações de esquema.</span><span class="sxs-lookup"><span data-stu-id="01cc6-139">Except in extreme cases, the account running the application doesn't need the ability to update schema information.</span></span> <span data-ttu-id="01cc6-140">Deve haver várias contas que forneçam níveis de privilégio diferentes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-140">There should be several accounts that provide different levels of privilege.</span></span> <span data-ttu-id="01cc6-141">O aplicativo deve usar apenas o nível de permissão que concede acesso de leitura e gravação aos dados nas tabelas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-141">The application should only use the permission level that grants read and writes access to the data in the tables.</span></span> <span data-ttu-id="01cc6-142">Esse tipo de proteção elimina ataques que visavam descartar tabelas de bancos de dados ou introduzir gatilhos mal-intencionados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-142">This kind of protection would eliminate attacks that aimed to drop database tables or introduce malicious triggers.</span></span>

<span data-ttu-id="01cc6-143">Quase todas as partes da criação de um aplicativo nativo de nuvem podem se beneficiar da memorização do princípio de privilégios mínimos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-143">Almost every part of building a cloud-native application can benefit from remembering the principle of least privilege.</span></span> <span data-ttu-id="01cc6-144">Você pode encontrá-lo em jogo ao configurar firewalls, grupos de segurança de rede, funções e escopos no RBAC (controle de acesso baseado em função).</span><span class="sxs-lookup"><span data-stu-id="01cc6-144">You can find it at play when setting up firewalls, network security groups, roles, and scopes in Role-based access control (RBAC).</span></span>

## <a name="penetration-testing"></a><span data-ttu-id="01cc6-145">Teste de penetração</span><span class="sxs-lookup"><span data-stu-id="01cc6-145">Penetration testing</span></span>

<span data-ttu-id="01cc6-146">À medida que os aplicativos se tornam mais complicados, o número de vetores de ataque aumenta em uma taxa alarmante.</span><span class="sxs-lookup"><span data-stu-id="01cc6-146">As applications become more complicated the number of attack vectors increases at an alarming rate.</span></span> <span data-ttu-id="01cc6-147">A modelagem de ameaças tem falhas no que tende a ser executada pelas mesmas pessoas que estão compilando o sistema.</span><span class="sxs-lookup"><span data-stu-id="01cc6-147">Threat modeling is flawed in that it tends to be executed by the same people building the system.</span></span> <span data-ttu-id="01cc6-148">Da mesma forma que muitos desenvolvedores têm problemas para prever as interações do usuário e, em seguida, criar interfaces de usuário inutilizáveis, a maioria dos desenvolvedores tem dificuldade em ver cada vetor de ataque.</span><span class="sxs-lookup"><span data-stu-id="01cc6-148">In the same way that many developers have trouble envisioning user interactions and then build unusable user interfaces, most developers have difficulty seeing every attack vector.</span></span> <span data-ttu-id="01cc6-149">Também é possível que os desenvolvedores que criam o sistema não estejam bem familiarizados com metodologias de ataque e percam algo crucial.</span><span class="sxs-lookup"><span data-stu-id="01cc6-149">It's also possible that the developers building the system aren't well versed in attack methodologies and miss something crucial.</span></span>

<span data-ttu-id="01cc6-150">Teste de penetração ou "teste de caneta" envolve trazer atores externos para tentar atacar o sistema.</span><span class="sxs-lookup"><span data-stu-id="01cc6-150">Penetration testing or "pen testing" involves bringing in external actors to attempt to attack the system.</span></span> <span data-ttu-id="01cc6-151">Esses invasores podem ser uma empresa de consultoria externa ou outros desenvolvedores com um bom conhecimento de segurança de outra parte do negócio.</span><span class="sxs-lookup"><span data-stu-id="01cc6-151">These attackers may be an external consulting company or other developers with good security knowledge from another part of the business.</span></span> <span data-ttu-id="01cc6-152">Eles recebem Blanche carte para tentar subverter o sistema.</span><span class="sxs-lookup"><span data-stu-id="01cc6-152">They're given carte blanche to attempt to subvert the system.</span></span> <span data-ttu-id="01cc6-153">Frequentemente, eles encontrarão grandes buracos de segurança que precisam ser corrigidos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-153">Frequently, they'll find extensive security holes that need to be patched.</span></span> <span data-ttu-id="01cc6-154">Às vezes, o vetor de ataque será algo totalmente inesperado, como explorar um ataque de phishing contra o CEO.</span><span class="sxs-lookup"><span data-stu-id="01cc6-154">Sometimes the attack vector will be something totally unexpected like exploiting a phishing attack against the CEO.</span></span>

<span data-ttu-id="01cc6-155">O Azure em si está constantemente passando por ataques de uma [equipe de hackers dentro da Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span><span class="sxs-lookup"><span data-stu-id="01cc6-155">Azure itself is constantly undergoing attacks from a [team of hackers inside Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span> <span data-ttu-id="01cc6-156">Ao longo dos anos, eles foram os primeiros a encontrar dezenas de vetores de ataque potencialmente catastróficos, fechando-os antes que possam ser explorados externamente.</span><span class="sxs-lookup"><span data-stu-id="01cc6-156">Over the years, they've been the first to find dozens of potentially catastrophic attack vectors, closing them before they can be exploited externally.</span></span> <span data-ttu-id="01cc6-157">Quanto mais tentador for um destino, mais provável que os atores eternas tentarão explorá-lo e que há alguns destinos no mundo mais tentadores do que o Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-157">The more tempting a target, the more likely that eternal actors will attempt to exploit it and there are a few targets in the world more tempting than Azure.</span></span>

## <a name="monitoring"></a><span data-ttu-id="01cc6-158">Monitoramento</span><span class="sxs-lookup"><span data-stu-id="01cc6-158">Monitoring</span></span>

<span data-ttu-id="01cc6-159">Se um invasor tentar penetrar em um aplicativo, deve haver algum aviso.</span><span class="sxs-lookup"><span data-stu-id="01cc6-159">Should an attacker attempt to penetrate an application, there should be some warning of it.</span></span> <span data-ttu-id="01cc6-160">Frequentemente, os ataques podem ser exportados examinando os logs dos serviços.</span><span class="sxs-lookup"><span data-stu-id="01cc6-160">Frequently, attacks can be spotted by examining the logs from services.</span></span> <span data-ttu-id="01cc6-161">Os ataques deixam os sinais de indícios que podem ser excedidos antes de terem sucesso.</span><span class="sxs-lookup"><span data-stu-id="01cc6-161">Attacks leave telltale signs that can be spotted before they succeed.</span></span> <span data-ttu-id="01cc6-162">Por exemplo, um invasor tentando adivinhar uma senha fará muitas solicitações em um sistema de logon.</span><span class="sxs-lookup"><span data-stu-id="01cc6-162">For instance, an attacker attempting to guess a password will make many requests to a login system.</span></span> <span data-ttu-id="01cc6-163">O monitoramento em torno do sistema de logon pode detectar padrões estranhos que estão fora de linha com o padrão de acesso típico.</span><span class="sxs-lookup"><span data-stu-id="01cc6-163">Monitoring around the login system can detect weird patterns that are out of line with the typical access pattern.</span></span> <span data-ttu-id="01cc6-164">Esse monitoramento pode ser transformado em um alerta que pode, por sua vez, alertar uma pessoa de operações para ativar algum tipo de contramedida.</span><span class="sxs-lookup"><span data-stu-id="01cc6-164">This monitoring can be turned into an alert that can, in turn, alert an operations person to activate some sort of countermeasure.</span></span> <span data-ttu-id="01cc6-165">Um sistema de monitoramento altamente maduro pode até tomar medidas com base nesses desvios, adicionando regras proativamente para bloquear solicitações ou limitar respostas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-165">A highly mature monitoring system might even take action based on these deviations proactively adding rules to block requests or throttle responses.</span></span>

## <a name="securing-the-build"></a><span data-ttu-id="01cc6-166">Protegendo a compilação</span><span class="sxs-lookup"><span data-stu-id="01cc6-166">Securing the build</span></span>

<span data-ttu-id="01cc6-167">Um local em que a segurança é muitas vezes ignorada em relação ao processo de compilação.</span><span class="sxs-lookup"><span data-stu-id="01cc6-167">One place where security is often overlooked is around the build process.</span></span> <span data-ttu-id="01cc6-168">O Build não só deve executar verificações de segurança, como a verificação de código inseguro ou credenciais com check-in, mas a compilação em si deve ser segura.</span><span class="sxs-lookup"><span data-stu-id="01cc6-168">Not only should the build run security checks, such as scanning for insecure code or checked-in credentials, but the build itself should be secure.</span></span> <span data-ttu-id="01cc6-169">Se o servidor de compilação estiver comprometido, ele fornecerá um vetor fantástico para introduzir código arbitrário no produto.</span><span class="sxs-lookup"><span data-stu-id="01cc6-169">If the build server is compromised, then it provides a fantastic vector for introducing arbitrary code into the product.</span></span>

<span data-ttu-id="01cc6-170">Imagine que um invasor esteja procurando roubar as senhas de pessoas que se conectam a um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="01cc6-170">Imagine that an attacker is looking to steal the passwords of people signing into a web application.</span></span> <span data-ttu-id="01cc6-171">Eles poderiam introduzir uma etapa de compilação que modifica o código com check-out para espelhar qualquer solicitação de logon para outro servidor.</span><span class="sxs-lookup"><span data-stu-id="01cc6-171">They could introduce a build step that modifies the checked-out code to mirror any login request to another server.</span></span> <span data-ttu-id="01cc6-172">Na próxima vez que o código passar pela compilação, ele será atualizado silenciosamente.</span><span class="sxs-lookup"><span data-stu-id="01cc6-172">The next time code goes through the build, it's silently updated.</span></span> <span data-ttu-id="01cc6-173">A verificação de vulnerabilidades do código-fonte não detectará essa vulnerabilidade à medida que ela for executada antes da compilação.</span><span class="sxs-lookup"><span data-stu-id="01cc6-173">The source code vulnerability scanning won't catch this vulnerability as it runs before the build.</span></span> <span data-ttu-id="01cc6-174">Igualmente, ninguém vai capturá-lo em uma revisão de código porque as etapas de compilação residem no servidor de compilação.</span><span class="sxs-lookup"><span data-stu-id="01cc6-174">Equally, nobody will catch it in a code review because the build steps live on the build server.</span></span> <span data-ttu-id="01cc6-175">O código explorado vai para a produção onde ele pode coletar senhas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-175">The exploited code will go to production where it can harvest passwords.</span></span> <span data-ttu-id="01cc6-176">Provavelmente, não há nenhum log de auditoria das alterações do processo de compilação ou pelo menos ninguém monitorando a auditoria.</span><span class="sxs-lookup"><span data-stu-id="01cc6-176">Probably there's no audit log of the build process changes, or at least nobody monitoring the audit.</span></span>

<span data-ttu-id="01cc6-177">Esse cenário é um exemplo perfeito de um destino aparentemente de valor baixo que pode ser usado para dividir o sistema.</span><span class="sxs-lookup"><span data-stu-id="01cc6-177">This scenario is a perfect example of a seemingly low-value target that can be used to break into the system.</span></span> <span data-ttu-id="01cc6-178">Quando um invasor viola o perímetro do sistema, ele pode começar a trabalhar com a localização de maneiras de elevar suas permissões até o ponto que elas podem causar danos reais em qualquer lugar.</span><span class="sxs-lookup"><span data-stu-id="01cc6-178">Once an attacker breaches the perimeter of the system, they can start working on finding ways to elevate their permissions to the point that they can cause real harm anywhere they like.</span></span>

## <a name="building-secure-code"></a><span data-ttu-id="01cc6-179">Compilando código seguro</span><span class="sxs-lookup"><span data-stu-id="01cc6-179">Building secure code</span></span>

<span data-ttu-id="01cc6-180">.NET Framework já é uma estrutura bastante segura.</span><span class="sxs-lookup"><span data-stu-id="01cc6-180">.NET Framework is already a quite secure framework.</span></span> <span data-ttu-id="01cc6-181">Ele evita algumas das armadilhas de código não gerenciado, como a retirada das extremidades das matrizes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-181">It avoids some of the pitfalls of unmanaged code, such as walking off the ends of arrays.</span></span> <span data-ttu-id="01cc6-182">O trabalho é realizado ativamente para corrigir brechas de segurança à medida que são descobertos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-182">Work is actively done to fix security holes as they're discovered.</span></span> <span data-ttu-id="01cc6-183">Há até mesmo um [programa de Bounty de bugs](https://www.microsoft.com/msrc/bounty) que paga pesquisadores para encontrar problemas na estrutura e relatá-los em vez de explorá-los.</span><span class="sxs-lookup"><span data-stu-id="01cc6-183">There's even a [bug bounty program](https://www.microsoft.com/msrc/bounty) that pays researchers to find issues in the framework and report them instead of exploiting them.</span></span>

<span data-ttu-id="01cc6-184">Há muitas maneiras de tornar o código .NET mais seguro.</span><span class="sxs-lookup"><span data-stu-id="01cc6-184">There are many ways to make .NET code more secure.</span></span> <span data-ttu-id="01cc6-185">As diretrizes a seguir, como o artigo [diretrizes de codificação de segurança para .net](../../standard/security/secure-coding-guidelines.md) , são uma etapa razoável para garantir que o código seja protegido do zero.</span><span class="sxs-lookup"><span data-stu-id="01cc6-185">Following guidelines such as the [Secure coding guidelines for .NET](../../standard/security/secure-coding-guidelines.md) article is a reasonable step to take to ensure that the code is secure from the ground up.</span></span> <span data-ttu-id="01cc6-186">O [OWASP Top 10](https://owasp.org/www-project-top-ten/) é outro guia inestimável para criar código seguro.</span><span class="sxs-lookup"><span data-stu-id="01cc6-186">The [OWASP top 10](https://owasp.org/www-project-top-ten/) is another invaluable guide to build secure code.</span></span>

<span data-ttu-id="01cc6-187">O processo de compilação é um bom lugar para colocar as ferramentas de verificação para detectar problemas no código-fonte antes de colocá-lo em produção.</span><span class="sxs-lookup"><span data-stu-id="01cc6-187">The build process is a good place to put scanning tools to detect problems in source code before they make it into production.</span></span> <span data-ttu-id="01cc6-188">A maioria de cada projeto tem dependências em alguns outros pacotes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-188">Most every project has dependencies on some other packages.</span></span> <span data-ttu-id="01cc6-189">Uma ferramenta que pode examinar pacotes desatualizados detectará problemas em uma compilação noturna.</span><span class="sxs-lookup"><span data-stu-id="01cc6-189">A tool that can scan for outdated packages will catch problems in a nightly build.</span></span> <span data-ttu-id="01cc6-190">Mesmo ao criar imagens do Docker, é útil verificar e garantir que a imagem base não tenha vulnerabilidades conhecidas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-190">Even when building Docker images, it's useful to check and make sure that the base image doesn't have known vulnerabilities.</span></span> <span data-ttu-id="01cc6-191">Outra coisa a ser verificada é que ninguém verificou as credenciais acidentalmente.</span><span class="sxs-lookup"><span data-stu-id="01cc6-191">Another thing to check is that nobody has accidentally checked in credentials.</span></span>

## <a name="built-in-security"></a><span data-ttu-id="01cc6-192">Segurança interna</span><span class="sxs-lookup"><span data-stu-id="01cc6-192">Built-in security</span></span>

<span data-ttu-id="01cc6-193">O Azure foi projetado para balancear a usabilidade e a segurança para a maioria dos usuários.</span><span class="sxs-lookup"><span data-stu-id="01cc6-193">Azure is designed to balance usability and security for the majority of users.</span></span> <span data-ttu-id="01cc6-194">Diferentes usuários terão requisitos de segurança diferentes e, portanto, precisarão ajustar sua abordagem à segurança da nuvem.</span><span class="sxs-lookup"><span data-stu-id="01cc6-194">Different users are going to have different security requirements, so they need to fine-tune their approach to cloud security.</span></span> <span data-ttu-id="01cc6-195">A Microsoft publica uma grande quantidade de informações de segurança na [central de confiabilidade](https://azure.microsoft.com/support/trust-center/).</span><span class="sxs-lookup"><span data-stu-id="01cc6-195">Microsoft publishes a great deal of security information in the [Trust Center](https://azure.microsoft.com/support/trust-center/).</span></span> <span data-ttu-id="01cc6-196">Esse recurso deve ser a primeira parada para os profissionais interessados em entender como funcionam as tecnologias internas de mitigação de ataques.</span><span class="sxs-lookup"><span data-stu-id="01cc6-196">This resource should be the first stop for those professionals interested in understanding how the built-in attack mitigation technologies work.</span></span>

<span data-ttu-id="01cc6-197">No portal do Azure, o assistente [do Azure](https://azure.microsoft.com/services/advisor/) é um sistema que está verificando constantemente um ambiente e fazendo recomendações.</span><span class="sxs-lookup"><span data-stu-id="01cc6-197">Within the Azure portal, the [Azure Advisor](https://azure.microsoft.com/services/advisor/) is a system that is constantly scanning an environment and making recommendations.</span></span> <span data-ttu-id="01cc6-198">Algumas dessas recomendações foram projetadas para economizar dinheiro dos usuários, mas outras são projetadas para identificar configurações potencialmente inseguras, como ter um contêiner de armazenamento aberto para o mundo e não protegidas por uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="01cc6-198">Some of these recommendations are designed to save users money, but others are designed to identify potentially insecure configurations, such as having a storage container open to the world and not protected by a Virtual Network.</span></span>

## <a name="azure-network-infrastructure"></a><span data-ttu-id="01cc6-199">Infraestrutura de rede do Azure</span><span class="sxs-lookup"><span data-stu-id="01cc6-199">Azure network infrastructure</span></span>

<span data-ttu-id="01cc6-200">Em um ambiente de implantação local, uma grande quantidade de energia é dedicada à configuração da rede.</span><span class="sxs-lookup"><span data-stu-id="01cc6-200">In an on-premises deployment environment, a great deal of energy is dedicated to setting up networking.</span></span> <span data-ttu-id="01cc6-201">Configurar roteadores, comutadores e, como tal, é um trabalho complicado.</span><span class="sxs-lookup"><span data-stu-id="01cc6-201">Setting up routers, switches, and the such is complicated work.</span></span> <span data-ttu-id="01cc6-202">As redes permitem que determinados recursos se comuniquem com outros recursos e impeçam o acesso em alguns casos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-202">Networks allow certain resources to talk to other resources and prevent access in some cases.</span></span> <span data-ttu-id="01cc6-203">Uma regra de rede frequente é restringir o acesso ao ambiente de produção do ambiente de desenvolvimento por meio da possibilidade de que uma parte de código desenvolvida pela metade seja executada errado e exclua um lançamento de dados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-203">A frequent network rule is to restrict access to the production environment from the development environment on the off chance that a half-developed piece of code runs awry and deletes a swath of data.</span></span>

<span data-ttu-id="01cc6-204">Na caixa, a maioria dos recursos de PaaS do Azure tem apenas a configuração de rede mais básica e permissiva.</span><span class="sxs-lookup"><span data-stu-id="01cc6-204">Out of the box, most PaaS Azure resources have only the most basic and permissive networking setup.</span></span> <span data-ttu-id="01cc6-205">Por exemplo, qualquer pessoa na Internet pode acessar um serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="01cc6-205">For instance, anybody on the Internet can access an app service.</span></span> <span data-ttu-id="01cc6-206">Novas instâncias de SQL Server normalmente vêm restritas, para que as partes externas não possam acessá-las, mas os intervalos de endereços IP usados pelo próprio Azure são permitidos por meio do.</span><span class="sxs-lookup"><span data-stu-id="01cc6-206">New SQL Server instances typically come restricted, so that external parties can't access them, but the IP address ranges used by Azure itself are permitted through.</span></span> <span data-ttu-id="01cc6-207">Portanto, embora o SQL Server seja protegido contra ameaças externas, um invasor só precisa configurar um bridgehead do Azure do qual eles podem iniciar ataques em todas as instâncias do SQL no Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-207">So, while the SQL server is protected from external threats, an attacker only needs to set up an Azure bridgehead from where they can launch attacks against all SQL instances on Azure.</span></span>

<span data-ttu-id="01cc6-208">Felizmente, a maioria dos recursos do Azure pode ser colocada em uma rede virtual do Azure que permite o controle de acesso refinado.</span><span class="sxs-lookup"><span data-stu-id="01cc6-208">Fortunately, most Azure resources can be placed into an Azure Virtual Network that allows fine-grained access control.</span></span> <span data-ttu-id="01cc6-209">De forma semelhante à maneira como as redes locais estabelecem redes privadas que são protegidas do mundo mais amplo, as redes virtuais são ilhas de endereços IP privados localizados na rede do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-209">Similar to the way that on-premises networks establish private networks that are protected from the wider world, virtual networks are islands of private IP addresses that are located within the Azure network.</span></span>

![Figura 9-1 uma rede virtual no Azure](./media/virtual-network.png)

<span data-ttu-id="01cc6-211">**Figura 9-1**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-211">**Figure 9-1**.</span></span> <span data-ttu-id="01cc6-212">Uma rede virtual no Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-212">A virtual network in Azure.</span></span>

<span data-ttu-id="01cc6-213">Da mesma forma que as redes locais têm um firewall que rege o acesso à rede, você pode estabelecer um firewall semelhante no limite da rede virtual.</span><span class="sxs-lookup"><span data-stu-id="01cc6-213">In the same way that on-premises networks have a firewall governing access to the network, you can establish a similar firewall at the boundary of the virtual network.</span></span> <span data-ttu-id="01cc6-214">Por padrão, todos os recursos em uma rede virtual ainda podem se comunicar com a Internet.</span><span class="sxs-lookup"><span data-stu-id="01cc6-214">By default, all the resources on a virtual network can still talk to the Internet.</span></span> <span data-ttu-id="01cc6-215">São apenas conexões de entrada que exigem alguma forma de exceção de firewall explícita.</span><span class="sxs-lookup"><span data-stu-id="01cc6-215">It's only incoming connections that require some form of explicit firewall exception.</span></span>

<span data-ttu-id="01cc6-216">Com a rede estabelecida, recursos internos, como contas de armazenamento, podem ser configurados para permitir apenas o acesso por recursos que também estão na rede virtual.</span><span class="sxs-lookup"><span data-stu-id="01cc6-216">With the network established, internal resources like storage accounts can be set up to only allow for access by resources that are also on the Virtual Network.</span></span> <span data-ttu-id="01cc6-217">Esse firewall fornece um nível extra de segurança, caso as chaves dessa conta de armazenamento sejam vazadas, os invasores não conseguirão se conectar a ela para explorar as chaves vazadas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-217">This firewall provides an extra level of security, should the keys for that storage account be leaked, attackers wouldn't be able to connect to it to exploit the leaked keys.</span></span> <span data-ttu-id="01cc6-218">Esse cenário é outro exemplo do princípio de privilégios mínimos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-218">This scenario is another example of the principle of least privilege.</span></span>

<span data-ttu-id="01cc6-219">Os nós em um cluster kubernetes do Azure podem participar de uma rede virtual, assim como outros recursos mais nativos do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-219">The nodes in an Azure Kubernetes cluster can participate in a virtual network just like other resources that are more native to Azure.</span></span> <span data-ttu-id="01cc6-220">Essa funcionalidade é chamada de [interface de rede de contêiner do Azure](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span><span class="sxs-lookup"><span data-stu-id="01cc6-220">This functionality is called [Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span></span> <span data-ttu-id="01cc6-221">Na verdade, ele aloca uma sub-rede dentro da rede virtual na qual as máquinas virtuais e as imagens de contêiner são distribuídas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-221">In effect, it allocates a subnet within the virtual network on which virtual machines and container images are allocated.</span></span>

<span data-ttu-id="01cc6-222">Continuando o caminho para ilustrar o princípio de menos privilégios, nem todos os recursos em uma rede virtual precisam se comunicar com todos os outros recursos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-222">Continuing down the path of illustrating the principle of least privilege, not every resource within a Virtual Network needs to talk to every other resource.</span></span> <span data-ttu-id="01cc6-223">Por exemplo, em um aplicativo que fornece uma API Web em uma conta de armazenamento e um banco de dados SQL, é improvável que o banco de dados e a conta de armazenamento precisem se comunicar entre si.</span><span class="sxs-lookup"><span data-stu-id="01cc6-223">For instance, in an application that provides a web API over a storage account and a SQL database, it's unlikely that the database and the storage account need to talk to one another.</span></span> <span data-ttu-id="01cc6-224">Qualquer compartilhamento de dados entre eles passaria pelo aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="01cc6-224">Any data sharing between them would go through the web application.</span></span> <span data-ttu-id="01cc6-225">Assim, um [NSG (grupo de segurança de rede)](/azure/virtual-network/security-overview) poderia ser usado para negar o tráfego entre os dois serviços.</span><span class="sxs-lookup"><span data-stu-id="01cc6-225">So, a [network security group (NSG)](/azure/virtual-network/security-overview) could be used to deny traffic between the two services.</span></span>

<span data-ttu-id="01cc6-226">Uma política de negação de comunicação entre recursos pode ser irritante de ser implementada, especialmente proveniente de uma experiência de uso do Azure sem restrições de tráfego.</span><span class="sxs-lookup"><span data-stu-id="01cc6-226">A policy of denying communication between resources can be annoying to implement, especially coming from a background of using Azure without traffic restrictions.</span></span> <span data-ttu-id="01cc6-227">Em algumas outras nuvens, o conceito de grupos de segurança de rede é muito mais predominante.</span><span class="sxs-lookup"><span data-stu-id="01cc6-227">On some other clouds, the concept of network security groups is much more prevalent.</span></span> <span data-ttu-id="01cc6-228">Por exemplo, a política padrão em AWS é que os recursos não podem se comunicar entre si até serem habilitados por regras em um NSG.</span><span class="sxs-lookup"><span data-stu-id="01cc6-228">For instance, the default policy on AWS is that resources can't communicate among themselves until enabled by rules in an NSG.</span></span> <span data-ttu-id="01cc6-229">Embora seja mais lento para desenvolver isso, um ambiente mais restritivo fornece um padrão mais seguro.</span><span class="sxs-lookup"><span data-stu-id="01cc6-229">While slower to develop this, a more restrictive environment provides a more secure default.</span></span> <span data-ttu-id="01cc6-230">Fazer uso de práticas DevOps adequadas, especialmente usando [Azure Resource Manager ou Terraform](infrastructure-as-code.md) para gerenciar permissões pode facilitar o controle das regras.</span><span class="sxs-lookup"><span data-stu-id="01cc6-230">Making use of proper DevOps practices, especially using [Azure Resource Manager or Terraform](infrastructure-as-code.md) to manage permissions can make controlling the rules easier.</span></span>

<span data-ttu-id="01cc6-231">As redes virtuais também podem ser úteis ao configurar a comunicação entre recursos locais e na nuvem.</span><span class="sxs-lookup"><span data-stu-id="01cc6-231">Virtual Networks can also be useful when setting up communication between on-premises and cloud resources.</span></span> <span data-ttu-id="01cc6-232">Uma rede virtual privada pode ser usada para conectar diretamente as duas redes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-232">A virtual private network can be used to seamlessly attach the two networks together.</span></span> <span data-ttu-id="01cc6-233">Essa abordagem permite a execução de uma rede virtual sem qualquer tipo de gateway para cenários em que todos os usuários estejam no local.</span><span class="sxs-lookup"><span data-stu-id="01cc6-233">This approach allows running a virtual network without any sort of gateway for scenarios where all the users are on-site.</span></span> <span data-ttu-id="01cc6-234">Há várias tecnologias que podem ser usadas para estabelecer essa rede.</span><span class="sxs-lookup"><span data-stu-id="01cc6-234">There are a number of technologies that can be used to establish this network.</span></span> <span data-ttu-id="01cc6-235">A mais simples é usar uma [VPN site a site](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#s2smulti) que possa ser estabelecida entre vários roteadores e o Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-235">The simplest is to use a [site-to-site VPN](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#s2smulti) that can be established between many routers and Azure.</span></span> <span data-ttu-id="01cc6-236">O tráfego é criptografado e encapsulado pela Internet no mesmo custo por byte que qualquer outro tráfego.</span><span class="sxs-lookup"><span data-stu-id="01cc6-236">Traffic is encrypted and tunneled over the Internet at the same cost per byte as any other traffic.</span></span> <span data-ttu-id="01cc6-237">Para cenários em que mais largura de banda ou mais segurança são desejáveis, o Azure oferece um serviço chamado [rota expressa](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#ExpressRoute) que usa um circuito privado entre uma rede local e o Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-237">For scenarios where more bandwidth or more security is desirable, Azure offers a service called [Express Route](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#ExpressRoute) that uses a private circuit between an on-premises network and Azure.</span></span> <span data-ttu-id="01cc6-238">É mais dispendioso e difícil de estabelecer, mas também mais seguro.</span><span class="sxs-lookup"><span data-stu-id="01cc6-238">It's more costly and difficult to establish but also more secure.</span></span>

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a><span data-ttu-id="01cc6-239">Controle de acesso baseado em função para restringir o acesso aos recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="01cc6-239">Role-based access control for restricting access to Azure resources</span></span>

<span data-ttu-id="01cc6-240">O RBAC é um sistema que fornece uma identidade para aplicativos em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-240">RBAC is a system that provides an identity to applications running in Azure.</span></span> <span data-ttu-id="01cc6-241">Os aplicativos podem acessar recursos usando essa identidade em vez de ou além de usar chaves ou senhas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-241">Applications can access resources using this identity instead of or in addition to using keys or passwords.</span></span>

## <a name="security-principals"></a><span data-ttu-id="01cc6-242">Entidades de segurança</span><span class="sxs-lookup"><span data-stu-id="01cc6-242">Security Principals</span></span>

<span data-ttu-id="01cc6-243">O primeiro componente no RBAC é uma entidade de segurança.</span><span class="sxs-lookup"><span data-stu-id="01cc6-243">The first component in RBAC is a security principal.</span></span> <span data-ttu-id="01cc6-244">Uma entidade de segurança pode ser um usuário, grupo, entidade de serviço ou identidade gerenciada.</span><span class="sxs-lookup"><span data-stu-id="01cc6-244">A security principal can be a user, group, service principal, or managed identity.</span></span>

![Figura 9-2 tipos diferentes de entidades de segurança](./media/rbac-security-principal.png)

<span data-ttu-id="01cc6-246">**Figura 9-2**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-246">**Figure 9-2**.</span></span> <span data-ttu-id="01cc6-247">Tipos diferentes de entidades de segurança.</span><span class="sxs-lookup"><span data-stu-id="01cc6-247">Different types of security principals.</span></span>

- <span data-ttu-id="01cc6-248">Usuário-qualquer usuário que tenha uma conta no Azure Active Directory é um usuário.</span><span class="sxs-lookup"><span data-stu-id="01cc6-248">User - Any user who has an account in Azure Active Directory is a user.</span></span>
- <span data-ttu-id="01cc6-249">Grupo-uma coleção de usuários de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="01cc6-249">Group - A collection of users from Azure Active Directory.</span></span> <span data-ttu-id="01cc6-250">Como membro de um grupo, um usuário assume as funções desse grupo, além de seus próprios.</span><span class="sxs-lookup"><span data-stu-id="01cc6-250">As a member of a group, a user takes on the roles of that group in addition to their own.</span></span>
- <span data-ttu-id="01cc6-251">Entidade de serviço-uma identidade de segurança na qual os serviços ou aplicativos são executados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-251">Service principal - A security identity under which services or applications run.</span></span>
- <span data-ttu-id="01cc6-252">Identidade gerenciada-uma identidade de Azure Active Directory gerenciada pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-252">Managed identity - An Azure Active Directory identity managed by Azure.</span></span> <span data-ttu-id="01cc6-253">Identidades gerenciadas são normalmente usadas ao desenvolver aplicativos de nuvem que gerenciam as credenciais para autenticação nos serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-253">Managed identities are typically used when developing cloud applications that manage the credentials for authenticating to Azure services.</span></span>

<span data-ttu-id="01cc6-254">A entidade de segurança pode ser aplicada à maioria dos recursos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-254">The security principal can be applied to most any resource.</span></span> <span data-ttu-id="01cc6-255">Isso significa que é possível atribuir uma entidade de segurança a um contêiner em execução no Azure kubernetes, permitindo que ele acesse os segredos armazenados no Key Vault.</span><span class="sxs-lookup"><span data-stu-id="01cc6-255">This means that it's possible to assign a security principal to a container running within Azure Kubernetes, allowing it to access secrets stored in Key Vault.</span></span> <span data-ttu-id="01cc6-256">Uma função do Azure pode assumir uma permissão que permite que ele se comunique com uma instância de Active Directory para validar um JWT para um usuário de chamada.</span><span class="sxs-lookup"><span data-stu-id="01cc6-256">An Azure Function could take on a permission allowing it to talk to an Active Directory instance to validate a JWT for a calling user.</span></span> <span data-ttu-id="01cc6-257">Depois que os serviços são habilitados com uma entidade de serviço, suas permissões podem ser gerenciadas de maneira granular usando funções e escopos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-257">Once services are enabled with a service principal, their permissions can be managed granularly using roles and scopes.</span></span>

## <a name="roles"></a><span data-ttu-id="01cc6-258">Funções</span><span class="sxs-lookup"><span data-stu-id="01cc6-258">Roles</span></span>

<span data-ttu-id="01cc6-259">Uma entidade de segurança pode assumir muitas funções ou, usando uma analogia mais sartorial, ter muitas chapéus.</span><span class="sxs-lookup"><span data-stu-id="01cc6-259">A security principal can take on many roles or, using a more sartorial analogy, wear many hats.</span></span> <span data-ttu-id="01cc6-260">Cada função define uma série de permissões, como "ler mensagens do ponto de extremidade do barramento de serviço do Azure".</span><span class="sxs-lookup"><span data-stu-id="01cc6-260">Each role defines a series of permissions such as "Read messages from Azure Service Bus endpoint".</span></span> <span data-ttu-id="01cc6-261">O conjunto de permissões efetivas de uma entidade de segurança é a combinação de todas as permissões atribuídas a todas as funções que uma entidade de segurança tem.</span><span class="sxs-lookup"><span data-stu-id="01cc6-261">The effective permission set of a security principal is the combination of all the permissions assigned to all the roles that a security principal has.</span></span> <span data-ttu-id="01cc6-262">O Azure tem um grande número de funções internas e os usuários podem definir suas próprias funções.</span><span class="sxs-lookup"><span data-stu-id="01cc6-262">Azure has a large number of built-in roles and users can define their own roles.</span></span>

![Figura 9-3 definições de função do RBAC](./media/rbac-role-definition.png)

<span data-ttu-id="01cc6-264">**Figura 9-3**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-264">**Figure 9-3**.</span></span> <span data-ttu-id="01cc6-265">Definições de função RBAC.</span><span class="sxs-lookup"><span data-stu-id="01cc6-265">RBAC role definitions.</span></span>

<span data-ttu-id="01cc6-266">O integrado ao Azure também é uma série de funções de alto nível, como proprietário, colaborador, leitor e administrador de conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="01cc6-266">Built into Azure are also a number of high-level roles such as Owner, Contributor, Reader, and User Account Administrator.</span></span> <span data-ttu-id="01cc6-267">Com a função de proprietário, uma entidade de segurança pode acessar todos os recursos e atribuir permissões a outros.</span><span class="sxs-lookup"><span data-stu-id="01cc6-267">With the Owner role, a security principal can access all resources and assign permissions to others.</span></span> <span data-ttu-id="01cc6-268">Um colaborador tem o mesmo nível de acesso a todos os recursos, mas não pode atribuir permissões.</span><span class="sxs-lookup"><span data-stu-id="01cc6-268">A contributor has the same level of access to all resources but they can't assign permissions.</span></span> <span data-ttu-id="01cc6-269">Um leitor só pode exibir recursos existentes do Azure e um administrador de conta de usuário pode gerenciar o acesso aos recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-269">A Reader can only view existing Azure resources and a User Account Administrator can manage access to Azure resources.</span></span>

<span data-ttu-id="01cc6-270">Funções internas mais granulares, como [colaborador de zona DNS](/azure/role-based-access-control/built-in-roles#dns-zone-contributor) , têm direitos limitados a um único serviço.</span><span class="sxs-lookup"><span data-stu-id="01cc6-270">More granular built-in roles such as [DNS Zone Contributor](/azure/role-based-access-control/built-in-roles#dns-zone-contributor) have rights limited to a single service.</span></span> <span data-ttu-id="01cc6-271">As entidades de segurança podem assumir qualquer número de funções.</span><span class="sxs-lookup"><span data-stu-id="01cc6-271">Security principals can take on any number of roles.</span></span>

## <a name="scopes"></a><span data-ttu-id="01cc6-272">Escopos</span><span class="sxs-lookup"><span data-stu-id="01cc6-272">Scopes</span></span>

<span data-ttu-id="01cc6-273">As funções podem ser aplicadas a um conjunto restrito de recursos no Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-273">Roles can be applied to a restricted set of resources within Azure.</span></span> <span data-ttu-id="01cc6-274">Por exemplo, aplicando o escopo ao exemplo anterior de leitura de uma fila do barramento de serviço, você pode restringir a permissão a uma única fila: "ler mensagens do ponto de extremidade do barramento de serviço do Azure `blah.servicebus.windows.net/queue1` "</span><span class="sxs-lookup"><span data-stu-id="01cc6-274">For instance, applying scope to the previous example of reading from a Service Bus queue, you can narrow the permission to a single queue: "Read messages from Azure Service Bus endpoint `blah.servicebus.windows.net/queue1`"</span></span>

<span data-ttu-id="01cc6-275">O escopo pode ser tão estreito quanto um único recurso ou pode ser aplicado a um grupo de recursos, assinatura ou até mesmo grupo de gerenciamento inteiro.</span><span class="sxs-lookup"><span data-stu-id="01cc6-275">The scope can be as narrow as a single resource or it can be applied to an entire resource group, subscription, or even management group.</span></span>

<span data-ttu-id="01cc6-276">Ao testar se uma entidade de segurança tem determinada permissão, a combinação de função e escopo é levada em conta.</span><span class="sxs-lookup"><span data-stu-id="01cc6-276">When testing if a security principal has certain permission, the combination of role and scope are taken into account.</span></span> <span data-ttu-id="01cc6-277">Essa combinação fornece um poderoso mecanismo de autorização.</span><span class="sxs-lookup"><span data-stu-id="01cc6-277">This combination provides a powerful authorization mechanism.</span></span>

## <a name="deny"></a><span data-ttu-id="01cc6-278">Negar</span><span class="sxs-lookup"><span data-stu-id="01cc6-278">Deny</span></span>

<span data-ttu-id="01cc6-279">Anteriormente, apenas as regras "Allow" eram permitidas para o RBAC.</span><span class="sxs-lookup"><span data-stu-id="01cc6-279">Previously, only "allow" rules were permitted for RBAC.</span></span> <span data-ttu-id="01cc6-280">Esse comportamento fez com que alguns escopos sejam complicados de criar.</span><span class="sxs-lookup"><span data-stu-id="01cc6-280">This behavior made some scopes complicated to build.</span></span> <span data-ttu-id="01cc6-281">Por exemplo, permitir acesso de entidade de segurança a todas as contas de armazenamento, exceto uma necessária, concedendo permissão explícita a uma lista potencialmente infinita de contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="01cc6-281">For instance, allowing a security principal access to all storage accounts except one required granting explicit permission to a potentially endless list of storage accounts.</span></span> <span data-ttu-id="01cc6-282">Toda vez que uma nova conta de armazenamento foi criada, ela teria que ser adicionada a essa lista de contas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-282">Every time a new storage account was created, it would have to be added to this list of accounts.</span></span> <span data-ttu-id="01cc6-283">Essa sobrecarga de gerenciamento adicional que certamente não era desejável.</span><span class="sxs-lookup"><span data-stu-id="01cc6-283">This added management overhead that certainly wasn't desirable.</span></span>

<span data-ttu-id="01cc6-284">As regras de negação têm precedência sobre regras de permissão.</span><span class="sxs-lookup"><span data-stu-id="01cc6-284">Deny rules take precedence over allow rules.</span></span> <span data-ttu-id="01cc6-285">Agora que representa o mesmo escopo "permitir todos, exceto um", pode ser representado como duas regras "permitir tudo" e "negar esta específica".</span><span class="sxs-lookup"><span data-stu-id="01cc6-285">Now representing the same "allow all but one" scope could be represented as two rules "allow all" and "deny this one specific one".</span></span> <span data-ttu-id="01cc6-286">As regras de negação não apenas facilitam o gerenciamento, mas permitem recursos que são mais seguros, negando acesso a todos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-286">Deny rules not only ease management but allow for resources that are extra secure by denying access to everybody.</span></span>

## <a name="checking-access"></a><span data-ttu-id="01cc6-287">Verificando o acesso</span><span class="sxs-lookup"><span data-stu-id="01cc6-287">Checking access</span></span>

<span data-ttu-id="01cc6-288">Como você pode imaginar, ter um grande número de funções e escopos pode tornar a descoberta da permissão efetiva de uma entidade de serviço muito difícil.</span><span class="sxs-lookup"><span data-stu-id="01cc6-288">As you can imagine, having a large number of roles and scopes can make figuring out the effective permission of a service principal quite difficult.</span></span> <span data-ttu-id="01cc6-289">Empilhando regras de negação além disso, serve apenas para aumentar a complexidade.</span><span class="sxs-lookup"><span data-stu-id="01cc6-289">Piling deny rules on top of that, only serves to increase the complexity.</span></span> <span data-ttu-id="01cc6-290">Felizmente, há uma [calculadora de permissões](/azure/role-based-access-control/check-access) que pode mostrar as permissões efetivas para qualquer entidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="01cc6-290">Fortunately, there's a [permissions calculator](/azure/role-based-access-control/check-access) that can show the effective permissions for any service principal.</span></span> <span data-ttu-id="01cc6-291">Normalmente, ele é encontrado na guia IAM no portal, como mostra a Figura 9-3.</span><span class="sxs-lookup"><span data-stu-id="01cc6-291">It's typically found under the IAM tab in the portal, as shown in Figure 9-3.</span></span>

![Figura 9-4 calculadora de permissão para um serviço de aplicativo](./media/check-rbac.png)

<span data-ttu-id="01cc6-293">**Figura 9-4**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-293">**Figure 9-4**.</span></span> <span data-ttu-id="01cc6-294">Calculadora de permissão para um serviço de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="01cc6-294">Permission calculator for an app service.</span></span>

## <a name="securing-secrets"></a><span data-ttu-id="01cc6-295">Protegendo segredos</span><span class="sxs-lookup"><span data-stu-id="01cc6-295">Securing secrets</span></span>

<span data-ttu-id="01cc6-296">Senhas e certificados são um vetor de ataque comum para invasores.</span><span class="sxs-lookup"><span data-stu-id="01cc6-296">Passwords and certificates are a common attack vector for attackers.</span></span> <span data-ttu-id="01cc6-297">O hardware de violação de senha pode fazer um ataque de força bruta e tentar adivinhar bilhões de senhas por segundo.</span><span class="sxs-lookup"><span data-stu-id="01cc6-297">Password-cracking hardware can do a  brute-force attack and try to guess billions of passwords per second.</span></span> <span data-ttu-id="01cc6-298">Portanto, é importante que as senhas usadas para acessar os recursos sejam fortes, com uma grande variedade de caracteres.</span><span class="sxs-lookup"><span data-stu-id="01cc6-298">So it's important that the passwords that are used to access resources are strong, with a large variety of characters.</span></span> <span data-ttu-id="01cc6-299">Essas senhas são exatamente o tipo de senha que quase impossível de se lembrar.</span><span class="sxs-lookup"><span data-stu-id="01cc6-299">These passwords are exactly the kind of passwords that are near impossible to remember.</span></span> <span data-ttu-id="01cc6-300">Felizmente, as senhas no Azure não precisam realmente ser conhecidas por nenhum humano.</span><span class="sxs-lookup"><span data-stu-id="01cc6-300">Fortunately, the passwords in Azure don't actually need to be known by any human.</span></span>

<span data-ttu-id="01cc6-301">Muitos especialistas em segurança [sugerem](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) que usar um Gerenciador de senhas para manter suas próprias senhas é a melhor abordagem.</span><span class="sxs-lookup"><span data-stu-id="01cc6-301">Many security [experts suggest](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) that using a password manager to keep your own passwords is the best approach.</span></span> <span data-ttu-id="01cc6-302">Embora centralize suas senhas em um único local, ela também permite o uso de senhas altamente complexas e a garantia de que são exclusivas para cada conta.</span><span class="sxs-lookup"><span data-stu-id="01cc6-302">While it centralizes your passwords in one location, it also allows using highly complex passwords and ensuring they're unique for each account.</span></span> <span data-ttu-id="01cc6-303">O mesmo sistema existe no Azure: um repositório central para segredos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-303">The same system exists within Azure: a central store for secrets.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="01cc6-304">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="01cc6-304">Azure Key Vault</span></span>

<span data-ttu-id="01cc6-305">Azure Key Vault fornece um local centralizado para armazenar senhas para coisas como bancos de dados, chaves de API e certificados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-305">Azure Key Vault provides a centralized location to store passwords for things such as databases, API keys, and certificates.</span></span> <span data-ttu-id="01cc6-306">Depois que um segredo é inserido no cofre, ele nunca é mostrado novamente e os comandos para extraí-los e exibi-los são propositadamente complicados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-306">Once a secret is entered into the Vault, it's never shown again and the commands to extract and view it are purposefully complicated.</span></span> <span data-ttu-id="01cc6-307">As informações no seguro são protegidas usando os módulos de segurança de hardware validados por criptografia de software ou FIPS 140-2 nível 2.</span><span class="sxs-lookup"><span data-stu-id="01cc6-307">The information in the safe is protected using either software encryption or FIPS 140-2 Level 2 validated Hardware Security Modules.</span></span>

<span data-ttu-id="01cc6-308">O acesso ao cofre de chaves é fornecido por meio de RBACs, o que significa que não apenas qualquer usuário pode acessar as informações no cofre.</span><span class="sxs-lookup"><span data-stu-id="01cc6-308">Access to the key vault is provided through RBACs, meaning that not just any user can access the information in the vault.</span></span> <span data-ttu-id="01cc6-309">Digamos que um aplicativo Web queira acessar a cadeia de conexão de banco de dados armazenada em Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="01cc6-309">Say a web application wishes to access the database connection string stored in Azure Key Vault.</span></span> <span data-ttu-id="01cc6-310">Para obter acesso, os aplicativos precisam ser executados usando uma entidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="01cc6-310">To gain access, applications need to run using a service principal.</span></span> <span data-ttu-id="01cc6-311">Sob essa função assumida, eles podem ler os segredos do cofre.</span><span class="sxs-lookup"><span data-stu-id="01cc6-311">Under this assumed role, they can read the secrets from the safe.</span></span> <span data-ttu-id="01cc6-312">Há várias configurações de segurança diferentes que podem limitar ainda mais o acesso que um aplicativo tem ao cofre, para que ele não possa atualizar segredos, mas apenas lê-los.</span><span class="sxs-lookup"><span data-stu-id="01cc6-312">There are a number of different security settings that can further limit the access that an application has to the vault, so that it can't update secrets but only read them.</span></span>

<span data-ttu-id="01cc6-313">O acesso ao cofre de chaves pode ser monitorado para garantir que apenas os aplicativos esperados estejam acessando o cofre.</span><span class="sxs-lookup"><span data-stu-id="01cc6-313">Access to the key vault can be monitored to ensure that only the expected applications are accessing the vault.</span></span> <span data-ttu-id="01cc6-314">Os logs podem ser integrados de volta ao Azure Monitor, desbloqueando a capacidade de configurar alertas quando condições inesperadas forem encontradas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-314">The logs can be integrated back into Azure Monitor, unlocking the ability to set up alerts when unexpected conditions are encountered.</span></span>

## <a name="kubernetes"></a><span data-ttu-id="01cc6-315">Kubernetes</span><span class="sxs-lookup"><span data-stu-id="01cc6-315">Kubernetes</span></span>

<span data-ttu-id="01cc6-316">No kubernetes, há um serviço semelhante para manter pequenas partes de informações secretas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-316">Within Kubernetes, there's a similar service for maintaining small pieces of secret information.</span></span> <span data-ttu-id="01cc6-317">Os segredos do kubernetes podem ser definidos por meio do `kubectl` executável típico.</span><span class="sxs-lookup"><span data-stu-id="01cc6-317">Kubernetes Secrets can be set via the typical `kubectl` executable.</span></span>

<span data-ttu-id="01cc6-318">Criar um segredo é tão simples quanto localizar a versão Base64 dos valores a serem armazenados:</span><span class="sxs-lookup"><span data-stu-id="01cc6-318">Creating a secret is as simple as finding the base64 version of the values to be stored:</span></span>

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="01cc6-319">Em seguida, adicione-o a um arquivo de segredos chamado, `secret.yml` por exemplo, semelhante ao exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="01cc6-319">Then adding it to a secrets file named `secret.yml` for example that looks similar to the following example:</span></span>

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="01cc6-320">Por fim, esse arquivo pode ser carregado em kubernetes executando o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="01cc6-320">Finally, this file can be loaded into Kubernetes by running the following command:</span></span>

```console
kubectl apply -f ./secret.yaml
```

<span data-ttu-id="01cc6-321">Esses segredos podem então ser montados em volumes ou expostos a processos de contêiner por meio de variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="01cc6-321">These secrets can then be mounted into volumes or exposed to container processes through environment variables.</span></span> <span data-ttu-id="01cc6-322">A abordagem de [aplicativo de doze fatores](https://12factor.net/) para a criação de aplicativos sugere o uso do menor denominador comum para transmitir configurações a um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="01cc6-322">The [Twelve-factor app](https://12factor.net/) approach to building applications suggests using the lowest common denominator to transmit settings to an application.</span></span> <span data-ttu-id="01cc6-323">As variáveis de ambiente são o denominador mais baixo comum, pois elas são suportadas não importa o sistema operacional ou aplicativo.</span><span class="sxs-lookup"><span data-stu-id="01cc6-323">Environment variables are the lowest common denominator, because they're supported no matter the operating system or application.</span></span>

<span data-ttu-id="01cc6-324">Uma alternativa para usar os segredos internos do kubernetes é acessar os segredos em Azure Key Vault de dentro do kubernetes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-324">An alternative to use the built-in Kubernetes secrets is to access the secrets in Azure Key Vault from within Kubernetes.</span></span> <span data-ttu-id="01cc6-325">A maneira mais simples de fazer isso é atribuir uma função de RBAC ao contêiner, buscando carregar segredos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-325">The simplest way to do this is to assign an RBAC role to the container looking to load secrets.</span></span> <span data-ttu-id="01cc6-326">O aplicativo pode usar as APIs de Azure Key Vault para acessar os segredos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-326">The application can then use the Azure Key Vault APIs to access the secrets.</span></span> <span data-ttu-id="01cc6-327">No entanto, essa abordagem requer modificações no código e não segue o padrão de uso de variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="01cc6-327">However, this approach requires modifications to the code and doesn't follow the pattern of using environment variables.</span></span> <span data-ttu-id="01cc6-328">Em vez disso, é possível injetar valores em um contêiner.</span><span class="sxs-lookup"><span data-stu-id="01cc6-328">Instead, it's possible to inject values into a container.</span></span> <span data-ttu-id="01cc6-329">Essa abordagem é, na verdade, mais segura do que usar os segredos do kubernetes diretamente, pois eles podem ser acessados por usuários no cluster.</span><span class="sxs-lookup"><span data-stu-id="01cc6-329">This approach is actually more secure than using the Kubernetes secrets directly, as they can be accessed by users on the cluster.</span></span>

## <a name="encryption-in-transit-and-at-rest"></a><span data-ttu-id="01cc6-330">Criptografia em trânsito e em repouso</span><span class="sxs-lookup"><span data-stu-id="01cc6-330">Encryption in transit and at rest</span></span>

<span data-ttu-id="01cc6-331">Manter os dados seguros é importante se ele estiver em disco ou transitando entre vários serviços diferentes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-331">Keeping data safe is important whether it's on disk or transiting between various different services.</span></span> <span data-ttu-id="01cc6-332">A maneira mais eficaz de manter os dados contra vazamento é criptografá-los em um formato que não pode ser lido facilmente por outras pessoas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-332">The most effective way to keep data from leaking is to encrypt it into a format that can't be easily read by others.</span></span> <span data-ttu-id="01cc6-333">O Azure dá suporte a uma ampla variedade de opções de criptografia.</span><span class="sxs-lookup"><span data-stu-id="01cc6-333">Azure supports a wide range of encryption options.</span></span>

### <a name="in-transit"></a><span data-ttu-id="01cc6-334">Em trânsito</span><span class="sxs-lookup"><span data-stu-id="01cc6-334">In transit</span></span>

<span data-ttu-id="01cc6-335">Há várias maneiras de criptografar o tráfego na rede no Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-335">There are several ways to encrypt traffic on the network in Azure.</span></span> <span data-ttu-id="01cc6-336">O acesso aos serviços do Azure normalmente é feito em conexões que usam TLS (Transport Layer Security).</span><span class="sxs-lookup"><span data-stu-id="01cc6-336">The access to Azure services is typically done over connections that use Transport Layer Security (TLS).</span></span> <span data-ttu-id="01cc6-337">Por exemplo, todas as conexões com as APIs do Azure exigem conexões TLS.</span><span class="sxs-lookup"><span data-stu-id="01cc6-337">For instance, all the connections to the Azure APIs require TLS connections.</span></span> <span data-ttu-id="01cc6-338">Igualmente, as conexões com pontos de extremidade no armazenamento do Azure podem ser restritas para trabalhar somente em conexões criptografadas por TLS.</span><span class="sxs-lookup"><span data-stu-id="01cc6-338">Equally, connections to endpoints in Azure storage can be restricted to work only over TLS encrypted connections.</span></span>

<span data-ttu-id="01cc6-339">O TLS é um protocolo complicado e simplesmente saber que a conexão está usando o TLS não é suficiente para garantir a segurança.</span><span class="sxs-lookup"><span data-stu-id="01cc6-339">TLS is a complicated protocol and simply knowing that the connection is using TLS isn't sufficient to ensure security.</span></span> <span data-ttu-id="01cc6-340">Por exemplo, o TLS 1,0 é cronicamente inseguro e o TLS 1,1 não é muito melhor.</span><span class="sxs-lookup"><span data-stu-id="01cc6-340">For instance, TLS 1.0 is chronically insecure, and TLS 1.1 isn't much better.</span></span> <span data-ttu-id="01cc6-341">Mesmo dentro das versões do TLS, há várias configurações que podem facilitar a descriptografia das conexões.</span><span class="sxs-lookup"><span data-stu-id="01cc6-341">Even within the versions of TLS, there are various settings that can make the connections easier to decrypt.</span></span> <span data-ttu-id="01cc6-342">A melhor ação é verificar e ver se a conexão do servidor está usando protocolos atualizados e bem configurados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-342">The best course of action is to check and see if the server connection is using up-to-date and well configured protocols.</span></span>

<span data-ttu-id="01cc6-343">Essa verificação pode ser feita por um serviço externo, como o teste do servidor SSL dos laboratórios SSL.</span><span class="sxs-lookup"><span data-stu-id="01cc6-343">This check can be done by an external service such as SSL labs' SSL Server Test.</span></span> <span data-ttu-id="01cc6-344">Uma execução de teste em um ponto de extremidade do Azure típico, nesse caso, um ponto de extremidade do barramento de serviço, produz uma pontuação quase perfeita de um.</span><span class="sxs-lookup"><span data-stu-id="01cc6-344">A test run against a typical Azure endpoint, in this case a service bus endpoint, yields a near perfect score of A.</span></span>

<span data-ttu-id="01cc6-345">Até mesmo serviços, como bancos de dados SQL do Azure, usam criptografia TLS para manter o dado oculto.</span><span class="sxs-lookup"><span data-stu-id="01cc6-345">Even services like Azure SQL databases use TLS encryption to keep data hidden.</span></span> <span data-ttu-id="01cc6-346">A parte interessante sobre criptografar os dados em trânsito usando o TLS é que não é possível, mesmo para a Microsoft, escutar na conexão entre os computadores que executam o TLS.</span><span class="sxs-lookup"><span data-stu-id="01cc6-346">The interesting part about encrypting the data in transit using TLS is that it isn't possible, even for Microsoft, to listen in on the connection between computers running TLS.</span></span> <span data-ttu-id="01cc6-347">Isso deve ser confortável para as empresas que se preocupam que seus dados possam estar em risco da Microsoft apropriada ou até mesmo de um ator de estado com mais recursos do que o invasor padrão.</span><span class="sxs-lookup"><span data-stu-id="01cc6-347">This should provide comfort for companies concerned that their data may be at risk from Microsoft proper or even a state actor with more resources than the standard attacker.</span></span>

![Figura 9-5 relatório de laboratórios SSL mostrando uma pontuação de um ponto de extremidade do barramento de serviço.](./media/ssl-report.png)

<span data-ttu-id="01cc6-349">**Figura 9-5**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-349">**Figure 9-5**.</span></span> <span data-ttu-id="01cc6-350">Relatório de laboratórios de SSL mostrando uma pontuação de um ponto de extremidade do barramento de serviço.</span><span class="sxs-lookup"><span data-stu-id="01cc6-350">SSL labs report showing a score of A for a Service Bus endpoint.</span></span>

<span data-ttu-id="01cc6-351">Embora esse nível de criptografia não seja suficiente para todo o tempo, deve inspirar a confiança de que as conexões do Azure TLS são bem seguras.</span><span class="sxs-lookup"><span data-stu-id="01cc6-351">While this level of encryption isn't going to be sufficient for all time, it should inspire confidence that Azure TLS connections are quite secure.</span></span> <span data-ttu-id="01cc6-352">O Azure continuará a desenvolver seus padrões de segurança conforme a criptografia melhora.</span><span class="sxs-lookup"><span data-stu-id="01cc6-352">Azure will continue to evolve its security standards as encryption improves.</span></span> <span data-ttu-id="01cc6-353">É bom saber que há alguém assistindo aos padrões de segurança e atualizando o Azure à medida que eles melhoram.</span><span class="sxs-lookup"><span data-stu-id="01cc6-353">It's nice to know that there's somebody watching the security standards and updating Azure as they improve.</span></span>

### <a name="at-rest"></a><span data-ttu-id="01cc6-354">Em repouso</span><span class="sxs-lookup"><span data-stu-id="01cc6-354">At rest</span></span>

<span data-ttu-id="01cc6-355">Em qualquer aplicativo, há vários locais em que os dados são REST no disco.</span><span class="sxs-lookup"><span data-stu-id="01cc6-355">In any application, there are a number of places where data rests on the disk.</span></span> <span data-ttu-id="01cc6-356">O código do aplicativo em si é carregado de algum mecanismo de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="01cc6-356">The application code itself is loaded from some storage mechanism.</span></span> <span data-ttu-id="01cc6-357">A maioria dos aplicativos também usa algum tipo de banco de dados, como SQL Server, Cosmos DB ou até mesmo o enorme armazenamento de tabelas eficiente em termos de preço.</span><span class="sxs-lookup"><span data-stu-id="01cc6-357">Most applications also use some kind of a database such as SQL Server, Cosmos DB, or even the amazingly price-efficient Table Storage.</span></span> <span data-ttu-id="01cc6-358">Todos esses bancos de dados usam armazenamento com criptografia intensa para garantir que ninguém diferente dos aplicativos com as permissões adequadas possa ler seus dados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-358">These databases all use heavily encrypted storage to ensure that nobody other than the applications with proper permissions can read your data.</span></span> <span data-ttu-id="01cc6-359">Até mesmo os operadores do sistema não podem ler dados que foram criptografados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-359">Even the system operators can't read data that has been encrypted.</span></span> <span data-ttu-id="01cc6-360">Assim, os clientes podem permanecer confiantes de que suas informações secretas permanecem secretas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-360">So customers can remain confident their secret information remains secret.</span></span>

### <a name="storage"></a><span data-ttu-id="01cc6-361">Armazenamento</span><span class="sxs-lookup"><span data-stu-id="01cc6-361">Storage</span></span>

<span data-ttu-id="01cc6-362">A base de grande parte do Azure é o mecanismo de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-362">The underpinning of much of Azure is the Azure Storage engine.</span></span> <span data-ttu-id="01cc6-363">Os discos de máquina virtual são montados sobre o armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-363">Virtual machine disks are mounted on top of Azure Storage.</span></span> <span data-ttu-id="01cc6-364">O serviço kubernetes do Azure é executado em máquinas virtuais que, por sua conta, estão hospedadas no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-364">Azure Kubernetes Service runs on virtual machines that, themselves, are hosted on Azure Storage.</span></span> <span data-ttu-id="01cc6-365">Mesmo as tecnologias sem servidor, como Azure Functions aplicativos e instâncias de contêiner do Azure, ficam fora do disco que faz parte do armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-365">Even serverless technologies, such as Azure Functions Apps and Azure Container Instances, run out of disk that is part of Azure Storage.</span></span>

<span data-ttu-id="01cc6-366">Se o armazenamento do Azure estiver bem criptografado, ele fornecerá uma base para que a maioria das outras coisas também seja criptografada.</span><span class="sxs-lookup"><span data-stu-id="01cc6-366">If Azure Storage is well encrypted, then it provides for a foundation for most everything else to also be encrypted.</span></span> <span data-ttu-id="01cc6-367">O armazenamento do Azure [é criptografado](/azure/storage/common/storage-service-encryption) com o [AES de 256 bits](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)compatível com [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) .</span><span class="sxs-lookup"><span data-stu-id="01cc6-367">Azure Storage [is encrypted](/azure/storage/common/storage-service-encryption) with [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) compliant [256-bit AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span></span> <span data-ttu-id="01cc6-368">Essa é uma tecnologia de criptografia bem considerada que tem sido o assunto de uma ampla investigação acadêmica nos últimos 20 anos.</span><span class="sxs-lookup"><span data-stu-id="01cc6-368">This is a well-regarded encryption technology having been the subject of extensive academic scrutiny over the last 20 or so years.</span></span> <span data-ttu-id="01cc6-369">No momento, não há nenhum ataque prático conhecido que permitisse alguém sem conhecimento da chave para ler os dados criptografados pelo AES.</span><span class="sxs-lookup"><span data-stu-id="01cc6-369">At present, there's no known practical attack that would allow someone without knowledge of the key to read data encrypted by AES.</span></span>

<span data-ttu-id="01cc6-370">Por padrão, as chaves usadas para criptografar o armazenamento do Azure são gerenciadas pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="01cc6-370">By default, the keys used for encrypting Azure Storage are managed by Microsoft.</span></span> <span data-ttu-id="01cc6-371">Há proteções extensivas em vigor para garantir o acesso mal-intencionado a essas chaves.</span><span class="sxs-lookup"><span data-stu-id="01cc6-371">There are extensive protections in place to ensure to prevent malicious access to these keys.</span></span> <span data-ttu-id="01cc6-372">No entanto, os usuários com requisitos de criptografia específicos também podem [fornecer suas próprias chaves de armazenamento](/azure/storage/common/storage-encryption-keys-powershell) que são gerenciadas em Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="01cc6-372">However, users with particular encryption requirements can also [provide their own storage keys](/azure/storage/common/storage-encryption-keys-powershell) that are managed in Azure Key Vault.</span></span> <span data-ttu-id="01cc6-373">Essas chaves podem ser revogadas a qualquer momento, o que efetivamente renderizaria o conteúdo da conta de armazenamento usando-os inacessíveis.</span><span class="sxs-lookup"><span data-stu-id="01cc6-373">These keys can be revoked at any time, which would effectively render the contents of the Storage account using them inaccessible.</span></span>

<span data-ttu-id="01cc6-374">As máquinas virtuais usam o armazenamento criptografado, mas é possível fornecer outra camada de criptografia usando tecnologias como o BitLocker no Windows ou DM-Crypt no Linux.</span><span class="sxs-lookup"><span data-stu-id="01cc6-374">Virtual machines use encrypted storage, but it's possible to provide another layer of encryption by using technologies like BitLocker on Windows or DM-Crypt on Linux.</span></span> <span data-ttu-id="01cc6-375">Essas tecnologias significam que, mesmo que a imagem do disco tenha sido vazada fora do armazenamento, ela permaneceria quase impossível de ler.</span><span class="sxs-lookup"><span data-stu-id="01cc6-375">These technologies mean that even if the disk image was leaked off of storage, it would remain near impossible to read it.</span></span>

### <a name="azure-sql"></a><span data-ttu-id="01cc6-376">SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="01cc6-376">Azure SQL</span></span>

<span data-ttu-id="01cc6-377">Os bancos de dados hospedados no SQL do Azure usam uma tecnologia chamada [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) para garantir que os dados permaneçam criptografados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-377">Databases hosted on Azure SQL use a technology called [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) to ensure data remains encrypted.</span></span> <span data-ttu-id="01cc6-378">Ele é habilitado por padrão em todos os bancos de dados SQL recém-criados, mas deve ser habilitado manualmente para bancos de dados herdados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-378">It's enabled by default on all newly created SQL databases, but must be enabled manually for legacy databases.</span></span> <span data-ttu-id="01cc6-379">O TDE executa criptografia e descriptografia em tempo real, não apenas o banco de dados, mas também os logs de transações e backups.</span><span class="sxs-lookup"><span data-stu-id="01cc6-379">TDE executes real-time encryption and decryption of not just the database, but also the backups and transaction logs.</span></span>

<span data-ttu-id="01cc6-380">Os parâmetros de criptografia são armazenados no `master` banco de dados e, na inicialização, são lidos na memória para as operações restantes.</span><span class="sxs-lookup"><span data-stu-id="01cc6-380">The encryption parameters are stored in the `master` database and, on startup, are read into memory for the remaining operations.</span></span> <span data-ttu-id="01cc6-381">Isso significa que o `master` banco de dados deve permanecer sem criptografia.</span><span class="sxs-lookup"><span data-stu-id="01cc6-381">This means that the `master` database must remain unencrypted.</span></span> <span data-ttu-id="01cc6-382">A chave real é gerenciada pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="01cc6-382">The actual key is managed by Microsoft.</span></span> <span data-ttu-id="01cc6-383">No entanto, os usuários com requisitos de segurança de reação podem fornecer sua própria chave em Key Vault praticamente da mesma forma como é feito para o armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-383">However, users with exacting security requirements may provide their own key in Key Vault in much the same way as is done for Azure Storage.</span></span> <span data-ttu-id="01cc6-384">O Key Vault fornece serviços como rotação de chaves e revogação.</span><span class="sxs-lookup"><span data-stu-id="01cc6-384">The Key Vault provides for such services as key rotation and revocation.</span></span>

<span data-ttu-id="01cc6-385">A parte "transparente" do TDS é proveniente do fato de que não há alterações do cliente necessárias para usar um banco de dados criptografado.</span><span class="sxs-lookup"><span data-stu-id="01cc6-385">The "Transparent" part of TDS comes from the fact that there aren't client changes needed to use an encrypted database.</span></span> <span data-ttu-id="01cc6-386">Embora essa abordagem forneça uma boa segurança, o vazamento da senha do banco de dados é suficiente para que os usuários possam descriptografá-los.</span><span class="sxs-lookup"><span data-stu-id="01cc6-386">While this approach provides for good security, leaking the database password is enough for users to be able to decrypt the data.</span></span> <span data-ttu-id="01cc6-387">Há outra abordagem que criptografa colunas individuais ou tabelas em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-387">There's another approach that encrypts individual columns or tables in a database.</span></span> <span data-ttu-id="01cc6-388">[Always Encrypted](/azure/sql-database/sql-database-always-encrypted-azure-key-vault) garante que, sem nenhum momento, os dados criptografados apareçam em texto sem formatação dentro do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-388">[Always Encrypted](/azure/sql-database/sql-database-always-encrypted-azure-key-vault) ensures that at no point the encrypted data appears in plain text inside the database.</span></span>

<span data-ttu-id="01cc6-389">A configuração dessa camada de criptografia requer a execução por meio de um assistente no SQL Server Management Studio para selecionar o tipo de criptografia e onde em Key Vault armazenar as chaves associadas.</span><span class="sxs-lookup"><span data-stu-id="01cc6-389">Setting up this tier of encryption requires running through a wizard in SQL Server Management Studio to select the sort of encryption and where in Key Vault to store the associated keys.</span></span>

![Figura 9-6 selecionando colunas em uma tabela a ser criptografada usando Always Encrypted](./media/always-encrypted.png)

<span data-ttu-id="01cc6-391">**Figura 9-6**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-391">**Figure 9-6**.</span></span> <span data-ttu-id="01cc6-392">Selecionando colunas em uma tabela a ser criptografada usando Always Encrypted.</span><span class="sxs-lookup"><span data-stu-id="01cc6-392">Selecting columns in a table to be encrypted using Always Encrypted.</span></span>

<span data-ttu-id="01cc6-393">Os aplicativos cliente que lêem informações dessas colunas criptografadas precisam fazer concessões especiais para ler dados criptografados.</span><span class="sxs-lookup"><span data-stu-id="01cc6-393">Client applications that read information from these encrypted columns need to make special allowances to read encrypted data.</span></span> <span data-ttu-id="01cc6-394">As cadeias de conexão precisam ser atualizadas com `Column Encryption Setting=Enabled` e as credenciais do cliente devem ser recuperadas do Key Vault.</span><span class="sxs-lookup"><span data-stu-id="01cc6-394">Connection strings need to be updated with `Column Encryption Setting=Enabled` and client credentials must be retrieved from the Key Vault.</span></span> <span data-ttu-id="01cc6-395">Em seguida, o cliente de SQL Server deve ser acessado com as chaves de criptografia de coluna.</span><span class="sxs-lookup"><span data-stu-id="01cc6-395">The SQL Server client must then be primed with the column encryption keys.</span></span> <span data-ttu-id="01cc6-396">Quando isso for feito, as ações restantes usarão as interfaces padrão para o cliente SQL.</span><span class="sxs-lookup"><span data-stu-id="01cc6-396">Once that is done, the remaining actions use the standard interfaces to SQL Client.</span></span> <span data-ttu-id="01cc6-397">Ou seja, ferramentas como Dapper e Entity Framework, que são criadas com base no cliente SQL, continuarão funcionando sem alterações.</span><span class="sxs-lookup"><span data-stu-id="01cc6-397">That is, tools like Dapper and Entity Framework, which are built on top of SQL Client, will continue to work without changes.</span></span> <span data-ttu-id="01cc6-398">Always Encrypted pode ainda não estar disponível para cada driver de SQL Server em cada idioma.</span><span class="sxs-lookup"><span data-stu-id="01cc6-398">Always Encrypted may not yet be available for every SQL Server driver on every language.</span></span>

<span data-ttu-id="01cc6-399">A combinação de TDE e Always Encrypted, que pode ser usada com chaves específicas do cliente, garante que até mesmo os requisitos de criptografia mais exacionados têm suporte.</span><span class="sxs-lookup"><span data-stu-id="01cc6-399">The combination of TDE and Always Encrypted, both of which can be used with client-specific keys, ensures that even the most exacting encryption requirements are supported.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="01cc6-400">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="01cc6-400">Cosmos DB</span></span>

<span data-ttu-id="01cc6-401">Cosmos DB é o banco de dados mais recente fornecido pela Microsoft no Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-401">Cosmos DB is the newest database provided by Microsoft in Azure.</span></span> <span data-ttu-id="01cc6-402">Ele foi criado desde o início com a segurança e a criptografia em mente.</span><span class="sxs-lookup"><span data-stu-id="01cc6-402">It has been built from the ground up with security and cryptography in mind.</span></span> <span data-ttu-id="01cc6-403">A criptografia AES-256bit é padrão para todos os bancos de dados do Cosmos DB e não pode ser desabilitada.</span><span class="sxs-lookup"><span data-stu-id="01cc6-403">AES-256bit encryption is standard for all Cosmos DB databases and can't be disabled.</span></span> <span data-ttu-id="01cc6-404">Junto com o requisito de TLS 1,2 para comunicação, toda a solução de armazenamento é criptografada.</span><span class="sxs-lookup"><span data-stu-id="01cc6-404">Coupled with the TLS 1.2 requirement for communication, the entire storage solution is encrypted.</span></span>

![Figura 9-7 o fluxo de criptografia de dados no Cosmos DB](./media/cosmos-encryption.png)

<span data-ttu-id="01cc6-406">**Figura 9-7**.</span><span class="sxs-lookup"><span data-stu-id="01cc6-406">**Figure 9-7**.</span></span> <span data-ttu-id="01cc6-407">O fluxo de criptografia de dados no Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="01cc6-407">The flow of data encryption within Cosmos DB.</span></span>

<span data-ttu-id="01cc6-408">Embora Cosmos DB não forneça as chaves de criptografia do cliente, houve um trabalho significativo feito pela equipe para garantir que ela permaneça compatível com PCI-DSS sem isso.</span><span class="sxs-lookup"><span data-stu-id="01cc6-408">While Cosmos DB doesn't provide for supplying customer encryption keys, there has been significant work done by the team to ensure it remains PCI-DSS compliant without that.</span></span> <span data-ttu-id="01cc6-409">Cosmos DB também não dá suporte a nenhum tipo de criptografia de coluna única semelhante ao Always Encrypted do SQL do Azure ainda.</span><span class="sxs-lookup"><span data-stu-id="01cc6-409">Cosmos DB also doesn't support any sort of single column encryption similar to Azure SQL's Always Encrypted yet.</span></span>

## <a name="keeping-secure"></a><span data-ttu-id="01cc6-410">Mantendo a segurança</span><span class="sxs-lookup"><span data-stu-id="01cc6-410">Keeping secure</span></span>

<span data-ttu-id="01cc6-411">O Azure tem todas as ferramentas necessárias para lançar um produto altamente seguro.</span><span class="sxs-lookup"><span data-stu-id="01cc6-411">Azure has all the tools necessary to release a highly secure product.</span></span> <span data-ttu-id="01cc6-412">No entanto, uma cadeia é tão forte quanto seu link mais fraco.</span><span class="sxs-lookup"><span data-stu-id="01cc6-412">However, a chain is only as strong as its weakest link.</span></span> <span data-ttu-id="01cc6-413">Se os aplicativos implantados na parte superior do Azure não forem desenvolvidos com uma mentalidade de segurança adequada e boas auditorias de segurança, eles se tornarão o link fraco na cadeia.</span><span class="sxs-lookup"><span data-stu-id="01cc6-413">If the applications deployed on top of Azure aren't developed with a proper security mindset and good security audits, then they become the weak link in the chain.</span></span> <span data-ttu-id="01cc6-414">Há muitas excelentes ferramentas de análise estática, bibliotecas de criptografia e práticas de segurança que podem ser usadas para garantir que o software instalado no Azure seja tão seguro quanto o próprio Azure.</span><span class="sxs-lookup"><span data-stu-id="01cc6-414">There are many great static analysis tools, encryption libraries, and security practices that can be used to ensure that the software installed on Azure is as secure as Azure itself.</span></span> <span data-ttu-id="01cc6-415">Os exemplos incluem [ferramentas de análise estática](https://www.whitesourcesoftware.com/), [bibliotecas de criptografia](https://www.libressl.org/)e práticas de [segurança](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span><span class="sxs-lookup"><span data-stu-id="01cc6-415">Examples include [static analysis tools](https://www.whitesourcesoftware.com/), [encryption libraries](https://www.libressl.org/), and [security practices](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="01cc6-416">[Anterior](security.md) 
> [Avançar](devops.md)</span><span class="sxs-lookup"><span data-stu-id="01cc6-416">[Previous](security.md)
[Next](devops.md)</span></span>
