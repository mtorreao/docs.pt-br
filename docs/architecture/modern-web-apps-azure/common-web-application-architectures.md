---
title: Arquiteturas comuns de aplicativo Web
description: Arquitetar aplicativos Web modernos com o ASP.NET Core e o Azure | Explore as arquiteturas comuns para aplicativos Web
author: ardalis
ms.author: wiwagn
ms.date: 12/01/2020
ms.openlocfilehash: c9c593788d4cdbb5a1d4c57ac91880ef965f06fa
ms.sourcegitcommit: 45c7148f2483db2501c1aa696ab6ed2ed8cb71b2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/08/2020
ms.locfileid: "96851732"
---
# <a name="common-web-application-architectures"></a><span data-ttu-id="b52cb-103">Arquiteturas comuns de aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="b52cb-103">Common web application architectures</span></span>

> <span data-ttu-id="b52cb-104">"Se você acha que uma boa arquitetura é cara, tente usar uma arquitetura ruim."</span><span class="sxs-lookup"><span data-stu-id="b52cb-104">"If you think good architecture is expensive, try bad architecture."</span></span>
> <span data-ttu-id="b52cb-105">_- Brian Foote e Joseph Yoder_</span><span class="sxs-lookup"><span data-stu-id="b52cb-105">_- Brian Foote and Joseph Yoder_</span></span>

<span data-ttu-id="b52cb-106">A maioria dos aplicativos .NET tradicionais é implantada como unidades individuais correspondentes a um executável ou a um único aplicativo Web em execução em um único AppDomain do IIS.</span><span class="sxs-lookup"><span data-stu-id="b52cb-106">Most traditional .NET applications are deployed as single units corresponding to an executable or a single web application running within a single IIS appdomain.</span></span> <span data-ttu-id="b52cb-107">Essa abordagem é o modelo de implantação mais simples e fornece muitos aplicativos públicos internos e menores muito bem.</span><span class="sxs-lookup"><span data-stu-id="b52cb-107">This approach is the simplest deployment model and serves many internal and smaller public applications very well.</span></span> <span data-ttu-id="b52cb-108">No entanto, mesmo considerando essa única unidade de implantação, a maioria dos aplicativos de negócios não triviais se beneficia de uma separação lógica em várias camadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-108">However, even given this single unit of deployment, most non-trivial business applications benefit from some logical separation into several layers.</span></span>

## <a name="what-is-a-monolithic-application"></a><span data-ttu-id="b52cb-109">O que é um aplicativo monolítico?</span><span class="sxs-lookup"><span data-stu-id="b52cb-109">What is a monolithic application?</span></span>

<span data-ttu-id="b52cb-110">Um aplicativo monolítico é aquele que é totalmente autossuficiente, em termos de comportamento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-110">A monolithic application is one that is entirely self-contained, in terms of its behavior.</span></span> <span data-ttu-id="b52cb-111">Ele pode interagir com outros serviços ou armazenamentos de dados durante a execução de suas operações, mas o núcleo de seu comportamento é executado em seu próprio processo e o aplicativo inteiro normalmente é implantado como uma única unidade.</span><span class="sxs-lookup"><span data-stu-id="b52cb-111">It may interact with other services or data stores in the course of performing its operations, but the core of its behavior runs within its own process and the entire application is typically deployed as a single unit.</span></span> <span data-ttu-id="b52cb-112">Se um aplicativo desse tipo precisar ser dimensionado horizontalmente, em geral, o aplicativo inteiro será duplicado em vários servidores ou máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-112">If such an application needs to scale horizontally, typically the entire application is duplicated across multiple servers or virtual machines.</span></span>

## <a name="all-in-one-applications"></a><span data-ttu-id="b52cb-113">Aplicativos todos-em-um</span><span class="sxs-lookup"><span data-stu-id="b52cb-113">All-in-one applications</span></span>

<span data-ttu-id="b52cb-114">O menor número possível de projetos para uma arquitetura de aplicativo é um.</span><span class="sxs-lookup"><span data-stu-id="b52cb-114">The smallest possible number of projects for an application architecture is one.</span></span> <span data-ttu-id="b52cb-115">Nessa arquitetura, toda a lógica do aplicativo está contida em um único projeto, compilada em um único assembly e implantada como uma única unidade.</span><span class="sxs-lookup"><span data-stu-id="b52cb-115">In this architecture, the entire logic of the application is contained in a single project, compiled to a single assembly, and deployed as a single unit.</span></span>

<span data-ttu-id="b52cb-116">Um novo projeto ASP.NET Core, seja ele criado no Visual Studio ou por meio da linha de comando, começa como um simples monólito "todos-em-um".</span><span class="sxs-lookup"><span data-stu-id="b52cb-116">A new ASP.NET Core project, whether created in Visual Studio or from the command line, starts out as a simple "all-in-one" monolith.</span></span> <span data-ttu-id="b52cb-117">Ele contém todo o comportamento do aplicativo, incluindo a lógica de apresentação, de negócios e de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-117">It contains all of the behavior of the application, including presentation, business, and data access logic.</span></span> <span data-ttu-id="b52cb-118">A Figura 5-1 mostra a estrutura de arquivos de um aplicativo de projeto único.</span><span class="sxs-lookup"><span data-stu-id="b52cb-118">Figure 5-1 shows the file structure of a single-project app.</span></span>

![Um aplicativo ASP.NET Core de projeto único](./media/image5-1.png)

<span data-ttu-id="b52cb-120">**Figura 5-1.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-120">**Figure 5-1.**</span></span> <span data-ttu-id="b52cb-121">Um único projeto de aplicativo ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="b52cb-121">A single project ASP.NET Core app.</span></span>

<span data-ttu-id="b52cb-122">Em um cenário de projeto único, a separação de interesses é obtida com o uso de pastas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-122">In a single project scenario, separation of concerns is achieved through the use of folders.</span></span> <span data-ttu-id="b52cb-123">O modelo padrão inclui pastas separadas para as responsabilidades do padrão MVC de Modelos, Exibições e Controladores, bem como pastas adicionais para Dados e Serviços.</span><span class="sxs-lookup"><span data-stu-id="b52cb-123">The default template includes separate folders for MVC pattern responsibilities of Models, Views, and Controllers, as well as additional folders for Data and Services.</span></span> <span data-ttu-id="b52cb-124">Nessa disposição, os detalhes de apresentação devem ser limitados tanto quanto possível à pasta Views e os detalhes de implementação de acesso a dados devem ser limitados às classes mantidas na pasta Data.</span><span class="sxs-lookup"><span data-stu-id="b52cb-124">In this arrangement, presentation details should be limited as much as possible to the Views folder, and data access implementation details should be limited to classes kept in the Data folder.</span></span> <span data-ttu-id="b52cb-125">A lógica de negócios deve residir nos serviços e nas classes dentro da pasta Models.</span><span class="sxs-lookup"><span data-stu-id="b52cb-125">Business logic should reside in services and classes within the Models folder.</span></span>

<span data-ttu-id="b52cb-126">Embora simples, a solução monolítica de projeto único traz algumas desvantagens.</span><span class="sxs-lookup"><span data-stu-id="b52cb-126">Although simple, the single-project monolithic solution has some disadvantages.</span></span> <span data-ttu-id="b52cb-127">À medida que o tamanho e a complexidade do projeto aumentam, o número de arquivos e pastas continuará crescendo também.</span><span class="sxs-lookup"><span data-stu-id="b52cb-127">As the project's size and complexity grows, the number of files and folders will continue to grow as well.</span></span> <span data-ttu-id="b52cb-128">Os interesses de UI (interface do usuário) (modelos, exibições, controladores) residem em várias pastas, que não são agrupadas em ordem alfabética.</span><span class="sxs-lookup"><span data-stu-id="b52cb-128">User interface (UI) concerns (models, views, controllers) reside in multiple folders, which aren't grouped together alphabetically.</span></span> <span data-ttu-id="b52cb-129">Esse problema só fica pior quando constructos adicionais no nível da interface do usuário, como Filters ou ModelBinders, são adicionados em suas próprias pastas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-129">This issue only gets worse when additional UI-level constructs, such as Filters or ModelBinders, are added in their own folders.</span></span> <span data-ttu-id="b52cb-130">A lógica de negócios é distribuída entre as pastas Modelos e Serviços e não há nenhuma indicação clara de quais classes em quais pastas devem depender de qual delas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-130">Business logic is scattered between the Models and Services folders, and there's no clear indication of which classes in which folders should depend on which others.</span></span> <span data-ttu-id="b52cb-131">Essa falta de organização no nível do projeto costuma levar ao [código espaguete](https://deviq.com/spaghetti-code/).</span><span class="sxs-lookup"><span data-stu-id="b52cb-131">This lack of organization at the project level frequently leads to [spaghetti code](https://deviq.com/spaghetti-code/).</span></span>

<span data-ttu-id="b52cb-132">Para resolver esses problemas, os aplicativos geralmente evoluem para soluções de vários projetos, em que cada projeto é considerado um residente de determinada _camada_ do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-132">To address these issues, applications often evolve into multi-project solutions, where each project is considered to reside in a particular _layer_ of the application.</span></span>

## <a name="what-are-layers"></a><span data-ttu-id="b52cb-133">O que são camadas?</span><span class="sxs-lookup"><span data-stu-id="b52cb-133">What are layers?</span></span>

<span data-ttu-id="b52cb-134">Conforme a complexidade dos aplicativos aumenta, uma maneira de gerenciar essa complexidade é dividir o aplicativo de acordo com suas responsabilidades ou interesses.</span><span class="sxs-lookup"><span data-stu-id="b52cb-134">As applications grow in complexity, one way to manage that complexity is to break up the application according to its responsibilities or concerns.</span></span> <span data-ttu-id="b52cb-135">Essa abordagem segue a separação do princípio de preocupações e pode ajudar a manter uma base de código crescente organizada para que os desenvolvedores possam encontrar facilmente onde determinadas funcionalidades são implementadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-135">This approach follows the separation of concerns principle and can help keep a growing codebase organized so that developers can easily find where certain functionality is implemented.</span></span> <span data-ttu-id="b52cb-136">Apesar disso, a arquitetura em camadas oferece inúmeras vantagens, além de apenas a organização do código.</span><span class="sxs-lookup"><span data-stu-id="b52cb-136">Layered architecture offers a number of advantages beyond just code organization, though.</span></span>

<span data-ttu-id="b52cb-137">Com a organização do código em camadas, a funcionalidade comum de baixo nível pode ser reutilizada em todo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-137">By organizing code into layers, common low-level functionality can be reused throughout the application.</span></span> <span data-ttu-id="b52cb-138">Essa reutilização é útil porque significa que menos código precisa ser escrito e ainda pode permitir que o aplicativo seja padronizado em uma única implementação, seguindo o princípio [DRY (Don't Repeat Yourself)](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself).</span><span class="sxs-lookup"><span data-stu-id="b52cb-138">This reuse is beneficial because it means less code needs to be written and because it can allow the application to standardize on a single implementation, following the [don't repeat yourself (DRY)](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) principle.</span></span>

<span data-ttu-id="b52cb-139">Com uma arquitetura em camadas, os aplicativos podem impor restrições sobre quais camadas podem se comunicar com outras camadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-139">With a layered architecture, applications can enforce restrictions on which layers can communicate with other layers.</span></span> <span data-ttu-id="b52cb-140">Essa arquitetura ajuda a atingir o encapsulamento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-140">This architecture helps to achieve encapsulation.</span></span> <span data-ttu-id="b52cb-141">Quando uma camada é alterada ou substituída, somente as camadas que trabalham com ela devem ser afetadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-141">When a layer is changed or replaced, only those layers that work with it should be impacted.</span></span> <span data-ttu-id="b52cb-142">Ao limitar quais camadas dependem de outras camadas, o impacto das alterações pode ser reduzido, de modo que uma única alteração não afete todo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-142">By limiting which layers depend on which other layers, the impact of changes can be mitigated so that a single change doesn't impact the entire application.</span></span>

<span data-ttu-id="b52cb-143">As camadas (e o encapsulamento) facilitam grande parte da substituição da funcionalidade dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-143">Layers (and encapsulation) make it much easier to replace functionality within the application.</span></span> <span data-ttu-id="b52cb-144">Por exemplo, um aplicativo inicialmente pode usar seu próprio banco de dados do SQL Server para persistência, mas, posteriormente, pode optar por usar uma estratégia de persistência baseada em nuvem ou uma protegida por uma API Web.</span><span class="sxs-lookup"><span data-stu-id="b52cb-144">For example, an application might initially use its own SQL Server database for persistence, but later could choose to use a cloud-based persistence strategy, or one behind a web API.</span></span> <span data-ttu-id="b52cb-145">Se o aplicativo encapsulasse corretamente sua implementação de persistência dentro de uma camada lógica, essa camada específica de SQL Server poderia ser substituída por uma nova implementação da mesma interface pública.</span><span class="sxs-lookup"><span data-stu-id="b52cb-145">If the application has properly encapsulated its persistence implementation within a logical layer, that SQL Server-specific layer could be replaced by a new one implementing the same public interface.</span></span>

<span data-ttu-id="b52cb-146">Além do potencial de alternância de implementações em resposta a alterações futuras nos requisitos, as camadas de aplicativo também podem facilitar a alternância de implementações para fins de teste.</span><span class="sxs-lookup"><span data-stu-id="b52cb-146">In addition to the potential of swapping out implementations in response to future changes in requirements, application layers can also make it easier to swap out implementations for testing purposes.</span></span> <span data-ttu-id="b52cb-147">Em vez da necessidade de gravar testes que operam na camada de dados reais ou na camada de interface do usuário do aplicativo, essas camadas podem ser substituídas em tempo de teste com implementações fictícias que fornecem respostas conhecidas a solicitações.</span><span class="sxs-lookup"><span data-stu-id="b52cb-147">Instead of having to write tests that operate against the real data layer or UI layer of the application, these layers can be replaced at test time with fake implementations that provide known responses to requests.</span></span> <span data-ttu-id="b52cb-148">Essa abordagem geralmente torna os testes muito mais fáceis de escrever e muito mais rápidos para serem executados em comparação com os testes em execução na infraestrutura real do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-148">This approach typically makes tests much easier to write and much faster to run when compared to running tests against the application's real infrastructure.</span></span>

<span data-ttu-id="b52cb-149">A disposição em camadas lógicas é uma técnica comum para melhorar a organização do código em aplicativos de software empresariais, e há várias maneiras pelas quais o código pode ser organizado em camadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-149">Logical layering is a common technique for improving the organization of code in enterprise software applications, and there are several ways in which code can be organized into layers.</span></span>

> [!NOTE]
 > <span data-ttu-id="b52cb-150">As _camadas_ representam uma separação lógica dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-150">_Layers_ represent logical separation within the application.</span></span> <span data-ttu-id="b52cb-151">Caso a lógica do aplicativo seja fisicamente distribuída em servidores ou processos separados, esses destinos de implantação física separados são chamados de _camadas_.</span><span class="sxs-lookup"><span data-stu-id="b52cb-151">In the event that application logic is physically distributed to separate servers or processes, these separate physical deployment targets are referred to as _tiers_.</span></span> <span data-ttu-id="b52cb-152">É possível, e bastante comum, ter um aplicativo de N-Camadas que é implantado em uma única camada.</span><span class="sxs-lookup"><span data-stu-id="b52cb-152">It's possible, and quite common, to have an N-Layer application that is deployed to a single tier.</span></span>

## <a name="traditional-n-layer-architecture-applications"></a><span data-ttu-id="b52cb-153">Aplicativos tradicionais da arquitetura de "N Camadas"</span><span class="sxs-lookup"><span data-stu-id="b52cb-153">Traditional "N-Layer" architecture applications</span></span>

<span data-ttu-id="b52cb-154">A organização mais comum da lógica do aplicativo em camadas é mostrada na Figura 5-2.</span><span class="sxs-lookup"><span data-stu-id="b52cb-154">The most common organization of application logic into layers is shown in Figure 5-2.</span></span>

![Camadas de aplicativo típicas](./media/image5-2.png)

<span data-ttu-id="b52cb-156">**Figura 5-2.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-156">**Figure 5-2.**</span></span> <span data-ttu-id="b52cb-157">Camadas de aplicativo típicas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-157">Typical application layers.</span></span>

<span data-ttu-id="b52cb-158">Essas camadas são frequentemente abreviadas como interface do usuário, BLL (Camada de Lógica de Negócios) e DAL (Camada de Acesso a Dados).</span><span class="sxs-lookup"><span data-stu-id="b52cb-158">These layers are frequently abbreviated as UI, BLL (Business Logic Layer), and DAL (Data Access Layer).</span></span> <span data-ttu-id="b52cb-159">Usando essa arquitetura, os usuários fazem solicitações por meio da camada de interface do usuário, que interage com a BLL.</span><span class="sxs-lookup"><span data-stu-id="b52cb-159">Using this architecture, users make requests through the UI layer, which interacts only with the BLL.</span></span> <span data-ttu-id="b52cb-160">A BLL, por sua vez, pode chamar a DAL para solicitações de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-160">The BLL, in turn, can call the DAL for data access requests.</span></span> <span data-ttu-id="b52cb-161">A camada de interface do usuário não deve fazer solicitações à DAL diretamente nem interagir com persistência diretamente por outros meios.</span><span class="sxs-lookup"><span data-stu-id="b52cb-161">The UI layer shouldn't make any requests to the DAL directly, nor should it interact with persistence directly through other means.</span></span> <span data-ttu-id="b52cb-162">Da mesma forma, a BLL só deve interagir com persistência por meio da DAL.</span><span class="sxs-lookup"><span data-stu-id="b52cb-162">Likewise, the BLL should only interact with persistence by going through the DAL.</span></span> <span data-ttu-id="b52cb-163">Assim, cada camada tem sua própria responsabilidade conhecida.</span><span class="sxs-lookup"><span data-stu-id="b52cb-163">In this way, each layer has its own well-known responsibility.</span></span>

<span data-ttu-id="b52cb-164">Uma desvantagem dessa abordagem tradicional de disposição em camadas é que as dependências em tempo de compilação são executadas de cima para baixo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-164">One disadvantage of this traditional layering approach is that compile-time dependencies run from the top to the bottom.</span></span> <span data-ttu-id="b52cb-165">Ou seja, a camada de interface do usuário depende da BLL, que depende da DAL.</span><span class="sxs-lookup"><span data-stu-id="b52cb-165">That is, the UI layer depends on the BLL, which depends on the DAL.</span></span> <span data-ttu-id="b52cb-166">Isso significa que a BLL, que normalmente contém a lógica mais importante no aplicativo, depende dos detalhes de implementação de acesso a dados (e geralmente da existência de um banco de dados).</span><span class="sxs-lookup"><span data-stu-id="b52cb-166">This means that the BLL, which usually holds the most important logic in the application, is dependent on data access implementation details (and often on the existence of a database).</span></span> <span data-ttu-id="b52cb-167">O teste da lógica de negócios em uma arquitetura como essa costuma ser difícil, exigindo um banco de dados de teste.</span><span class="sxs-lookup"><span data-stu-id="b52cb-167">Testing business logic in such an architecture is often difficult, requiring a test database.</span></span> <span data-ttu-id="b52cb-168">O princípio da inversão de dependência pode ser usado para resolver esse problema, como você verá na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="b52cb-168">The dependency inversion principle can be used to address this issue, as you'll see in the next section.</span></span>

<span data-ttu-id="b52cb-169">A Figura 5-3 mostra uma solução de exemplo, que divide o aplicativo em três projetos por responsabilidade (ou camada).</span><span class="sxs-lookup"><span data-stu-id="b52cb-169">Figure 5-3 shows an example solution, breaking the application into three projects by responsibility (or layer).</span></span>

![Um aplicativo monolítico simples com três projetos](./media/image5-3.png)

<span data-ttu-id="b52cb-171">**Figura 5-3.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-171">**Figure 5-3.**</span></span> <span data-ttu-id="b52cb-172">Um aplicativo monolítico simples com três projetos.</span><span class="sxs-lookup"><span data-stu-id="b52cb-172">A simple monolithic application with three projects.</span></span>

<span data-ttu-id="b52cb-173">Embora esse aplicativo use vários projetos para fins de organização, ele ainda é implantado como uma única unidade e seus clientes interagirão com ele como um único aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="b52cb-173">Although this application uses several projects for organizational purposes, it's still deployed as a single unit and its clients will interact with it as a single web app.</span></span> <span data-ttu-id="b52cb-174">Isso possibilita um processo de implantação muito simples.</span><span class="sxs-lookup"><span data-stu-id="b52cb-174">This allows for very simple deployment process.</span></span> <span data-ttu-id="b52cb-175">A Figura 5-4 mostra como um aplicativo desse tipo pode ser hospedado usando o Azure.</span><span class="sxs-lookup"><span data-stu-id="b52cb-175">Figure 5-4 shows how such an app might be hosted using Azure.</span></span>

![Implantação simples do Aplicativo Web do Azure](./media/image5-4.png)

<span data-ttu-id="b52cb-177">**Figura 5-4.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-177">**Figure 5-4.**</span></span> <span data-ttu-id="b52cb-178">Implantação simples do Aplicativo Web do Azure</span><span class="sxs-lookup"><span data-stu-id="b52cb-178">Simple deployment of Azure Web App</span></span>

<span data-ttu-id="b52cb-179">Conforme o aplicativo precisar ser aumentado, soluções de implantação mais robustas e complexas poderão ser necessárias.</span><span class="sxs-lookup"><span data-stu-id="b52cb-179">As application needs grow, more complex and robust deployment solutions may be required.</span></span> <span data-ttu-id="b52cb-180">A Figura 5-5 mostra um exemplo de um plano de implantação mais complexo compatível com funcionalidades adicionais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-180">Figure 5-5 shows an example of a more complex deployment plan that supports additional capabilities.</span></span>

![Implantando um aplicativo Web em um Serviço de Aplicativo do Azure](./media/image5-5.png)

<span data-ttu-id="b52cb-182">**Figura 5-5.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-182">**Figure 5-5.**</span></span> <span data-ttu-id="b52cb-183">Implantando um aplicativo Web em um Serviço de Aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="b52cb-183">Deploying a web app to an Azure App Service</span></span>

<span data-ttu-id="b52cb-184">Internamente, a organização desse projeto em vários projetos com base na responsabilidade melhora a facilidade de manutenção do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-184">Internally, this project's organization into multiple projects based on responsibility improves the maintainability of the application.</span></span>

<span data-ttu-id="b52cb-185">Essa unidade pode ser escalada verticalmente ou expandida para aproveitar a escalabilidade sob demanda baseada em nuvem.</span><span class="sxs-lookup"><span data-stu-id="b52cb-185">This unit can be scaled up or out to take advantage of cloud-based on-demand scalability.</span></span> <span data-ttu-id="b52cb-186">Escalar verticalmente significa adicionar mais CPU, memória, espaço em disco ou outros recursos aos servidores que hospedam o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-186">Scaling up means adding additional CPU, memory, disk space, or other resources to the server(s) hosting your app.</span></span> <span data-ttu-id="b52cb-187">Escalar horizontalmente significa adicionar mais instâncias desses servidores, sejam eles servidores físicos, máquinas virtuais ou contêineres.</span><span class="sxs-lookup"><span data-stu-id="b52cb-187">Scaling out means adding additional instances of such servers, whether these are physical servers, virtual machines, or containers.</span></span> <span data-ttu-id="b52cb-188">Quando o aplicativo é hospedado em várias instâncias, um balanceador de carga é usado para atribuir solicitações a instâncias individuais do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-188">When your app is hosted across multiple instances, a load balancer is used to assign requests to individual app instances.</span></span>

<span data-ttu-id="b52cb-189">A abordagem mais simples para dimensionar um aplicativo Web no Azure é configurar o dimensionamento manualmente no Plano do Serviço de Aplicativo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-189">The simplest approach to scaling a web application in Azure is to configure scaling manually in the application's App Service Plan.</span></span> <span data-ttu-id="b52cb-190">A Figura 5-6 mostra a tela apropriada do painel do Azure para configurar a quantidade de instâncias que atendem um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-190">Figure 5-6 shows the appropriate Azure dashboard screen to configure how many instances are serving an app.</span></span>

![Dimensionamento do plano do serviço de aplicativo no Azure](./media/image5-6.png)

<span data-ttu-id="b52cb-192">**Figura 5-6.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-192">**Figure 5-6.**</span></span> <span data-ttu-id="b52cb-193">Dimensionamento do Plano do Serviço de Aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="b52cb-193">App Service Plan scaling in Azure.</span></span>

## <a name="clean-architecture"></a><span data-ttu-id="b52cb-194">Arquitetura limpa</span><span class="sxs-lookup"><span data-stu-id="b52cb-194">Clean architecture</span></span>

<span data-ttu-id="b52cb-195">Os aplicativos que seguem o Princípio da Inversão de Dependência, bem como os princípios de DDD (Design Controlado por Domínio), tendem a chegar a uma arquitetura semelhante.</span><span class="sxs-lookup"><span data-stu-id="b52cb-195">Applications that follow the Dependency Inversion Principle as well as the Domain-Driven Design (DDD) principles tend to arrive at a similar architecture.</span></span> <span data-ttu-id="b52cb-196">Essa arquitetura foi conhecida por muitos nomes ao longo dos anos.</span><span class="sxs-lookup"><span data-stu-id="b52cb-196">This architecture has gone by many names over the years.</span></span> <span data-ttu-id="b52cb-197">Um dos primeiros nomes foi Arquitetura Hexagonal, seguido por Portas e Adaptadores.</span><span class="sxs-lookup"><span data-stu-id="b52cb-197">One of the first names was Hexagonal Architecture, followed by Ports-and-Adapters.</span></span> <span data-ttu-id="b52cb-198">Mais recentemente, ela é citada como a [Arquitetura Cebola](https://jeffreypalermo.com/blog/the-onion-architecture-part-1/) ou [Arquitetura Limpa](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html).</span><span class="sxs-lookup"><span data-stu-id="b52cb-198">More recently, it's been cited as the [Onion Architecture](https://jeffreypalermo.com/blog/the-onion-architecture-part-1/) or [Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html).</span></span> <span data-ttu-id="b52cb-199">O último nome, Arquitetura Limpa, é usado como o nome dessa arquitetura neste livro eletrônico.</span><span class="sxs-lookup"><span data-stu-id="b52cb-199">The latter name, Clean Architecture, is used as the name for this architecture in this e-book.</span></span>

<span data-ttu-id="b52cb-200">O aplicativo de referência eShopOnWeb usa a abordagem de arquitetura limpa para organizar seu código em projetos.</span><span class="sxs-lookup"><span data-stu-id="b52cb-200">The eShopOnWeb reference application uses the Clean Architecture approach in organizing its code into projects.</span></span> <span data-ttu-id="b52cb-201">Você pode encontrar um modelo de solução que pode ser usado como um ponto de partida para seu próprio ASP.NET Core no repositório GitHub [ardalis/cleanarchitecture](https://github.com/ardalis/cleanarchitecture) .</span><span class="sxs-lookup"><span data-stu-id="b52cb-201">You can find a solution template you can use as a starting point for your own ASP.NET Core on the [ardalis/cleanarchitecture](https://github.com/ardalis/cleanarchitecture) GitHub repository.</span></span>

<span data-ttu-id="b52cb-202">A arquitetura limpa coloca a lógica de negócios e o modelo de aplicativo no centro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-202">Clean architecture puts the business logic and application model at the center of the application.</span></span> <span data-ttu-id="b52cb-203">Em vez de fazer com que a lógica de negócios dependa do acesso a dados ou de outros interesses da infraestrutura, essa dependência é invertida: os detalhes de implementação e a infraestrutura dependem do Núcleo do Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-203">Instead of having business logic depend on data access or other infrastructure concerns, this dependency is inverted: infrastructure and implementation details depend on the Application Core.</span></span> <span data-ttu-id="b52cb-204">Essa funcionalidade é obtida definindo-se abstrações, ou interfaces, no núcleo do aplicativo, que são implementadas por tipos definidos na camada de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-204">This functionality is achieved by defining abstractions, or interfaces, in the Application Core, which are then implemented by types defined in the Infrastructure layer.</span></span> <span data-ttu-id="b52cb-205">Uma maneira comum de visualizar essa arquitetura é usar uma série de círculos concêntricos, semelhantes a uma cebola.</span><span class="sxs-lookup"><span data-stu-id="b52cb-205">A common way of visualizing this architecture is to use a series of concentric circles, similar to an onion.</span></span> <span data-ttu-id="b52cb-206">A Figura 5-7 mostra um exemplo desse estilo de representação de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-206">Figure 5-7 shows an example of this style of architectural representation.</span></span>

![Arquitetura Limpa; exibição de cebola](./media/image5-7.png)

<span data-ttu-id="b52cb-208">**Figura 5-7.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-208">**Figure 5-7.**</span></span> <span data-ttu-id="b52cb-209">Arquitetura Limpa; exibição de cebola</span><span class="sxs-lookup"><span data-stu-id="b52cb-209">Clean Architecture; onion view</span></span>

<span data-ttu-id="b52cb-210">Nesse diagrama, as dependências fluem para o círculo interno.</span><span class="sxs-lookup"><span data-stu-id="b52cb-210">In this diagram, dependencies flow toward the innermost circle.</span></span> <span data-ttu-id="b52cb-211">O núcleo do aplicativo obtém seu nome por meio de sua posição no centro desse diagrama.</span><span class="sxs-lookup"><span data-stu-id="b52cb-211">The Application Core takes its name from its position at the core of this diagram.</span></span> <span data-ttu-id="b52cb-212">E você pode ver no diagrama que o Núcleo do Aplicativo não tem dependências de outras camadas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-212">And you can see on the diagram that the Application Core has no dependencies on other application layers.</span></span> <span data-ttu-id="b52cb-213">As entidades e as interfaces do aplicativo ficam bem no centro.</span><span class="sxs-lookup"><span data-stu-id="b52cb-213">The application's entities and interfaces are at the very center.</span></span> <span data-ttu-id="b52cb-214">Fora dele, mas ainda no Núcleo do Aplicativo, estão os serviços de domínio, que normalmente implementam interfaces definidas no círculo interno.</span><span class="sxs-lookup"><span data-stu-id="b52cb-214">Just outside, but still in the Application Core, are domain services, which typically implement interfaces defined in the inner circle.</span></span> <span data-ttu-id="b52cb-215">Fora do Núcleo do Aplicativo, as camadas de Interface do Usuário e de Infraestrutura dependem do Núcleo do Aplicativo, mas não (necessariamente) uma da outra.</span><span class="sxs-lookup"><span data-stu-id="b52cb-215">Outside of the Application Core, both the UI and the Infrastructure layers depend on the Application Core, but not on one another (necessarily).</span></span>

<span data-ttu-id="b52cb-216">A Figura 5-8 mostra um diagrama de camada horizontal mais tradicional que reflete melhor a dependência entre a interface do usuário e as outras camadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-216">Figure 5-8 shows a more traditional horizontal layer diagram that better reflects the dependency between the UI and other layers.</span></span>

![Arquitetura Limpa; exibição de camada horizontal](./media/image5-8.png)

<span data-ttu-id="b52cb-218">**Figura 5-8.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-218">**Figure 5-8.**</span></span> <span data-ttu-id="b52cb-219">Arquitetura Limpa; exibição de camada horizontal</span><span class="sxs-lookup"><span data-stu-id="b52cb-219">Clean Architecture; horizontal layer view</span></span>

<span data-ttu-id="b52cb-220">Observe que as setas sólidas representam as dependências em tempo de compilação, enquanto a seta tracejada representa uma dependência somente em runtime.</span><span class="sxs-lookup"><span data-stu-id="b52cb-220">Note that the solid arrows represent compile-time dependencies, while the dashed arrow represents a runtime-only dependency.</span></span> <span data-ttu-id="b52cb-221">Usando a arquitetura limpa, a camada de interface do usuário funciona com as interfaces definidas no Núcleo do Aplicativo no tempo de compilação. O ideal é que ela não tenha conhecimento dos tipos de implementação definidos na camada de Infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-221">With the clean architecture, the UI layer works with interfaces defined in the Application Core at compile time, and ideally shouldn't know about the implementation types defined in the Infrastructure layer.</span></span> <span data-ttu-id="b52cb-222">No entanto, no tempo de execução, esses tipos de implementação serão necessários para a execução do aplicativo e, portanto, precisam estar presentes e conectados às interfaces do Núcleo do Aplicativo por meio da injeção de dependência.</span><span class="sxs-lookup"><span data-stu-id="b52cb-222">At run time, however, these implementation types are required for the app to execute, so they need to be present and wired up to the Application Core interfaces via dependency injection.</span></span>

<span data-ttu-id="b52cb-223">A Figura 5-9 mostra uma exibição mais detalhada da arquitetura de um aplicativo ASP.NET Core quando criado seguindo essas recomendações.</span><span class="sxs-lookup"><span data-stu-id="b52cb-223">Figure 5-9 shows a more detailed view of an ASP.NET Core application's architecture when built following these recommendations.</span></span>

![Diagrama de arquitetura de ASP.NET Core seguindo a arquitetura limpa](./media/image5-9.png)

<span data-ttu-id="b52cb-225">**Figura 5-9.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-225">**Figure 5-9.**</span></span> <span data-ttu-id="b52cb-226">Diagrama da arquitetura do ASP.NET Core que segue a Arquitetura Limpa.</span><span class="sxs-lookup"><span data-stu-id="b52cb-226">ASP.NET Core architecture diagram following Clean Architecture.</span></span>

<span data-ttu-id="b52cb-227">Como o Núcleo do Aplicativo não depende da Infraestrutura, é muito fácil escrever testes de unidade automatizados para essa camada.</span><span class="sxs-lookup"><span data-stu-id="b52cb-227">Because the Application Core doesn't depend on Infrastructure, it's very easy to write automated unit tests for this layer.</span></span> <span data-ttu-id="b52cb-228">A Figuras 5-10 e 5-11 mostram como os testes se enquadram nessa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-228">Figures 5-10 and 5-11 show how tests fit into this architecture.</span></span>

![UnitTestCore](./media/image5-10.png)

<span data-ttu-id="b52cb-230">**Figura 5-10.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-230">**Figure 5-10.**</span></span> <span data-ttu-id="b52cb-231">Realizando o teste de unidade do Núcleo do Aplicativo em isolamento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-231">Unit testing Application Core in isolation.</span></span>

![IntegrationTests](./media/image5-11.png)

<span data-ttu-id="b52cb-233">**Figura 5-11.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-233">**Figure 5-11.**</span></span> <span data-ttu-id="b52cb-234">Realizando o teste de integração de implementações de Infraestrutura com dependências externas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-234">Integration testing Infrastructure implementations with external dependencies.</span></span>

<span data-ttu-id="b52cb-235">Como a camada de interface do usuário não tem nenhuma dependência direta dos tipos definidos no projeto de Infraestrutura, da mesma forma, é muito fácil alternar entre implementações, para facilitar o teste ou em resposta a alterações nos requisitos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-235">Since the UI layer doesn't have any direct dependency on types defined in the Infrastructure project, it's likewise very easy to swap out implementations, either to facilitate testing or in response to changing application requirements.</span></span> <span data-ttu-id="b52cb-236">O uso interno do ASP.NET Core e o suporte à injeção de dependência torna essa arquitetura a maneira mais apropriada de estruturar aplicativos monolíticos não triviais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-236">ASP.NET Core's built-in use of and support for dependency injection makes this architecture the most appropriate way to structure non-trivial monolithic applications.</span></span>

<span data-ttu-id="b52cb-237">Para aplicativos monolíticos, o núcleo do aplicativo, a infraestrutura e os projetos de interface do usuário são executados como um único aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-237">For monolithic applications, the Application Core, Infrastructure, and UI projects are all run as a single application.</span></span> <span data-ttu-id="b52cb-238">A arquitetura do aplicativo em runtime pode ser semelhante à Figura 5-12.</span><span class="sxs-lookup"><span data-stu-id="b52cb-238">The runtime application architecture might look something like Figure 5-12.</span></span>

![Arquitetura do ASP.NET Core 2](./media/image5-12.png)

<span data-ttu-id="b52cb-240">**Figura 5-12.**</span><span class="sxs-lookup"><span data-stu-id="b52cb-240">**Figure 5-12.**</span></span> <span data-ttu-id="b52cb-241">Arquitetura em runtime de um aplicativo ASP.NET Core de exemplo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-241">A sample ASP.NET Core app's runtime architecture.</span></span>

### <a name="organizing-code-in-clean-architecture"></a><span data-ttu-id="b52cb-242">Organizando o código na arquitetura limpa</span><span class="sxs-lookup"><span data-stu-id="b52cb-242">Organizing code in Clean Architecture</span></span>

<span data-ttu-id="b52cb-243">Em uma solução de Arquitetura Limpa, cada projeto tem responsabilidades bem-definidas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-243">In a Clean Architecture solution, each project has clear responsibilities.</span></span> <span data-ttu-id="b52cb-244">Assim, determinados tipos pertencem a cada projeto e, com frequência, haverá pastas correspondentes a esses tipos no projeto apropriado.</span><span class="sxs-lookup"><span data-stu-id="b52cb-244">As such, certain types belong in each project and you'll frequently find folders corresponding to these types in the appropriate project.</span></span>

#### <a name="application-core"></a><span data-ttu-id="b52cb-245">Núcleo do aplicativo</span><span class="sxs-lookup"><span data-stu-id="b52cb-245">Application Core</span></span>

<span data-ttu-id="b52cb-246">O Núcleo do Aplicativo contém o modelo de negócios, que inclui entidades, serviços e interfaces.</span><span class="sxs-lookup"><span data-stu-id="b52cb-246">The Application Core holds the business model, which includes entities, services, and interfaces.</span></span> <span data-ttu-id="b52cb-247">Essas interfaces incluem abstrações para operações que serão executadas usando a infraestrutura, como acesso a dados, acesso ao sistema de arquivos, chamadas de rede, etc. Às vezes, serviços ou interfaces definidos nessa camada precisarão trabalhar com tipos que não sejam de entidade que não tenham dependências na interface do usuário ou na infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-247">These interfaces include abstractions for operations that will be performed using Infrastructure, such as data access, file system access, network calls, etc. Sometimes services or interfaces defined at this layer will need to work with non-entity types that have no dependencies on UI or Infrastructure.</span></span> <span data-ttu-id="b52cb-248">Eles podem ser definidos como DTOs (Objetos de Transferência de Dados) simples.</span><span class="sxs-lookup"><span data-stu-id="b52cb-248">These can be defined as simple Data Transfer Objects (DTOs).</span></span>

##### <a name="application-core-types"></a><span data-ttu-id="b52cb-249">Tipos de Núcleo do Aplicativo</span><span class="sxs-lookup"><span data-stu-id="b52cb-249">Application Core types</span></span>

- <span data-ttu-id="b52cb-250">Entidades (classes de modelo de negócios que são persistidas)</span><span class="sxs-lookup"><span data-stu-id="b52cb-250">Entities (business model classes that are persisted)</span></span>
- <span data-ttu-id="b52cb-251">Interfaces</span><span class="sxs-lookup"><span data-stu-id="b52cb-251">Interfaces</span></span>
- <span data-ttu-id="b52cb-252">Serviços</span><span class="sxs-lookup"><span data-stu-id="b52cb-252">Services</span></span>
- <span data-ttu-id="b52cb-253">DTOs</span><span class="sxs-lookup"><span data-stu-id="b52cb-253">DTOs</span></span>

#### <a name="infrastructure"></a><span data-ttu-id="b52cb-254">Infraestrutura</span><span class="sxs-lookup"><span data-stu-id="b52cb-254">Infrastructure</span></span>

<span data-ttu-id="b52cb-255">O projeto de Infraestrutura normalmente incluirá implementações de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-255">The Infrastructure project typically includes data access implementations.</span></span> <span data-ttu-id="b52cb-256">Em um aplicativo Web ASP.NET Core típico, essas implementações incluem o DbContext do EF (Entity Framework), todos os objetos `Migration` do EF Core que foram definidos e as classes de implementação de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-256">In a typical ASP.NET Core web application, these implementations include the Entity Framework (EF) DbContext, any EF Core `Migration` objects that have been defined, and data access implementation classes.</span></span> <span data-ttu-id="b52cb-257">A maneira mais comum de abstrair o código de implementação de acesso a dados é pelo uso do [padrão de design de Repositório](https://deviq.com/repository-pattern/).</span><span class="sxs-lookup"><span data-stu-id="b52cb-257">The most common way to abstract data access implementation code is through the use of the [Repository design pattern](https://deviq.com/repository-pattern/).</span></span>

<span data-ttu-id="b52cb-258">Além das implementações de acesso a dados, o projeto de Infraestrutura deve conter implementações de serviços que devem interagir com os interesses de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-258">In addition to data access implementations, the Infrastructure project should contain implementations of services that must interact with infrastructure concerns.</span></span> <span data-ttu-id="b52cb-259">Esses serviços devem implementar as interfaces definidas no Núcleo do Aplicativo e, portanto, a Infraestrutura deve ter uma referência ao projeto de Núcleo do Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-259">These services should implement interfaces defined in the Application Core, and so Infrastructure should have a reference to the Application Core project.</span></span>

##### <a name="infrastructure-types"></a><span data-ttu-id="b52cb-260">Tipos de infraestrutura</span><span class="sxs-lookup"><span data-stu-id="b52cb-260">Infrastructure types</span></span>

- <span data-ttu-id="b52cb-261">Tipos do EF Core (`DbContext`, `Migration`)</span><span class="sxs-lookup"><span data-stu-id="b52cb-261">EF Core types (`DbContext`, `Migration`)</span></span>
- <span data-ttu-id="b52cb-262">Tipos de implementação de acesso a dados (Repositórios)</span><span class="sxs-lookup"><span data-stu-id="b52cb-262">Data access implementation types (Repositories)</span></span>
- <span data-ttu-id="b52cb-263">Serviços específicos de infraestrutura (por exemplo, `FileLogger` ou `SmtpNotifier`)</span><span class="sxs-lookup"><span data-stu-id="b52cb-263">Infrastructure-specific services (for example, `FileLogger` or `SmtpNotifier`)</span></span>

#### <a name="ui-layer"></a><span data-ttu-id="b52cb-264">Camada de interface do usuário</span><span class="sxs-lookup"><span data-stu-id="b52cb-264">UI Layer</span></span>

<span data-ttu-id="b52cb-265">A camada de interface do usuário em um aplicativo ASP.NET Core MVC é o ponto de entrada para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-265">The user interface layer in an ASP.NET Core MVC application is the entry point for the application.</span></span> <span data-ttu-id="b52cb-266">Esse projeto deve referenciar o projeto de Núcleo do Aplicativo e seus tipos devem interagir com a infraestrutura estritamente por meio das interfaces definidas no Núcleo do Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-266">This project should reference the Application Core project, and its types should interact with infrastructure strictly through interfaces defined in Application Core.</span></span> <span data-ttu-id="b52cb-267">Não deve ser permitida nenhuma criação de instância direta de tipos da camada de Infraestrutura nem nenhuma chamada estática a esses tipos na camada de interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="b52cb-267">No direct instantiation of or static calls to the Infrastructure layer types should be allowed in the UI layer.</span></span>

##### <a name="ui-layer-types"></a><span data-ttu-id="b52cb-268">Tipos de camada de interface do usuário</span><span class="sxs-lookup"><span data-stu-id="b52cb-268">UI Layer types</span></span>

- <span data-ttu-id="b52cb-269">Controladores</span><span class="sxs-lookup"><span data-stu-id="b52cb-269">Controllers</span></span>
- <span data-ttu-id="b52cb-270">Filtros</span><span class="sxs-lookup"><span data-stu-id="b52cb-270">Filters</span></span>
- <span data-ttu-id="b52cb-271">Exibições</span><span class="sxs-lookup"><span data-stu-id="b52cb-271">Views</span></span>
- <span data-ttu-id="b52cb-272">ViewModels</span><span class="sxs-lookup"><span data-stu-id="b52cb-272">ViewModels</span></span>
- <span data-ttu-id="b52cb-273">Inicialização</span><span class="sxs-lookup"><span data-stu-id="b52cb-273">Startup</span></span>

<span data-ttu-id="b52cb-274">A classe Startup é responsável por configurar o aplicativo e conectar os tipos de implementação às interfaces, permitindo que a injeção de dependência funcione corretamente em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="b52cb-274">The Startup class is responsible for configuring the application, and for wiring up implementation types to interfaces, allowing dependency injection to work properly at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="b52cb-275">Para conectar a injeção de dependência em ConfigureServices no arquivo Startup.cs do projeto de interface do usuário, o projeto poderá precisar referenciar o projeto de Infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-275">In order to wire up dependency injection in ConfigureServices in the Startup.cs file of the UI project, the project may need to reference the Infrastructure project.</span></span> <span data-ttu-id="b52cb-276">Essa dependência pode ser eliminada com mais facilidade por meio de um contêiner de DI personalizado.</span><span class="sxs-lookup"><span data-stu-id="b52cb-276">This dependency can be eliminated, most easily by using a custom DI container.</span></span> <span data-ttu-id="b52cb-277">Para as finalidades desta amostra, a abordagem mais simples é permitir que o projeto de interface do usuário referencie o projeto de Infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-277">For the purposes of this sample, the simplest approach is to allow the UI project to reference the Infrastructure project.</span></span>

## <a name="monolithic-applications-and-containers"></a><span data-ttu-id="b52cb-278">Contêineres e aplicativos monolíticos</span><span class="sxs-lookup"><span data-stu-id="b52cb-278">Monolithic applications and containers</span></span>

<span data-ttu-id="b52cb-279">Você pode criar um Aplicativo ou Serviço Web baseado em uma implantação única e monolítica e implantá-lo como um contêiner.</span><span class="sxs-lookup"><span data-stu-id="b52cb-279">You can build a single and monolithic-deployment based Web Application or Service and deploy it as a container.</span></span> <span data-ttu-id="b52cb-280">Dentro do aplicativo, ele pode não ser monolítico, mas organizado em várias bibliotecas, componentes ou camadas.</span><span class="sxs-lookup"><span data-stu-id="b52cb-280">Within the application, it might not be monolithic but organized into several libraries, components, or layers.</span></span> <span data-ttu-id="b52cb-281">Externamente, ele é um único contêiner, como um único processo, um único aplicativo Web ou um único serviço.</span><span class="sxs-lookup"><span data-stu-id="b52cb-281">Externally, it's a single container like a single process, single web application, or single service.</span></span>

<span data-ttu-id="b52cb-282">Para gerenciar esse modelo, implante um contêiner único para representar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-282">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="b52cb-283">Para dimensionar, basta adicionar mais cópias com um balanceador de carga na frente.</span><span class="sxs-lookup"><span data-stu-id="b52cb-283">To scale, just add additional copies with a load balancer in front.</span></span> <span data-ttu-id="b52cb-284">A simplicidade está em gerenciar um a implantação única em um contêiner ou VM único.</span><span class="sxs-lookup"><span data-stu-id="b52cb-284">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![Figura 5-13](./media/image5-13.png)

<span data-ttu-id="b52cb-286">É possível incluir vários componentes/bibliotecas ou camadas internas em cada contêiner, conforme ilustrado na Figura 5-13.</span><span class="sxs-lookup"><span data-stu-id="b52cb-286">You can include multiple components/libraries or internal layers within each container, as illustrated in Figure 5-13.</span></span> <span data-ttu-id="b52cb-287">Mas, seguindo o princípio de contêiner de _"um contêiner executa uma ação e faz isso em um processo_", o padrão monolítico pode gerar um conflito.</span><span class="sxs-lookup"><span data-stu-id="b52cb-287">But, following the container principle of _"a container does one thing, and does it in one process_", the monolithic pattern might be a conflict.</span></span>

<span data-ttu-id="b52cb-288">O ponto negativo dessa abordagem ficará evidente se ou quando o aplicativo crescer e for necessário dimensioná-lo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-288">The downside of this approach comes if/when the application grows, requiring it to scale.</span></span> <span data-ttu-id="b52cb-289">Não haverá problema se o aplicativo inteiro for dimensionado.</span><span class="sxs-lookup"><span data-stu-id="b52cb-289">If the entire application scales, it's not really a problem.</span></span> <span data-ttu-id="b52cb-290">Entretanto, na maioria dos casos, apenas algumas partes do aplicativo são os pontos de redução que exigem dimensionamento, enquanto outros componentes são menos utilizados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-290">However, in most cases, a few parts of the application are the choke points requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="b52cb-291">Usando o exemplo de comércio eletrônico típico, o que você provavelmente precisa dimensionar é o componente de informações do produto.</span><span class="sxs-lookup"><span data-stu-id="b52cb-291">Using the typical eCommerce example, what you likely need to scale is the product information component.</span></span> <span data-ttu-id="b52cb-292">Uma quantidade muito maior de clientes procura produtos em vez de comprá-los.</span><span class="sxs-lookup"><span data-stu-id="b52cb-292">Many more customers browse products than purchase them.</span></span> <span data-ttu-id="b52cb-293">Mais clientes usam o carrinho em vez do pipeline de pagamento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-293">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="b52cb-294">Menos clientes fazem comentários ou exibem o histórico de compras.</span><span class="sxs-lookup"><span data-stu-id="b52cb-294">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="b52cb-295">E você provavelmente tem apenas um grupo de funcionários, em uma única região, que precisa gerenciar o conteúdo e as campanhas de marketing.</span><span class="sxs-lookup"><span data-stu-id="b52cb-295">And you likely only have a handful of employees, in a single region, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="b52cb-296">Ao dimensionar o design monolítico, todo o código é implantado várias vezes.</span><span class="sxs-lookup"><span data-stu-id="b52cb-296">By scaling the monolithic design, all the code is deployed multiple times.</span></span>

<span data-ttu-id="b52cb-297">Além do problema de “ter que dimensionar tudo”, a alteração de um único componente exige um novo teste completo de todo o aplicativo e uma reimplantação completa de todas as instâncias.</span><span class="sxs-lookup"><span data-stu-id="b52cb-297">In addition to the "scale everything" problem, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="b52cb-298">A abordagem monolítica é comum e muitas organizações estão desenvolvendo aplicativos com essa abordagem de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="b52cb-298">The monolithic approach is common, and many organizations are developing with this architectural approach.</span></span> <span data-ttu-id="b52cb-299">Muitas estão tendo resultados bons o suficiente, enquanto outras estão atingindo os limites.</span><span class="sxs-lookup"><span data-stu-id="b52cb-299">Many are having good enough results, while others are hitting limits.</span></span> <span data-ttu-id="b52cb-300">Muitas criaram seus aplicativos nesse modelo porque as ferramentas e a infraestrutura eram muito difíceis para criar SOAs (arquiteturas orientadas a serviços) e elas não viam a necessidade até que o aplicativo crescesse.</span><span class="sxs-lookup"><span data-stu-id="b52cb-300">Many designed their applications in this model, because the tools and infrastructure were too difficult to build service-oriented architectures (SOA), and they didn't see the need until the app grew.</span></span> <span data-ttu-id="b52cb-301">Se você achar que está chegando ao limite da abordagem monolítica, a divisão do aplicativo para permitir que ele aproveite melhor os contêineres e os microsserviços poderá ser a próxima etapa lógica.</span><span class="sxs-lookup"><span data-stu-id="b52cb-301">If you find you're hitting the limits of the monolithic approach, breaking up the app to enable it to better leverage containers and microservices may be the next logical step.</span></span>

![Figura 5-14](./media/image5-14.png)

<span data-ttu-id="b52cb-303">A implantação de aplicativos monolíticos no Microsoft Azure pode ser feita por meio de VMs dedicadas para cada instância.</span><span class="sxs-lookup"><span data-stu-id="b52cb-303">Deploying monolithic applications in Microsoft Azure can be achieved using dedicated VMs for each instance.</span></span> <span data-ttu-id="b52cb-304">Usando [Conjuntos de Dimensionamento de Máquinas Virtuais do Azure](/azure/virtual-machine-scale-sets/), você pode dimensionar VMs facilmente.</span><span class="sxs-lookup"><span data-stu-id="b52cb-304">Using [Azure Virtual Machine Scale Sets](/azure/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="b52cb-305">Os [Serviços de Aplicativos do Azure](https://azure.microsoft.com/services/app-service/) podem executar aplicativos monolíticos e dimensionar instâncias com facilidade, sem a necessidade de gerenciar as VMs.</span><span class="sxs-lookup"><span data-stu-id="b52cb-305">[Azure App Services](https://azure.microsoft.com/services/app-service/) can run monolithic applications and easily scale instances without having to manage the VMs.</span></span> <span data-ttu-id="b52cb-306">Os Serviços de Aplicativos do Azure também podem executar instâncias únicas de contêineres do Docker, simplificando a implantação.</span><span class="sxs-lookup"><span data-stu-id="b52cb-306">Azure App Services can run single instances of Docker containers as well, simplifying the deployment.</span></span> <span data-ttu-id="b52cb-307">Usando o Docker, você pode implantar uma única VM como um host do Docker e executar várias instâncias.</span><span class="sxs-lookup"><span data-stu-id="b52cb-307">Using Docker, you can deploy a single VM as a Docker host, and run multiple instances.</span></span> <span data-ttu-id="b52cb-308">Usando o balanceador do Azure, conforme mostrado na Figura 5-14, você pode gerenciar o dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-308">Using the Azure balancer, as shown in the Figure 5-14, you can manage scaling.</span></span>

<span data-ttu-id="b52cb-309">A implantação em vários hosts pode ser gerenciada com técnicas de implantação tradicionais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-309">The deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="b52cb-310">Os hosts do Docker podem ser gerenciados manualmente com comandos como **docker run** executados manualmente ou por meio da automação, como os pipelines de CD (Entrega Contínua).</span><span class="sxs-lookup"><span data-stu-id="b52cb-310">The Docker hosts can be managed with commands like **docker run** performed manually, or through automation such as Continuous Delivery (CD) pipelines.</span></span>

### <a name="monolithic-application-deployed-as-a-container"></a><span data-ttu-id="b52cb-311">Aplicativo monolítico implantado como um contêiner</span><span class="sxs-lookup"><span data-stu-id="b52cb-311">Monolithic application deployed as a container</span></span>

<span data-ttu-id="b52cb-312">Há benefícios no uso de contêineres para gerenciar implantações de aplicativos monolíticos.</span><span class="sxs-lookup"><span data-stu-id="b52cb-312">There are benefits of using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="b52cb-313">O dimensionamento das instâncias de contêineres é muito mais rápido e fácil do que a implantação de VMs adicionais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-313">Scaling the instances of containers is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="b52cb-314">Mesmo quando você usa conjuntos de dimensionamento de máquinas virtuais para dimensionar VMs, a criação de instância das VMs é demorada.</span><span class="sxs-lookup"><span data-stu-id="b52cb-314">Even when using virtual machine scale sets to scale VMs, they take time to instance.</span></span> <span data-ttu-id="b52cb-315">Quando implantada como instâncias de aplicativo, a configuração do aplicativo é gerenciada como parte da VM.</span><span class="sxs-lookup"><span data-stu-id="b52cb-315">When deployed as app instances, the configuration of the app is managed as part of the VM.</span></span>

<span data-ttu-id="b52cb-316">Implantar atualizações como imagens do Docker é muito mais rápido e eficiente em termos de rede.</span><span class="sxs-lookup"><span data-stu-id="b52cb-316">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="b52cb-317">As Imagens do Docker costumam ser iniciadas em segundos, o que agiliza as distribuições.</span><span class="sxs-lookup"><span data-stu-id="b52cb-317">Docker Images typically start in seconds, speeding rollouts.</span></span> <span data-ttu-id="b52cb-318">Desmontar uma instância do Docker é tão fácil quanto emitir um comando `docker stop` e geralmente leva menos de um segundo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-318">Tearing down a Docker instance is as easy as issuing a `docker stop` command, typically completing in less than a second.</span></span>

<span data-ttu-id="b52cb-319">Como os contêineres são, de forma inerente, imutáveis por design, você nunca precisa se preocupar com VMs corrompidas, enquanto os scripts de atualização podem se esquecer de considerar uma configuração específica ou um arquivo deixado no disco.</span><span class="sxs-lookup"><span data-stu-id="b52cb-319">As containers are inherently immutable by design, you never need to worry about corrupted VMs, whereas update scripts might forget to account for some specific configuration or file left on the disk.</span></span>

<span data-ttu-id="b52cb-320">Você pode usar contêineres do Docker para uma implantação monolítica de aplicativos Web mais simples.</span><span class="sxs-lookup"><span data-stu-id="b52cb-320">You can use Docker containers for a monolithic deployment of simpler web applications.</span></span> <span data-ttu-id="b52cb-321">Essa abordagem melhora a integração contínua e os pipelines de implantação contínua e ajuda a atingir o sucesso da implantação para a produção.</span><span class="sxs-lookup"><span data-stu-id="b52cb-321">This approach improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success.</span></span> <span data-ttu-id="b52cb-322">Não mais "ele funciona em meu computador, por que ele não funciona em produção?"</span><span class="sxs-lookup"><span data-stu-id="b52cb-322">No more “It works on my machine, why does it not work in production?”</span></span>

<span data-ttu-id="b52cb-323">Uma arquitetura baseada em microsserviços tem muitos benefícios, mas esses benefícios são fornecidos ao custo do aumento da complexidade.</span><span class="sxs-lookup"><span data-stu-id="b52cb-323">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="b52cb-324">Em alguns casos, os custos superam os benefícios, portanto, um aplicativo de implantação monolítica em execução em um único contêiner ou em alguns contêineres é uma opção melhor.</span><span class="sxs-lookup"><span data-stu-id="b52cb-324">In some cases, the costs outweigh the benefits, so a monolithic deployment application running in a single container or in just a few containers is a better option.</span></span>

<span data-ttu-id="b52cb-325">Um aplicativo monolítico não pode ser facilmente decomposto em microsserviços bem separados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-325">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="b52cb-326">Os microsserviços devem funcionar independentemente uns dos outros para fornecer um aplicativo mais resiliente.</span><span class="sxs-lookup"><span data-stu-id="b52cb-326">Microservices should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="b52cb-327">Se você não puder entregar fatias independentes de recurso do aplicativo, separá-las apenas aumentará a complexidade.</span><span class="sxs-lookup"><span data-stu-id="b52cb-327">If you can't deliver independent feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="b52cb-328">Talvez o aplicativo ainda não precise dimensionar recursos de modo independente.</span><span class="sxs-lookup"><span data-stu-id="b52cb-328">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="b52cb-329">Muitos aplicativos, quando precisam ser dimensionados para mais de uma única instância, podem passar pelo processo relativamente simples de clonagem da instância inteira.</span><span class="sxs-lookup"><span data-stu-id="b52cb-329">Many applications, when they need to scale beyond a single instance, can do so through the relatively simple process of cloning that entire instance.</span></span> <span data-ttu-id="b52cb-330">O trabalho adicional para separar o aplicativo em serviços discretos fornece um benefício mínimo ao dimensionar as instâncias completas do aplicativo é simples e econômico.</span><span class="sxs-lookup"><span data-stu-id="b52cb-330">The additional work to separate the application into discrete services provides a minimal benefit when scaling full instances of the application is simple and cost-effective.</span></span>

<span data-ttu-id="b52cb-331">No início do desenvolvimento de um aplicativo, você pode não ter uma ideia clara de onde estão os limites funcionais naturais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-331">Early in the development of an application, you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="b52cb-332">Mesmo depois de desenvolve rum produto mínimo viável, a separação natural pode ainda não ter surgido.</span><span class="sxs-lookup"><span data-stu-id="b52cb-332">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span> <span data-ttu-id="b52cb-333">Algumas dessas condições podem ser temporárias.</span><span class="sxs-lookup"><span data-stu-id="b52cb-333">Some of these conditions might be temporary.</span></span> <span data-ttu-id="b52cb-334">Você pode começar criando um aplicativo monolítico e posteriormente separar alguns recursos para serem desenvolvidos e implantados como microsserviços.</span><span class="sxs-lookup"><span data-stu-id="b52cb-334">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="b52cb-335">Outras condições podem ser essenciais para o espaço problemático do aplicativo, o que significa que o aplicativo pode nunca ser dividido em vários microserviços.</span><span class="sxs-lookup"><span data-stu-id="b52cb-335">Other conditions might be essential to the application's problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="b52cb-336">A separação de um aplicativo em vários processos distintos também apresenta sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="b52cb-336">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="b52cb-337">É mais complexo separar recursos em processos diferentes.</span><span class="sxs-lookup"><span data-stu-id="b52cb-337">There's more complexity in separating features into different processes.</span></span> <span data-ttu-id="b52cb-338">Os protocolos de comunicação tornam-se mais complexos.</span><span class="sxs-lookup"><span data-stu-id="b52cb-338">The communication protocols become more complex.</span></span> <span data-ttu-id="b52cb-339">Em vez de chamadas de método, você deve usar a comunicação assíncrona entre serviços.</span><span class="sxs-lookup"><span data-stu-id="b52cb-339">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="b52cb-340">Ao passar para uma arquitetura de microsserviços, você precisa adicionar muitos dos blocos de construção implementados na versão de microsserviços do aplicativo eShopOnContainers: manipulação de barramento de eventos, resiliência e novas tentativas de mensagem, consistência eventual e muito mais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-340">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the eShopOnContainers application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="b52cb-341">O [aplicativo de referência eShopOnWeb](https://github.com/dotnet-architecture/eShopOnWeb) muito mais simples dá suporte ao uso de único contêiner monolítico.</span><span class="sxs-lookup"><span data-stu-id="b52cb-341">The much simpler [eShopOnWeb reference application](https://github.com/dotnet-architecture/eShopOnWeb) supports single-container monolithic container usage.</span></span> <span data-ttu-id="b52cb-342">O aplicativo inclui um aplicativo Web com exibições de MVC, APIs Web e Razor Pages tradicionais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-342">The application includes one web application that includes traditional MVC views, web APIs, and Razor Pages.</span></span> <span data-ttu-id="b52cb-343">Este aplicativo pode ser iniciado na raiz da solução com os comandos `docker-compose build` e `docker-compose up`.</span><span class="sxs-lookup"><span data-stu-id="b52cb-343">This application can be launched from the solution root using the `docker-compose build` and `docker-compose up` commands.</span></span> <span data-ttu-id="b52cb-344">Esse comando configura um contêiner para a instância da Web usando o `Dockerfile` encontrado na raiz do projeto Web e executa o contêiner em uma porta especificada.</span><span class="sxs-lookup"><span data-stu-id="b52cb-344">This command configures a container for the web instance, using the `Dockerfile` found in the web project's root, and runs the container on a specified port.</span></span> <span data-ttu-id="b52cb-345">Você pode baixar o código-fonte desse aplicativo do GitHub e executá-lo localmente.</span><span class="sxs-lookup"><span data-stu-id="b52cb-345">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="b52cb-346">Até mesmo esse aplicativo monolítico beneficia-se de ser implantado em um ambiente do contêiner.</span><span class="sxs-lookup"><span data-stu-id="b52cb-346">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="b52cb-347">Por exemplo, a implantação em contêineres significa que cada instância do aplicativo é executada no mesmo ambiente.</span><span class="sxs-lookup"><span data-stu-id="b52cb-347">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="b52cb-348">Essa abordagem inclui o ambiente de desenvolvimento no qual ocorrem testes e desenvolvimento antecipados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-348">This approach includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="b52cb-349">A equipe de desenvolvimento pode executar o aplicativo em um ambiente em contêineres que corresponda ao ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="b52cb-349">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="b52cb-350">Além disso, os aplicativos em contêineres são expandidos a um custo mais baixo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-350">In addition, containerized applications scale out at a lower cost.</span></span> <span data-ttu-id="b52cb-351">O uso de um ambiente de contêiner permite um compartilhamento maior de recursos do que os ambientes de VM tradicionais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-351">Using a container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="b52cb-352">Por fim, colocar o aplicativo em contêineres força uma separação entre a lógica de negócios e o servidor de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-352">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="b52cb-353">À medida que o aplicativo for escalado horizontalmente, os vários contêineres dependerão de uma única mídia de armazenamento físico.</span><span class="sxs-lookup"><span data-stu-id="b52cb-353">As the application scales out, the multiple containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="b52cb-354">A mídia de armazenamento seria normalmente um servidor de alta disponibilidade executando um banco de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b52cb-354">This storage medium would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="docker-support"></a><span data-ttu-id="b52cb-355">Suporte ao Docker</span><span class="sxs-lookup"><span data-stu-id="b52cb-355">Docker support</span></span>

<span data-ttu-id="b52cb-356">O `eShopOnWeb` projeto é executado no .net.</span><span class="sxs-lookup"><span data-stu-id="b52cb-356">The `eShopOnWeb` project runs on .NET.</span></span> <span data-ttu-id="b52cb-357">Portanto, ele pode ser executado em contêineres baseados em Linux ou em Windows.</span><span class="sxs-lookup"><span data-stu-id="b52cb-357">Therefore, it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="b52cb-358">Observe que, para a implantação do Docker, você deseja usar o mesmo tipo de host para o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b52cb-358">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="b52cb-359">Os contêineres baseados em Linux permitem o uso de um espaço menor e são preferenciais.</span><span class="sxs-lookup"><span data-stu-id="b52cb-359">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="b52cb-360">Você pode usar o Visual Studio 2017 ou posterior para adicionar o suporte ao Docker a um aplicativo existente clicando com o botão direito do mouse em um projeto no **Gerenciador de Soluções** e escolhendo **Adicionar** > **Suporte ao Docker**.</span><span class="sxs-lookup"><span data-stu-id="b52cb-360">You can use Visual Studio 2017 or later to add Docker support to an existing application by right-clicking on a project in **Solution Explorer** and choosing **Add** > **Docker Support**.</span></span> <span data-ttu-id="b52cb-361">Esta etapa adiciona os arquivos necessários e modifica o projeto para usá-los.</span><span class="sxs-lookup"><span data-stu-id="b52cb-361">This step adds the files required and modifies the project to use them.</span></span> <span data-ttu-id="b52cb-362">O exemplo `eShopOnWeb` atual já têm esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="b52cb-362">The current `eShopOnWeb` sample already has these files in place.</span></span>

<span data-ttu-id="b52cb-363">O arquivo `docker-compose.yml` no nível da solução contém informações sobre quais imagens devem ser criadas e quais contêineres devem ser iniciados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-363">The solution-level `docker-compose.yml` file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="b52cb-364">O arquivo permite que você use o comando `docker-compose` para iniciar vários aplicativos ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="b52cb-364">The file allows you to use the `docker-compose` command to launch multiple applications at the same time.</span></span> <span data-ttu-id="b52cb-365">Nesse caso, ele está iniciando apenas o projeto Web.</span><span class="sxs-lookup"><span data-stu-id="b52cb-365">In this case, it is only launching the Web project.</span></span> <span data-ttu-id="b52cb-366">Você também pode usá-lo para configurar dependências, como um contêiner de banco de dados separado.</span><span class="sxs-lookup"><span data-stu-id="b52cb-366">You can also use it to configure dependencies, such as a separate database container.</span></span>

```yml
version: '3'

services:
  eshopwebmvc:
    image: eshopwebmvc
    build:
      context: .
      dockerfile: src/Web/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    ports:
      - "5106:5106"

networks:
  default:
    external:
      name: nat
```

<span data-ttu-id="b52cb-367">O arquivo `docker-compose.yml` referencia o `Dockerfile` no projeto `Web`.</span><span class="sxs-lookup"><span data-stu-id="b52cb-367">The `docker-compose.yml` file references the `Dockerfile` in the `Web` project.</span></span> <span data-ttu-id="b52cb-368">O `Dockerfile` é usado para especificar qual contêiner base será usado e como o aplicativo será configurado nele.</span><span class="sxs-lookup"><span data-stu-id="b52cb-368">The `Dockerfile` is used to specify which base container will be used and how the application will be configured on it.</span></span> <span data-ttu-id="b52cb-369">O `Dockerfile` do `Web`:</span><span class="sxs-lookup"><span data-stu-id="b52cb-369">The `Web`' `Dockerfile`:</span></span>

```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:5.0 AS build
WORKDIR /app

COPY *.sln .
COPY . .
WORKDIR /app/src/Web
RUN dotnet restore

RUN dotnet publish -c Release -o out

FROM mcr.microsoft.com/dotnet/aspnet:5.0 AS runtime
WORKDIR /app
COPY --from=build /app/src/Web/out ./

ENTRYPOINT ["dotnet", "Web.dll"]
```

### <a name="troubleshooting-docker-problems"></a><span data-ttu-id="b52cb-370">Solução de problemas do Docker</span><span class="sxs-lookup"><span data-stu-id="b52cb-370">Troubleshooting Docker problems</span></span>

<span data-ttu-id="b52cb-371">Depois que você iniciar a execução do aplicativo em contêineres, ele continuará sendo executado até que você o pare.</span><span class="sxs-lookup"><span data-stu-id="b52cb-371">Once you run the containerized application, it continues to run until you stop it.</span></span> <span data-ttu-id="b52cb-372">É possível ver quais contêineres estão em execução com o comando `docker ps`.</span><span class="sxs-lookup"><span data-stu-id="b52cb-372">You can view which containers are running with the `docker ps` command.</span></span> <span data-ttu-id="b52cb-373">Você pode parar um contêiner em execução usando o comando `docker stop` e especificando a ID do contêiner.</span><span class="sxs-lookup"><span data-stu-id="b52cb-373">You can stop a running container by using the `docker stop` command and specifying the container ID.</span></span>

<span data-ttu-id="b52cb-374">Observe que a execução de contêineres do Docker pode ser associada a portas, que caso contrário, você tentaria usar em seu ambiente de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="b52cb-374">Note that running Docker containers may be bound to ports you might otherwise try to use in your development environment.</span></span> <span data-ttu-id="b52cb-375">Se você tentar executar ou depurar um aplicativo usando a mesma porta, como um contêiner do Docker em execução, ocorrerá um erro informando que o servidor não pôde ser associado a essa porta.</span><span class="sxs-lookup"><span data-stu-id="b52cb-375">If you try to run or debug an application using the same port as a running Docker container, you'll get an error stating that the server can't bind to that port.</span></span> <span data-ttu-id="b52cb-376">Mais uma vez, parar o contêiner deverá resolver o problema.</span><span class="sxs-lookup"><span data-stu-id="b52cb-376">Once again, stopping the container should resolve the issue.</span></span>

<span data-ttu-id="b52cb-377">Para adicionar o suporte ao Docker ao aplicativo usando o Visual Studio, verifique se o Docker Desktop está em execução.</span><span class="sxs-lookup"><span data-stu-id="b52cb-377">If you want to add Docker support to your application using Visual Studio, make sure Docker Desktop is running when you do so.</span></span> <span data-ttu-id="b52cb-378">Quando você iniciar o assistente, ele não será executado corretamente se o Docker Desktop não estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="b52cb-378">The wizard won't run correctly if Docker Desktop isn't running when you start the wizard.</span></span> <span data-ttu-id="b52cb-379">Além disso, o assistente examinará sua escolha de contêiner atual para adicionar o suporte ao Docker correto.</span><span class="sxs-lookup"><span data-stu-id="b52cb-379">In addition, the wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="b52cb-380">Se você quiser adicionar o, suporte para contêineres do Windows, será necessário executar o assistente enquanto houver área de trabalho do Docker em execução com contêineres do Windows configurados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-380">If you want to add, support for Windows Containers, you need to run the wizard while you have Docker Desktop running with Windows Containers configured.</span></span> <span data-ttu-id="b52cb-381">Se você quiser adicionar o, suporte para contêineres do Linux, execute o assistente enquanto você tem o Docker em execução com contêineres do Linux configurados.</span><span class="sxs-lookup"><span data-stu-id="b52cb-381">If you want to add, support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

### <a name="references--common-web-architectures"></a><span data-ttu-id="b52cb-382">Referências – arquiteturas comuns da Web</span><span class="sxs-lookup"><span data-stu-id="b52cb-382">References – Common web architectures</span></span>

- <span data-ttu-id="b52cb-383">**A Arquitetura Limpa**</span><span class="sxs-lookup"><span data-stu-id="b52cb-383">**The Clean Architecture**</span></span>  
  <https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html>
- <span data-ttu-id="b52cb-384">**A Arquitetura Cebola**</span><span class="sxs-lookup"><span data-stu-id="b52cb-384">**The Onion Architecture**</span></span>  
  <https://jeffreypalermo.com/blog/the-onion-architecture-part-1/>
- <span data-ttu-id="b52cb-385">**O padrão de repositório**</span><span class="sxs-lookup"><span data-stu-id="b52cb-385">**The Repository Pattern**</span></span>  
  <https://deviq.com/repository-pattern/>
- <span data-ttu-id="b52cb-386">**Limpar modelo de solução de arquitetura**</span><span class="sxs-lookup"><span data-stu-id="b52cb-386">**Clean Architecture Solution Template**</span></span>  
  <https://github.com/ardalis/cleanarchitecture>
- <span data-ttu-id="b52cb-387">**Livro eletrônico Architecting Microservices**</span><span class="sxs-lookup"><span data-stu-id="b52cb-387">**Architecting Microservices e-book**</span></span>  
  <https://aka.ms/MicroservicesEbook>
- <span data-ttu-id="b52cb-388">**DDD (design controlado por domínio)**</span><span class="sxs-lookup"><span data-stu-id="b52cb-388">**DDD (Domain-Driven Design)**</span></span>  
  <https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/>

>[!div class="step-by-step"]
><span data-ttu-id="b52cb-389">[Anterior](architectural-principles.md) 
> [Avançar](common-client-side-web-technologies.md)</span><span class="sxs-lookup"><span data-stu-id="b52cb-389">[Previous](architectural-principles.md)
[Next](common-client-side-web-technologies.md)</span></span>
