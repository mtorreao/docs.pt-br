---
title: 'CA1021: evitar parâmetros de saída (análise de código)'
description: 'Saiba mais sobre a regra de análise de código CA1021: evitar parâmetros de saída'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1021
- AvoidOutParameters
helpviewer_keywords:
- AvoidOutParameters
- CA1021
dev_langs:
- CSharp
author: gewarren
ms.author: gewarren
ms.openlocfilehash: bd2adfe15355e11c03845056bf55874a8ce3be0a
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/25/2020
ms.locfileid: "96584985"
---
# <a name="ca1021-avoid-out-parameters"></a><span data-ttu-id="1ee11-103">CA1021: Evitar parâmetros out</span><span class="sxs-lookup"><span data-stu-id="1ee11-103">CA1021: Avoid out parameters</span></span>

| <span data-ttu-id="1ee11-104">Item</span><span class="sxs-lookup"><span data-stu-id="1ee11-104">Item</span></span>                                     | <span data-ttu-id="1ee11-105">Valor</span><span class="sxs-lookup"><span data-stu-id="1ee11-105">Value</span></span>            |
|------------------------------------------|------------------|
| <span data-ttu-id="1ee11-106">RuleId</span><span class="sxs-lookup"><span data-stu-id="1ee11-106">RuleId</span></span>                                   | <span data-ttu-id="1ee11-107">CA1021</span><span class="sxs-lookup"><span data-stu-id="1ee11-107">CA1021</span></span>           |
| <span data-ttu-id="1ee11-108">Categoria</span><span class="sxs-lookup"><span data-stu-id="1ee11-108">Category</span></span>                                 | <span data-ttu-id="1ee11-109">Microsoft. Design</span><span class="sxs-lookup"><span data-stu-id="1ee11-109">Microsoft.Design</span></span> |
| <span data-ttu-id="1ee11-110">A correção está sendo interrompida ou não está sendo interrompida</span><span class="sxs-lookup"><span data-stu-id="1ee11-110">Fix is breaking or non-breaking</span></span> | <span data-ttu-id="1ee11-111">Quebra</span><span class="sxs-lookup"><span data-stu-id="1ee11-111">Breaking</span></span>         |

## <a name="cause"></a><span data-ttu-id="1ee11-112">Causa</span><span class="sxs-lookup"><span data-stu-id="1ee11-112">Cause</span></span>

<span data-ttu-id="1ee11-113">Um método público ou protegido em um tipo público tem um `out` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="1ee11-113">A public or protected method in a public type has an `out` parameter.</span></span>

<span data-ttu-id="1ee11-114">Por padrão, essa regra só examina os tipos visíveis externamente, mas isso é [configurável](#configurability).</span><span class="sxs-lookup"><span data-stu-id="1ee11-114">By default, this rule only looks at externally visible types, but this is [configurable](#configurability).</span></span>

## <a name="rule-description"></a><span data-ttu-id="1ee11-115">Descrição da regra</span><span class="sxs-lookup"><span data-stu-id="1ee11-115">Rule description</span></span>

<span data-ttu-id="1ee11-116">Passar tipos por referência (usando `out` ou `ref` ) requer experiência com ponteiros, compreendendo como tipos de valor e tipos de referência diferem e manipulando métodos com vários valores de retorno.</span><span class="sxs-lookup"><span data-stu-id="1ee11-116">Passing types by reference (using `out` or `ref`) requires experience with pointers, understanding how value types and reference types differ, and handling methods with multiple return values.</span></span> <span data-ttu-id="1ee11-117">Além disso, a diferença entre os `out` `ref` parâmetros e não é amplamente compreendida.</span><span class="sxs-lookup"><span data-stu-id="1ee11-117">Also, the difference between `out` and `ref` parameters is not widely understood.</span></span>

<span data-ttu-id="1ee11-118">Quando um tipo de referência é passado "por referência", o método pretende usar o parâmetro para retornar uma instância diferente do objeto.</span><span class="sxs-lookup"><span data-stu-id="1ee11-118">When a reference type is passed "by reference," the method intends to use the parameter to return a different instance of the object.</span></span> <span data-ttu-id="1ee11-119">Passar um tipo de referência por referência também é conhecido como usar um ponteiro duplo, um ponteiro para um ponteiro ou um indireção duplo.</span><span class="sxs-lookup"><span data-stu-id="1ee11-119">Passing a reference type by reference is also known as using a double pointer, pointer to a pointer, or double indirection.</span></span> <span data-ttu-id="1ee11-120">Usando a Convenção de chamada padrão, que é Pass "por valor", um parâmetro que usa um tipo de referência já recebe um ponteiro para o objeto.</span><span class="sxs-lookup"><span data-stu-id="1ee11-120">By using the default calling convention, which is pass "by value," a parameter that takes a reference type already receives a pointer to the object.</span></span> <span data-ttu-id="1ee11-121">O ponteiro, não o objeto ao qual ele aponta, é passado por valor.</span><span class="sxs-lookup"><span data-stu-id="1ee11-121">The pointer, not the object to which it points, is passed by value.</span></span> <span data-ttu-id="1ee11-122">A passagem por valor significa que o método não pode alterar o ponteiro para que ele aponte para uma nova instância do tipo de referência.</span><span class="sxs-lookup"><span data-stu-id="1ee11-122">Pass by value means that the method cannot change the pointer to have it point to a new instance of the reference type.</span></span> <span data-ttu-id="1ee11-123">No entanto, ele pode alterar o conteúdo do objeto para o qual ele aponta.</span><span class="sxs-lookup"><span data-stu-id="1ee11-123">However, it can change the contents of the object to which it points.</span></span> <span data-ttu-id="1ee11-124">Para a maioria dos aplicativos, isso é suficiente e produz o comportamento desejado.</span><span class="sxs-lookup"><span data-stu-id="1ee11-124">For most applications this is sufficient and yields the desired behavior.</span></span>

<span data-ttu-id="1ee11-125">Se um método precisar retornar uma instância diferente, use o valor de retorno do método para fazer isso.</span><span class="sxs-lookup"><span data-stu-id="1ee11-125">If a method must return a different instance, use the return value of the method to accomplish this.</span></span> <span data-ttu-id="1ee11-126">Consulte a <xref:System.String?displayProperty=fullName> classe de uma variedade de métodos que operam em cadeias de caracteres e retornam uma nova instância de uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="1ee11-126">See the <xref:System.String?displayProperty=fullName> class for a variety of methods that operate on strings and return a new instance of a string.</span></span> <span data-ttu-id="1ee11-127">Quando esse modelo é usado, o chamador deve decidir se o objeto original é preservado.</span><span class="sxs-lookup"><span data-stu-id="1ee11-127">When this model is used, the caller must decide whether the original object is preserved.</span></span>

<span data-ttu-id="1ee11-128">Embora os valores de retorno sejam comuns e usados intensamente, a aplicação e os parâmetros corretos `out` `ref` exigem design intermediário e habilidades de codificação.</span><span class="sxs-lookup"><span data-stu-id="1ee11-128">Although return values are commonplace and heavily used, the correct application of `out` and `ref` parameters requires intermediate design and coding skills.</span></span> <span data-ttu-id="1ee11-129">Os arquitetos de biblioteca que projetam um público geral não devem esperar que os usuários façam o mestre de trabalho com os `out` `ref` parâmetros ou.</span><span class="sxs-lookup"><span data-stu-id="1ee11-129">Library architects who design for a general audience should not expect users to master working with `out` or `ref` parameters.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="1ee11-130">Como corrigir violações</span><span class="sxs-lookup"><span data-stu-id="1ee11-130">How to fix violations</span></span>

<span data-ttu-id="1ee11-131">Para corrigir uma violação dessa regra causada por um tipo de valor, faça com que o método retorne o objeto como seu valor de retorno.</span><span class="sxs-lookup"><span data-stu-id="1ee11-131">To fix a violation of this rule that is caused by a value type, have the method return the object as its return value.</span></span> <span data-ttu-id="1ee11-132">Se o método deve retornar vários valores, recrie-o para retornar uma única instância de um objeto que contém os valores.</span><span class="sxs-lookup"><span data-stu-id="1ee11-132">If the method must return multiple values, redesign it to return a single instance of an object that holds the values.</span></span>

<span data-ttu-id="1ee11-133">Para corrigir uma violação dessa regra causada por um tipo de referência, verifique se o comportamento desejado é retornar uma nova instância da referência.</span><span class="sxs-lookup"><span data-stu-id="1ee11-133">To fix a violation of this rule that is caused by a reference type, make sure that the desired behavior is to return a new instance of the reference.</span></span> <span data-ttu-id="1ee11-134">Se for, o método deve usar seu valor de retorno para fazer isso.</span><span class="sxs-lookup"><span data-stu-id="1ee11-134">If it is, the method should use its return value to do this.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="1ee11-135">Quando suprimir avisos</span><span class="sxs-lookup"><span data-stu-id="1ee11-135">When to suppress warnings</span></span>

<span data-ttu-id="1ee11-136">É seguro suprimir um aviso dessa regra.</span><span class="sxs-lookup"><span data-stu-id="1ee11-136">It is safe to suppress a warning from this rule.</span></span> <span data-ttu-id="1ee11-137">No entanto, esse design pode causar problemas de usabilidade.</span><span class="sxs-lookup"><span data-stu-id="1ee11-137">However, this design could cause usability issues.</span></span>

## <a name="configurability"></a><span data-ttu-id="1ee11-138">Configurabilidade</span><span class="sxs-lookup"><span data-stu-id="1ee11-138">Configurability</span></span>

<span data-ttu-id="1ee11-139">Você pode configurar em quais partes de sua base de código executar essa regra, com base em sua acessibilidade.</span><span class="sxs-lookup"><span data-stu-id="1ee11-139">You can configure which parts of your codebase to run this rule on, based on their accessibility.</span></span> <span data-ttu-id="1ee11-140">Por exemplo, para especificar que a regra deve ser executada somente na superfície da API não pública, adicione o seguinte par chave-valor a um arquivo *. editorconfig* em seu projeto:</span><span class="sxs-lookup"><span data-stu-id="1ee11-140">For example, to specify that the rule should run only against the non-public API surface, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.ca1021.api_surface = private, internal
```

<span data-ttu-id="1ee11-141">Você pode configurar essa opção apenas para essa regra, para todas as regras ou para todas as regras nesta categoria (Design).</span><span class="sxs-lookup"><span data-stu-id="1ee11-141">You can configure this option for just this rule, for all rules, or for all rules in this category (Design).</span></span> <span data-ttu-id="1ee11-142">Para obter mais informações, consulte [Opções de configuração de regra de qualidade de código](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="1ee11-142">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

## <a name="example-1"></a><span data-ttu-id="1ee11-143">Exemplo 1</span><span class="sxs-lookup"><span data-stu-id="1ee11-143">Example 1</span></span>

<span data-ttu-id="1ee11-144">A biblioteca a seguir mostra duas implementações de uma classe que gera respostas para comentários do usuário.</span><span class="sxs-lookup"><span data-stu-id="1ee11-144">The following library shows two implementations of a class that generates responses to user feedback.</span></span> <span data-ttu-id="1ee11-145">A primeira implementação ( `BadRefAndOut` ) força o usuário da biblioteca a gerenciar três valores de retorno.</span><span class="sxs-lookup"><span data-stu-id="1ee11-145">The first implementation (`BadRefAndOut`) forces the library user to manage three return values.</span></span> <span data-ttu-id="1ee11-146">A segunda implementação ( `RedesignedRefAndOut` ) simplifica a experiência do usuário retornando uma instância de uma classe de contêiner ( `ReplyData` ) que gerencia os dados como uma única unidade.</span><span class="sxs-lookup"><span data-stu-id="1ee11-146">The second implementation (`RedesignedRefAndOut`) simplifies the user experience by returning an instance of a container class (`ReplyData`) that manages the data as a single unit.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet1":::

## <a name="example-2"></a><span data-ttu-id="1ee11-147">Exemplo 2</span><span class="sxs-lookup"><span data-stu-id="1ee11-147">Example 2</span></span>

<span data-ttu-id="1ee11-148">O aplicativo a seguir ilustra a experiência do usuário.</span><span class="sxs-lookup"><span data-stu-id="1ee11-148">The following application illustrates the experience of the user.</span></span> <span data-ttu-id="1ee11-149">A chamada para a biblioteca remodelada ( `UseTheSimplifiedClass` método) é mais simples, e as informações retornadas pelo método são facilmente gerenciadas.</span><span class="sxs-lookup"><span data-stu-id="1ee11-149">The call to the redesigned library (`UseTheSimplifiedClass` method) is more straightforward, and the information returned by the method is easily managed.</span></span> <span data-ttu-id="1ee11-150">A saída dos dois métodos é idêntica.</span><span class="sxs-lookup"><span data-stu-id="1ee11-150">The output from the two methods is identical.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet2":::

## <a name="example-3"></a><span data-ttu-id="1ee11-151">Exemplo 3</span><span class="sxs-lookup"><span data-stu-id="1ee11-151">Example 3</span></span>

<span data-ttu-id="1ee11-152">A biblioteca de exemplo a seguir ilustra como os `ref` parâmetros para tipos de referência são usados e mostra uma maneira melhor de implementar essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="1ee11-152">The following example library illustrates how `ref` parameters for reference types are used and shows a better way to implement this functionality.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet3":::

## <a name="example-4"></a><span data-ttu-id="1ee11-153">Exemplo 4</span><span class="sxs-lookup"><span data-stu-id="1ee11-153">Example 4</span></span>

<span data-ttu-id="1ee11-154">O aplicativo a seguir chama cada método na biblioteca para demonstrar o comportamento.</span><span class="sxs-lookup"><span data-stu-id="1ee11-154">The following application calls each method in the library to demonstrate the behavior.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet4":::

<span data-ttu-id="1ee11-155">Esse exemplo gera a saída a seguir:</span><span class="sxs-lookup"><span data-stu-id="1ee11-155">This example produces the following output:</span></span>

```txt
Changing pointer - passed by value:
12345
12345
Changing pointer - passed by reference:
12345
12345 ABCDE
Passing by return value:
12345 ABCDE
```

## <a name="try-pattern-methods"></a><span data-ttu-id="1ee11-156">Experimente os métodos de padrão</span><span class="sxs-lookup"><span data-stu-id="1ee11-156">Try pattern methods</span></span>

<span data-ttu-id="1ee11-157">Métodos que implementam o padrão **\<Something> try** , como <xref:System.Int32.TryParse%2A?displayProperty=fullName> , não geram essa violação.</span><span class="sxs-lookup"><span data-stu-id="1ee11-157">Methods that implement the **Try\<Something>** pattern, such as <xref:System.Int32.TryParse%2A?displayProperty=fullName>, do not raise this violation.</span></span> <span data-ttu-id="1ee11-158">O exemplo a seguir mostra uma estrutura (tipo de valor) que implementa o <xref:System.Int32.TryParse%2A?displayProperty=fullName> método.</span><span class="sxs-lookup"><span data-stu-id="1ee11-158">The following example shows a structure (value type) that implements the <xref:System.Int32.TryParse%2A?displayProperty=fullName> method.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet5":::

## <a name="related-rules"></a><span data-ttu-id="1ee11-159">Regras relacionadas</span><span class="sxs-lookup"><span data-stu-id="1ee11-159">Related rules</span></span>

[<span data-ttu-id="1ee11-160">CA1045: Não passar tipos por referência</span><span class="sxs-lookup"><span data-stu-id="1ee11-160">CA1045: Do not pass types by reference</span></span>](ca1045.md)
