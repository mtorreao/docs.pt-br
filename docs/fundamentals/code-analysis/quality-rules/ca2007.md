---
title: 'CA2007: não aguardar diretamente uma tarefa (análise de código)'
description: 'Saiba mais sobre a regra de análise de código CA2007: não aguardar diretamente uma tarefa'
ms.date: 03/08/2019
ms.topic: reference
f1_keywords:
- CA2007
- DoNotDirectlyAwaitATaskAnalyzer
helpviewer_keywords:
- CA2007
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
ms.openlocfilehash: b556a59d9ef0bf7c03563cc63c96b35946241254
ms.sourcegitcommit: e301979e3049ce412d19b094c60ed95b316a8f8c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/16/2020
ms.locfileid: "97595132"
---
# <a name="ca2007-do-not-directly-await-a-task"></a><span data-ttu-id="9c2d1-103">CA2007: não aguardar diretamente uma tarefa</span><span class="sxs-lookup"><span data-stu-id="9c2d1-103">CA2007: Do not directly await a Task</span></span>

| | <span data-ttu-id="9c2d1-104">Valor</span><span class="sxs-lookup"><span data-stu-id="9c2d1-104">Value</span></span> |
|-|-|
| <span data-ttu-id="9c2d1-105">**ID da regra**</span><span class="sxs-lookup"><span data-stu-id="9c2d1-105">**Rule ID**</span></span> |<span data-ttu-id="9c2d1-106">CA2007</span><span class="sxs-lookup"><span data-stu-id="9c2d1-106">CA2007</span></span>|
| <span data-ttu-id="9c2d1-107">**Categoria**</span><span class="sxs-lookup"><span data-stu-id="9c2d1-107">**Category**</span></span> |<span data-ttu-id="9c2d1-108">Microsoft. confiabilidade</span><span class="sxs-lookup"><span data-stu-id="9c2d1-108">Microsoft.Reliability</span></span>|
| <span data-ttu-id="9c2d1-109">**A correção está sendo interrompida ou não está sendo interrompida**</span><span class="sxs-lookup"><span data-stu-id="9c2d1-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="9c2d1-110">Sem interrupção</span><span class="sxs-lookup"><span data-stu-id="9c2d1-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="9c2d1-111">Causa</span><span class="sxs-lookup"><span data-stu-id="9c2d1-111">Cause</span></span>

<span data-ttu-id="9c2d1-112">Um método assíncrono [aguarda](../../../csharp/language-reference/operators/await.md) um <xref:System.Threading.Tasks.Task> diretamente.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-112">An asynchronous method [awaits](../../../csharp/language-reference/operators/await.md) a <xref:System.Threading.Tasks.Task> directly.</span></span>

## <a name="rule-description"></a><span data-ttu-id="9c2d1-113">Descrição da regra</span><span class="sxs-lookup"><span data-stu-id="9c2d1-113">Rule description</span></span>

<span data-ttu-id="9c2d1-114">Quando um método assíncrono aguarda <xref:System.Threading.Tasks.Task> diretamente, a continuação geralmente ocorre no mesmo thread que criou a tarefa, dependendo do contexto assíncrono.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-114">When an asynchronous method awaits a <xref:System.Threading.Tasks.Task> directly, continuation usually occurs in the same thread that created the task, depending on the async context.</span></span> <span data-ttu-id="9c2d1-115">Esse comportamento pode ser dispendioso em termos de desempenho e pode resultar em um deadlock no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-115">This behavior can be costly in terms of performance and can result in a deadlock on the UI thread.</span></span> <span data-ttu-id="9c2d1-116">Considere chamar <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> para sinalizar sua intenção para continuação.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-116">Consider calling <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> to signal your intention for continuation.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="9c2d1-117">Como corrigir violações</span><span class="sxs-lookup"><span data-stu-id="9c2d1-117">How to fix violations</span></span>

<span data-ttu-id="9c2d1-118">Para corrigir violações, ligue para <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> o esperado <xref:System.Threading.Tasks.Task> .</span><span class="sxs-lookup"><span data-stu-id="9c2d1-118">To fix violations, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="9c2d1-119">Você pode passar um `true` ou `false` para o `continueOnCapturedContext` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-119">You can pass either `true` or `false` for the `continueOnCapturedContext` parameter.</span></span>

- <span data-ttu-id="9c2d1-120">A chamada `ConfigureAwait(true)` na tarefa tem o mesmo comportamento que não está chamando explicitamente <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> .</span><span class="sxs-lookup"><span data-stu-id="9c2d1-120">Calling `ConfigureAwait(true)` on the task has the same behavior as not explicitly calling <xref:System.Threading.Tasks.Task.ConfigureAwait%2A>.</span></span> <span data-ttu-id="9c2d1-121">Ao chamar explicitamente esse método, você está permitindo que os leitores saibam que você intencionalmente deseja executar a continuação no contexto de sincronização original.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-121">By explicitly calling this method, you're letting readers know you intentionally want to perform the continuation on the original synchronization context.</span></span>

- <span data-ttu-id="9c2d1-122">Chame `ConfigureAwait(false)` na tarefa para agendar as continuaçãos para o pool de threads, evitando assim um deadlock no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-122">Call `ConfigureAwait(false)` on the task to schedule continuations to the thread pool, thereby avoiding a deadlock on the UI thread.</span></span> <span data-ttu-id="9c2d1-123">`false`A passagem é uma boa opção para bibliotecas independentes de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-123">Passing `false` is a good option for app-independent libraries.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="9c2d1-124">Quando suprimir avisos</span><span class="sxs-lookup"><span data-stu-id="9c2d1-124">When to suppress warnings</span></span>

<span data-ttu-id="9c2d1-125">Esse aviso destina-se a bibliotecas, em que o código pode ser executado em ambientes arbitrários e onde o código não deve fazer suposições sobre o ambiente ou como o chamador do método pode estar invocando ou aguardando.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-125">This warning is intended for libraries, where the code may be executed in arbitrary environments and where code shouldn't make assumptions about the environment or how the caller of the method may be invoking or waiting on it.</span></span> <span data-ttu-id="9c2d1-126">Geralmente, é apropriado suprimir o aviso inteiramente para projetos que representam o código do aplicativo, em vez do código de biblioteca; na verdade, a execução desse analisador no código do aplicativo (por exemplo, manipuladores de eventos de clique de botão em um projeto WinForms ou WPF) provavelmente levará às ações erradas que estão sendo executadas.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-126">It is generally appropriate to suppress the warning entirely for projects that represent application code rather than library code; in fact, running this analyzer on application code (for example, button click event handlers in a WinForms or WPF project) is likely to lead to the wrong actions being taken.</span></span>

<span data-ttu-id="9c2d1-127">Você pode suprimir esse aviso em qualquer situação em que a continuação deva ser agendada de volta para o contexto original ou onde não haja tal contexto em vigor.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-127">You can suppress this warning in any situation where either the continuation should be scheduled back to the original context or where there is no such context in place.</span></span> <span data-ttu-id="9c2d1-128">Por exemplo, ao escrever código em um manipulador de eventos de clique de botão em um aplicativo WinForms ou WPF, em geral, a continuação de um Await deve ser executada no thread da interface do usuário e, portanto, o comportamento padrão de agendar a continuação de volta para o contexto de origem é desejável.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-128">For example, when writing code in a button click event handler in a WinForms or WPF application, in general the continuation from an await should run on the UI thread, and thus the default behavior of scheduling the continuation back to the originating context is desirable.</span></span> <span data-ttu-id="9c2d1-129">Como outro exemplo, ao escrever código em um aplicativo ASP.NET Core, por padrão, não há nenhum <xref:System.Threading.SynchronizationContext> ou <xref:System.Threading.Tasks.TaskScheduler> , por qual motivo um não `ConfigureAwait` realmente alteraria nenhum comportamento.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-129">As another example, when writing code in an ASP.NET Core application, by default there is no <xref:System.Threading.SynchronizationContext> or <xref:System.Threading.Tasks.TaskScheduler>, for which reason a `ConfigureAwait` wouldn't actually change any behavior.</span></span>

## <a name="example"></a><span data-ttu-id="9c2d1-130">Exemplo</span><span class="sxs-lookup"><span data-stu-id="9c2d1-130">Example</span></span>

<span data-ttu-id="9c2d1-131">O trecho de código a seguir gera o aviso:</span><span class="sxs-lookup"><span data-stu-id="9c2d1-131">The following code snippet generates the warning:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task;
}
```

<span data-ttu-id="9c2d1-132">Para corrigir a violação, chame <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> no esperado <xref:System.Threading.Tasks.Task> :</span><span class="sxs-lookup"><span data-stu-id="9c2d1-132">To fix the violation, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task.ConfigureAwait(false);
}
```

## <a name="configure-code-to-analyze"></a><span data-ttu-id="9c2d1-133">Configurar o código para analisar</span><span class="sxs-lookup"><span data-stu-id="9c2d1-133">Configure code to analyze</span></span>

<span data-ttu-id="9c2d1-134">Use as opções a seguir para configurar em quais partes de sua base de código executar essa regra.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-134">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="9c2d1-135">Excluir métodos Async void</span><span class="sxs-lookup"><span data-stu-id="9c2d1-135">Exclude async void methods</span></span>](#exclude-async-void-methods)
- [<span data-ttu-id="9c2d1-136">Tipo de saída</span><span class="sxs-lookup"><span data-stu-id="9c2d1-136">Output kind</span></span>](#output-kind)

<span data-ttu-id="9c2d1-137">Você pode configurar todas essas opções apenas para essa regra, para todas as regras ou para todas as regras nesta categoria (confiabilidade).</span><span class="sxs-lookup"><span data-stu-id="9c2d1-137">You can configure all of these options for just this rule, for all rules, or for all rules in this category (Reliability).</span></span> <span data-ttu-id="9c2d1-138">Para obter mais informações, consulte [Opções de configuração de regra de qualidade de código](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="9c2d1-138">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

### <a name="exclude-async-void-methods"></a><span data-ttu-id="9c2d1-139">Excluir métodos Async void</span><span class="sxs-lookup"><span data-stu-id="9c2d1-139">Exclude async void methods</span></span>

<span data-ttu-id="9c2d1-140">Você pode configurar se deseja excluir métodos assíncronos que não retornam um valor dessa regra.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-140">You can configure whether you want to exclude asynchronous methods that don't return a value from this rule.</span></span> <span data-ttu-id="9c2d1-141">Para excluir esses tipos de métodos, adicione o seguinte par chave-valor a um arquivo *. editorconfig* em seu projeto:</span><span class="sxs-lookup"><span data-stu-id="9c2d1-141">To exclude these kinds of methods, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
# Package version 2.9.0 and later
dotnet_code_quality.CA2007.exclude_async_void_methods = true

# Package version 2.6.3 and earlier
dotnet_code_quality.CA2007.skip_async_void_methods = true
```

### <a name="output-kind"></a><span data-ttu-id="9c2d1-142">Tipo de saída</span><span class="sxs-lookup"><span data-stu-id="9c2d1-142">Output kind</span></span>

<span data-ttu-id="9c2d1-143">Você também pode configurar para quais tipos de assembly de saída aplicar essa regra.</span><span class="sxs-lookup"><span data-stu-id="9c2d1-143">You can also configure which output assembly kinds to apply this rule to.</span></span> <span data-ttu-id="9c2d1-144">Por exemplo, para aplicar essa regra somente ao código que produz um aplicativo de console ou uma biblioteca vinculada dinamicamente (ou seja, não um aplicativo de interface do usuário), adicione o seguinte par chave-valor a um arquivo *. editorconfig* em seu projeto:</span><span class="sxs-lookup"><span data-stu-id="9c2d1-144">For example, to only apply this rule to code that produces a console application or a dynamically linked library (that is, not a UI app), add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.CA2007.output_kind = ConsoleApplication, DynamicallyLinkedLibrary
```

## <a name="see-also"></a><span data-ttu-id="9c2d1-145">Confira também</span><span class="sxs-lookup"><span data-stu-id="9c2d1-145">See also</span></span>

- [<span data-ttu-id="9c2d1-146">Perguntas frequentes do ConfigureAwait</span><span class="sxs-lookup"><span data-stu-id="9c2d1-146">ConfigureAwait FAQ</span></span>](https://devblogs.microsoft.com/dotnet/configureawait-faq/)
- [<span data-ttu-id="9c2d1-147">Devo esperar uma tarefa com ConfigureAwait (false)?</span><span class="sxs-lookup"><span data-stu-id="9c2d1-147">Should I await a task with ConfigureAwait(false)?</span></span>](https://github.com/Microsoft/vs-threading/blob/master/doc/cookbook_vs.md#should-i-await-a-task-with-configureawaitfalse)
- [<span data-ttu-id="9c2d1-148">CA2008: Não criar tarefas sem passar um TaskScheduler</span><span class="sxs-lookup"><span data-stu-id="9c2d1-148">CA2008: Do not create tasks without passing a TaskScheduler</span></span>](ca2008.md)
- [<span data-ttu-id="9c2d1-149">Regras de confiabilidade</span><span class="sxs-lookup"><span data-stu-id="9c2d1-149">Reliability rules</span></span>](reliability-warnings.md)
