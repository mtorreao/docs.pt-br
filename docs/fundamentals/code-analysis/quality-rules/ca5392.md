---
title: 'CA5392: usar o atributo DefaultDllImportSearchPaths para P/Invokes (análise de código)'
description: Fornece informações sobre a regra de análise de código CA5392, incluindo causas, como corrigir violações e quando suprimir.
ms.date: 05/28/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
f1_keywords:
- CA5392
ms.openlocfilehash: f6c488bcc40d1cd52bc2404e7174752c0b76c79f
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/25/2020
ms.locfileid: "96585024"
---
# <a name="ca5392-use-defaultdllimportsearchpaths-attribute-for-pinvokes"></a><span data-ttu-id="518fb-103">CA5392: Usar o atributo DefaultDllImportSearchPaths para P/Invokes</span><span class="sxs-lookup"><span data-stu-id="518fb-103">CA5392: Use DefaultDllImportSearchPaths attribute for P/Invokes</span></span>

| | <span data-ttu-id="518fb-104">Valor</span><span class="sxs-lookup"><span data-stu-id="518fb-104">Value</span></span> |
|-|-|
| <span data-ttu-id="518fb-105">**ID da regra**</span><span class="sxs-lookup"><span data-stu-id="518fb-105">**Rule ID**</span></span> |<span data-ttu-id="518fb-106">CA5392</span><span class="sxs-lookup"><span data-stu-id="518fb-106">CA5392</span></span>|
| <span data-ttu-id="518fb-107">**Categoria**</span><span class="sxs-lookup"><span data-stu-id="518fb-107">**Category**</span></span> |<span data-ttu-id="518fb-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="518fb-108">Microsoft.Security</span></span>|
| <span data-ttu-id="518fb-109">**A correção está sendo interrompida ou não está sendo interrompida**</span><span class="sxs-lookup"><span data-stu-id="518fb-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="518fb-110">Sem interrupção</span><span class="sxs-lookup"><span data-stu-id="518fb-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="518fb-111">Causa</span><span class="sxs-lookup"><span data-stu-id="518fb-111">Cause</span></span>

<span data-ttu-id="518fb-112">O <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> não é especificado para uma função de [invocação de plataforma (P/Invoke)](../../../standard/native-interop/pinvoke.md) .</span><span class="sxs-lookup"><span data-stu-id="518fb-112">The <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> is not specified for a [Platform Invoke (P/Invoke)](../../../standard/native-interop/pinvoke.md) function.</span></span>

## <a name="rule-description"></a><span data-ttu-id="518fb-113">Descrição da regra</span><span class="sxs-lookup"><span data-stu-id="518fb-113">Rule description</span></span>

<span data-ttu-id="518fb-114">Por padrão, as funções P/Invoke usam a <xref:System.Runtime.InteropServices.DllImportAttribute> investigação de um número de diretórios, incluindo o diretório de trabalho atual para a biblioteca carregar.</span><span class="sxs-lookup"><span data-stu-id="518fb-114">By default, P/Invoke functions using <xref:System.Runtime.InteropServices.DllImportAttribute> probe a number of directories, including the current working directory for the library to load.</span></span> <span data-ttu-id="518fb-115">Isso pode ser um problema de segurança para determinados aplicativos, levando ao seqüestro de DLL.</span><span class="sxs-lookup"><span data-stu-id="518fb-115">This can be a security issue for certain applications, leading to DLL hijacking.</span></span>

<span data-ttu-id="518fb-116">Por exemplo, se uma DLL mal-intencionada com o mesmo nome que a importada for colocada no diretório de trabalho atual, que será pesquisada primeiro por padrão, a DLL mal-intencionada poderá ser carregada.</span><span class="sxs-lookup"><span data-stu-id="518fb-116">For example, if a malicious DLL with the same name as the imported one is placed under the current working directory, which will be searched firstly by default, then the malicious DLL could be loaded.</span></span>

<span data-ttu-id="518fb-117">Para obter mais informações, consulte [carregar biblioteca com segurança](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span><span class="sxs-lookup"><span data-stu-id="518fb-117">For more information, see [Load Library Safely](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="518fb-118">Como corrigir violações</span><span class="sxs-lookup"><span data-stu-id="518fb-118">How to fix violations</span></span>

<span data-ttu-id="518fb-119">Use <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> para especificar o caminho de pesquisa de dll explicitamente para o assembly ou o método.</span><span class="sxs-lookup"><span data-stu-id="518fb-119">Use <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> to specify the DLL search path explicitly for the assembly or the method.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="518fb-120">Quando suprimir avisos</span><span class="sxs-lookup"><span data-stu-id="518fb-120">When to suppress warnings</span></span>

<span data-ttu-id="518fb-121">É seguro suprimir essa regra:</span><span class="sxs-lookup"><span data-stu-id="518fb-121">It's safe to suppress this rule i:</span></span>

- <span data-ttu-id="518fb-122">Você tem certeza de que o assembly carregado é o que você deseja.</span><span class="sxs-lookup"><span data-stu-id="518fb-122">You're sure the loaded assembly is what you want.</span></span> <span data-ttu-id="518fb-123">Por exemplo, seu aplicativo é executado em um servidor confiável e você confia plenamente nos arquivos.</span><span class="sxs-lookup"><span data-stu-id="518fb-123">For example, your application runs on a trusted server and you completely trust the files.</span></span>
- <span data-ttu-id="518fb-124">O assembly importado é um assembly de sistema comumente usado, como user32.dll, e a estratégia de caminho de pesquisa segue o [mecanismo known DLLs](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span><span class="sxs-lookup"><span data-stu-id="518fb-124">The imported assembly is a commonly used system assembly, like user32.dll, and the search path strategy follows the [Known DLLs mechanism](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="518fb-125">Exemplos de pseudocódigo</span><span class="sxs-lookup"><span data-stu-id="518fb-125">Pseudo-code examples</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

### <a name="solution"></a><span data-ttu-id="518fb-126">Solução</span><span class="sxs-lookup"><span data-stu-id="518fb-126">Solution</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    [DefaultDllImportSearchPaths(DllImportSearchPath.UserDirectories)]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

## <a name="related-rules"></a><span data-ttu-id="518fb-127">Regras relacionadas</span><span class="sxs-lookup"><span data-stu-id="518fb-127">Related rules</span></span>

[<span data-ttu-id="518fb-128">CA5393: Não usar o valor DllImportSearchPath não seguro</span><span class="sxs-lookup"><span data-stu-id="518fb-128">CA5393: Do not use unsafe DllImportSearchPath value</span></span>](ca5393.md)
