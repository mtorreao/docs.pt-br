---
title: 'CA2101: especificar o marshaling para argumentos de cadeia de caracteres P-Invoke (análise de código)'
description: 'Saiba mais sobre a regra de análise de código CA2101: especificar o marshaling para argumentos de cadeia de caracteres P-Invoke'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- SpecifyMarshalingForPInvokeStringArguments
- CA2101
helpviewer_keywords:
- CA2101
- SpecifyMarshalingForPInvokeStringArguments
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 9c74a4cd31abf2b5ceefbddad3931aa50445bf82
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/25/2020
ms.locfileid: "96584747"
---
# <a name="ca2101-specify-marshaling-for-pinvoke-string-arguments"></a><span data-ttu-id="251f1-103">CA2101: especificar marshaling para argumentos da cadeia de caracteres P/Invoke</span><span class="sxs-lookup"><span data-stu-id="251f1-103">CA2101: Specify marshaling for P/Invoke string arguments</span></span>

| | <span data-ttu-id="251f1-104">Valor</span><span class="sxs-lookup"><span data-stu-id="251f1-104">Value</span></span> |
|-|-|
| <span data-ttu-id="251f1-105">**ID da regra**</span><span class="sxs-lookup"><span data-stu-id="251f1-105">**Rule ID**</span></span> |<span data-ttu-id="251f1-106">CA2101</span><span class="sxs-lookup"><span data-stu-id="251f1-106">CA2101</span></span>|
| <span data-ttu-id="251f1-107">**Categoria**</span><span class="sxs-lookup"><span data-stu-id="251f1-107">**Category**</span></span> |<span data-ttu-id="251f1-108">Microsoft. Globalization</span><span class="sxs-lookup"><span data-stu-id="251f1-108">Microsoft.Globalization</span></span>|
| <span data-ttu-id="251f1-109">**A correção está sendo interrompida ou não está sendo interrompida**</span><span class="sxs-lookup"><span data-stu-id="251f1-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="251f1-110">Sem interrupção</span><span class="sxs-lookup"><span data-stu-id="251f1-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="251f1-111">Causa</span><span class="sxs-lookup"><span data-stu-id="251f1-111">Cause</span></span>

<span data-ttu-id="251f1-112">Um membro de invocação de plataforma permite chamadores parcialmente confiáveis, tem um parâmetro de cadeia de caracteres e não empacota explicitamente a cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="251f1-112">A platform invoke member allows for partially trusted callers, has a string parameter, and does not explicitly marshal the string.</span></span>

## <a name="rule-description"></a><span data-ttu-id="251f1-113">Descrição da regra</span><span class="sxs-lookup"><span data-stu-id="251f1-113">Rule description</span></span>

<span data-ttu-id="251f1-114">Quando você converte de Unicode para ANSI, é possível que nem todos os caracteres Unicode possam ser representados em uma página de código ANSI específica.</span><span class="sxs-lookup"><span data-stu-id="251f1-114">When you convert from Unicode to ANSI, it is possible that not all Unicode characters can be represented in a specific ANSI code page.</span></span> <span data-ttu-id="251f1-115">O *mapeamento de melhor ajuste* tenta resolver esse problema, substituindo um caractere para o caractere que não pode ser representado.</span><span class="sxs-lookup"><span data-stu-id="251f1-115">*Best-fit mapping* tries to solve this problem by substituting a character for the character that cannot be represented.</span></span> <span data-ttu-id="251f1-116">O uso desse recurso pode causar uma possível vulnerabilidade de segurança porque você não pode controlar o caractere escolhido.</span><span class="sxs-lookup"><span data-stu-id="251f1-116">The use of this feature can cause a potential security vulnerability because you cannot control the character that is chosen.</span></span> <span data-ttu-id="251f1-117">Por exemplo, um código mal-intencionado poderia criar intencionalmente uma cadeia de caracteres Unicode que contenha personagens que não foram encontrados em uma página de código específica, que são convertidas em caracteres especiais do sistema de arquivos, como '.. '</span><span class="sxs-lookup"><span data-stu-id="251f1-117">For example, malicious code could intentionally create a Unicode string that contains characters that are not found in a particular code page, which are converted to file system special characters such as '..'</span></span> <span data-ttu-id="251f1-118">ou '/'.</span><span class="sxs-lookup"><span data-stu-id="251f1-118">or '/'.</span></span> <span data-ttu-id="251f1-119">Observe também que as verificações de segurança de caracteres especiais ocorrem com frequência antes que a cadeia de caracteres seja convertida em ANSI.</span><span class="sxs-lookup"><span data-stu-id="251f1-119">Note also that security checks for special characters frequently occur before the string is converted to ANSI.</span></span>

<span data-ttu-id="251f1-120">O mapeamento de melhor ajuste é o padrão para a conversão não gerenciada, WChar para MByte.</span><span class="sxs-lookup"><span data-stu-id="251f1-120">Best-fit mapping is the default for the unmanaged conversion, WChar to MByte.</span></span> <span data-ttu-id="251f1-121">A menos que você desabilite explicitamente o mapeamento de melhor ajuste, seu código pode conter uma vulnerabilidade de segurança explorável devido a esse problema.</span><span class="sxs-lookup"><span data-stu-id="251f1-121">Unless you explicitly disable best-fit mapping, your code might contain an exploitable security vulnerability because of this issue.</span></span>

> [!CAUTION]
> <span data-ttu-id="251f1-122">A CAS ( [segurança de acesso do código](../../../framework/misc/code-access-security.md) ) não deve ser considerada um limite de segurança.</span><span class="sxs-lookup"><span data-stu-id="251f1-122">[Code Access Security](../../../framework/misc/code-access-security.md) (CAS) should not be considered a security boundary.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="251f1-123">Como corrigir violações</span><span class="sxs-lookup"><span data-stu-id="251f1-123">How to fix violations</span></span>

<span data-ttu-id="251f1-124">Para corrigir uma violação dessa regra, desempacotar explicitamente os tipos de dados de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="251f1-124">To fix a violation of this rule, explicitly marshal string data types.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="251f1-125">Quando suprimir avisos</span><span class="sxs-lookup"><span data-stu-id="251f1-125">When to suppress warnings</span></span>

<span data-ttu-id="251f1-126">Não suprima um aviso nessa regra.</span><span class="sxs-lookup"><span data-stu-id="251f1-126">Do not suppress a warning from this rule.</span></span>

## <a name="example"></a><span data-ttu-id="251f1-127">Exemplo</span><span class="sxs-lookup"><span data-stu-id="251f1-127">Example</span></span>

<span data-ttu-id="251f1-128">O exemplo a seguir mostra um método que viola essa regra e, em seguida, mostra como corrigir a violação.</span><span class="sxs-lookup"><span data-stu-id="251f1-128">The following example shows a method that violates this rule, and then shows how to fix the violation.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca2101.cs" id="snippet1":::
